'use strict';

var Promise = require('bluebird');
var util = require('util');
var _ = require('lodash');

var elasticsearch = void 0;
try {
  // eslint-disable-next-line import/no-extraneous-dependencies, import/no-unresolved
  elasticsearch = require('elasticsearch');
} catch (e) {
  elasticsearch = null;
}

var gremlin = void 0;
try {
  // eslint-disable-next-line import/no-extraneous-dependencies, import/no-unresolved
  gremlin = require('gremlin');
} catch (e) {
  gremlin = null;
}

var dseDriver = void 0;
try {
  // eslint-disable-next-line import/no-extraneous-dependencies, import/no-unresolved
  dseDriver = require('dse-driver');
} catch (e) {
  dseDriver = null;
}

var cql = Promise.promisifyAll(dseDriver || require('cassandra-driver'));

var BaseModel = require('./base_model');
var schemer = require('../validators/schema');
var normalizer = require('../utils/normalizer');
var buildError = require('./apollo_error.js');

var KeyspaceBuilder = require('../builders/keyspace');
var UdtBuilder = require('../builders/udt');
var UdfBuilder = require('../builders/udf');
var UdaBuilder = require('../builders/uda');
var ElassandraBuilder = require('../builders/elassandra');
var JanusGraphBuilder = require('../builders/janusgraph');

var DEFAULT_REPLICATION_FACTOR = 1;

var noop = function noop() {};

var Apollo = function f(connection, options) {
  if (!connection) {
    throw buildError('model.validator.invalidconfig', 'Cassandra connection configuration undefined');
  }

  options = options || {};

  if (!options.defaultReplicationStrategy) {
    options.defaultReplicationStrategy = {
      class: 'SimpleStrategy',
      replication_factor: DEFAULT_REPLICATION_FACTOR
    };
  }

  this._options = options;
  this._models = {};
  this._keyspace = connection.keyspace;
  this._connection = connection;
  this._client = null;
  this._esclient = null;
  this._gremlin_client = null;
};

Apollo.prototype = {

  _generate_model(properties) {
    var Model = function f() {
      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      BaseModel.apply(this, Array.prototype.slice.call(args));
    };

    util.inherits(Model, BaseModel);

    Object.keys(BaseModel).forEach(function (key) {
      Model[key] = BaseModel[key];
    });

    Model._set_properties(properties);

    return Model;
  },

  create_es_client() {
    if (!elasticsearch) {
      throw new Error('Configured to use elassandra, but elasticsearch module was not found, try npm install elasticsearch');
    }

    var contactPoints = this._connection.contactPoints;
    var defaultHosts = [];
    contactPoints.forEach(function (host) {
      defaultHosts.push({ host });
    });

    var esClientConfig = _.defaults({}, this._connection.elasticsearch, {
      hosts: defaultHosts,
      sniffOnStart: true
    });
    this._esclient = new elasticsearch.Client(esClientConfig);
    return this._esclient;
  },

  _assert_es_index(callback) {
    var esClient = this.create_es_client();
    var indexName = this._keyspace;

    var elassandraBuilder = new ElassandraBuilder(esClient);
    elassandraBuilder.assert_index(indexName, indexName, callback);
  },

  create_gremlin_client() {
    if (!gremlin) {
      throw new Error('Configured to use janus graph server, but gremlin module was not found, try npm install gremlin');
    }

    var defaultHosts = this._connection.contactPoints;

    var gremlinConfig = _.defaults({}, this._connection.gremlin, {
      host: defaultHosts[0],
      port: 8182,
      storage: {
        backend: 'cassandrathrift',
        hostname: defaultHosts[0],
        port: 9160
      },
      index: {
        search: {
          backend: 'elasticsearch',
          hostname: defaultHosts[0],
          port: 9200
        }
      },
      options: {}
    });
    this._gremlin_client = gremlin.createClient(gremlinConfig.port, gremlinConfig.host, gremlinConfig.options);
    this._gremlin_config = gremlinConfig;
    return this._gremlin_client;
  },

  _assert_gremlin_graph(callback) {
    var gremlinClient = this.create_gremlin_client();
    var gremlinConfig = this._gremlin_config;
    var keyspaceName = this._keyspace;
    var graphName = `${keyspaceName}_graph`;

    var graphBuilder = new JanusGraphBuilder(gremlinClient, gremlinConfig);
    graphBuilder.assert_graph(graphName, callback);
  },

  get_system_client() {
    var connection = _.cloneDeep(this._connection);
    delete connection.keyspace;

    return new cql.Client(connection);
  },

  get_keyspace_name() {
    return this._keyspace;
  },

  _assert_keyspace(callback) {
    var client = this.get_system_client();
    var keyspaceName = this._keyspace;
    var options = this._options;

    var keyspaceBuilder = new KeyspaceBuilder(client);

    keyspaceBuilder.get_keyspace(keyspaceName, function (err, keyspaceObject) {
      if (err) {
        callback(err);
        return;
      }

      if (!keyspaceObject) {
        keyspaceBuilder.create_keyspace(keyspaceName, options.defaultReplicationStrategy, callback);
        return;
      }

      var dbReplication = normalizer.normalize_replication_option(keyspaceObject.replication);
      var ormReplication = normalizer.normalize_replication_option(options.defaultReplicationStrategy);

      if (!_.isEqual(dbReplication, ormReplication)) {
        keyspaceBuilder.alter_keyspace(keyspaceName, options.defaultReplicationStrategy, callback);
        return;
      }

      client.shutdown(function () {
        callback();
      });
    });
  },

  _assert_user_defined_types(callback) {
    var client = this._define_connection;
    var options = this._options;
    var keyspace = this._keyspace;

    if (!options.udts) {
      callback();
      return;
    }

    var udtBuilder = new UdtBuilder(client);

    Promise.mapSeries(Object.keys(options.udts), function (udtKey) {
      return new Promise(function (resolve, reject) {
        var udtCallback = function udtCallback(err) {
          if (err) {
            reject(err);
            return;
          }
          resolve();
        };
        udtBuilder.get_udt(udtKey, keyspace, function (err, udtObject) {
          if (err) {
            udtCallback(err);
            return;
          }

          if (!udtObject) {
            udtBuilder.create_udt(udtKey, options.udts[udtKey], udtCallback);
            return;
          }

          var udtKeys = Object.keys(options.udts[udtKey]);
          var udtValues = _.map(_.values(options.udts[udtKey]), normalizer.normalize_user_defined_type);
          var fieldNames = udtObject.field_names;
          var fieldTypes = _.map(udtObject.field_types, normalizer.normalize_user_defined_type);

          if (_.difference(udtKeys, fieldNames).length === 0 && _.difference(udtValues, fieldTypes).length === 0) {
            udtCallback();
            return;
          }

          throw new Error(util.format('User defined type "%s" already exists but does not match the udt definition. ' + 'Consider altering or droping the type.', udtKey));
        });
      });
    }).then(function () {
      callback();
    }).catch(function (err) {
      callback(err);
    });
  },

  _assert_user_defined_functions(callback) {
    var client = this._define_connection;
    var options = this._options;
    var keyspace = this._keyspace;

    if (!options.udfs) {
      callback();
      return;
    }

    var udfBuilder = new UdfBuilder(client);

    Promise.mapSeries(Object.keys(options.udfs), function (udfKey) {
      return new Promise(function (resolve, reject) {
        var udfCallback = function udfCallback(err) {
          if (err) {
            reject(err);
            return;
          }
          resolve();
        };

        udfBuilder.validate_definition(udfKey, options.udfs[udfKey]);

        udfBuilder.get_udf(udfKey, keyspace, function (err, udfObject) {
          if (err) {
            udfCallback(err);
            return;
          }

          if (!udfObject) {
            udfBuilder.create_udf(udfKey, options.udfs[udfKey], udfCallback);
            return;
          }

          var udfLanguage = options.udfs[udfKey].language;
          var resultLanguage = udfObject.language;

          var udfCode = options.udfs[udfKey].code;
          var resultCode = udfObject.body;

          var udfReturnType = normalizer.normalize_user_defined_type(options.udfs[udfKey].returnType);
          var resultReturnType = normalizer.normalize_user_defined_type(udfObject.return_type);

          var udfInputs = options.udfs[udfKey].inputs ? options.udfs[udfKey].inputs : {};
          var udfInputKeys = Object.keys(udfInputs);
          var udfInputValues = _.map(_.values(udfInputs), normalizer.normalize_user_defined_type);
          var resultArgumentNames = udfObject.argument_names;
          var resultArgumentTypes = _.map(udfObject.argument_types, normalizer.normalize_user_defined_type);

          if (udfLanguage === resultLanguage && udfCode === resultCode && udfReturnType === resultReturnType && _.isEqual(udfInputKeys, resultArgumentNames) && _.isEqual(udfInputValues, resultArgumentTypes)) {
            udfCallback();
            return;
          }

          udfBuilder.create_udf(udfKey, options.udfs[udfKey], udfCallback);
        });
      });
    }).then(function () {
      callback();
    }).catch(function (err) {
      callback(err);
    });
  },

  _assert_user_defined_aggregates(callback) {
    var client = this._define_connection;
    var options = this._options;
    var keyspace = this._keyspace;

    if (!options.udas) {
      callback();
      return;
    }

    var udaBuilder = new UdaBuilder(client);

    Promise.mapSeries(Object.keys(options.udas), function (udaKey) {
      return new Promise(function (resolve, reject) {
        var udaCallback = function udaCallback(err) {
          if (err) {
            reject(err);
            return;
          }
          resolve();
        };

        udaBuilder.validate_definition(udaKey, options.udas[udaKey]);

        if (!options.udas[udaKey].initcond) {
          options.udas[udaKey].initcond = null;
        }

        udaBuilder.get_uda(udaKey, keyspace, function (err, udaObjects) {
          if (err) {
            udaCallback(err);
            return;
          }

          if (!udaObjects) {
            udaBuilder.create_uda(udaKey, options.udas[udaKey], udaCallback);
            return;
          }

          var inputTypes = _.map(options.udas[udaKey].input_types, normalizer.normalize_user_defined_type);
          var sfunc = options.udas[udaKey].sfunc.toLowerCase();
          var stype = normalizer.normalize_user_defined_type(options.udas[udaKey].stype);
          var finalfunc = options.udas[udaKey].finalfunc ? options.udas[udaKey].finalfunc.toLowerCase() : null;
          var initcond = options.udas[udaKey].initcond ? options.udas[udaKey].initcond.replace(/[\s]/g, '') : null;

          for (var i = 0; i < udaObjects.length; i++) {
            var resultArgumentTypes = _.map(udaObjects[i].argument_types, normalizer.normalize_user_defined_type);

            var resultStateFunc = udaObjects[i].state_func;
            var resultStateType = normalizer.normalize_user_defined_type(udaObjects[i].state_type);
            var resultFinalFunc = udaObjects[i].final_func;
            var resultInitcond = udaObjects[i].initcond ? udaObjects[i].initcond.replace(/[\s]/g, '') : null;

            if (sfunc === resultStateFunc && stype === resultStateType && finalfunc === resultFinalFunc && initcond === resultInitcond && _.isEqual(inputTypes, resultArgumentTypes)) {
              udaCallback();
              return;
            }
          }
          udaBuilder.create_uda(udaKey, options.udas[udaKey], udaCallback);
        });
      });
    }).then(function () {
      callback();
    }).catch(function (err) {
      callback(err);
    });
  },

  _set_client(client) {
    var _this = this;

    var defineConnectionOptions = _.cloneDeep(this._connection);

    this._client = client;
    this._define_connection = new cql.Client(defineConnectionOptions);

    // Reset connections on all models
    Object.keys(this._models).forEach(function (i) {
      _this._models[i]._properties.cql = _this._client;
      _this._models[i]._properties.define_connection = _this._define_connection;
    });
  },

  init(callback) {
    var _this2 = this;

    var onUserDefinedAggregates = function onUserDefinedAggregates(err) {
      if (err) {
        callback(err);
        return;
      }

      var managementTasks = [];
      if (_this2._keyspace && _this2._options.manageESIndex) {
        _this2.assertESIndexAsync = Promise.promisify(_this2._assert_es_index);
        managementTasks.push(_this2.assertESIndexAsync());
      }
      if (_this2._keyspace && _this2._options.manageGraphs) {
        _this2.assertGremlinGraphAsync = Promise.promisify(_this2._assert_gremlin_graph);
        managementTasks.push(_this2.assertGremlinGraphAsync());
      }
      Promise.all(managementTasks).then(function () {
        callback(null, _this2);
      }).catch(function (err1) {
        callback(err1);
      });
    };

    var onUserDefinedFunctions = function f(err) {
      if (err) {
        callback(err);
        return;
      }
      try {
        this._assert_user_defined_aggregates(onUserDefinedAggregates.bind(this));
      } catch (e) {
        throw buildError('model.validator.invaliduda', e.message);
      }
    };

    var onUserDefinedTypes = function f(err) {
      if (err) {
        callback(err);
        return;
      }
      try {
        this._assert_user_defined_functions(onUserDefinedFunctions.bind(this));
      } catch (e) {
        throw buildError('model.validator.invalidudf', e.message);
      }
    };

    var onKeyspace = function f(err) {
      if (err) {
        callback(err);
        return;
      }
      this._set_client(new cql.Client(this._connection));
      try {
        this._assert_user_defined_types(onUserDefinedTypes.bind(this));
      } catch (e) {
        throw buildError('model.validator.invalidudt', e.message);
      }
    };

    if (this._keyspace && this._options.createKeyspace !== false) {
      this._assert_keyspace(onKeyspace.bind(this));
    } else {
      onKeyspace.call(this);
    }
  },

  addModel(modelName, modelSchema) {
    if (!modelName || typeof modelName !== 'string') {
      throw buildError('model.validator.invalidschema', 'Model name must be a valid string');
    }

    try {
      schemer.validate_model_schema(modelSchema);
    } catch (e) {
      throw buildError('model.validator.invalidschema', e.message);
    }

    if (modelSchema.options && modelSchema.options.timestamps) {
      var timestampOptions = {
        createdAt: modelSchema.options.timestamps.createdAt || 'createdAt',
        updatedAt: modelSchema.options.timestamps.updatedAt || 'updatedAt'
      };
      modelSchema.options.timestamps = timestampOptions;

      modelSchema.fields[modelSchema.options.timestamps.createdAt] = {
        type: 'timestamp',
        default: {
          $db_function: 'toTimestamp(now())'
        }
      };
      modelSchema.fields[modelSchema.options.timestamps.updatedAt] = {
        type: 'timestamp',
        default: {
          $db_function: 'toTimestamp(now())'
        }
      };
    }

    if (modelSchema.options && modelSchema.options.versions) {
      var versionOptions = {
        key: modelSchema.options.versions.key || '__v'
      };
      modelSchema.options.versions = versionOptions;

      modelSchema.fields[modelSchema.options.versions.key] = {
        type: 'timeuuid',
        default: {
          $db_function: 'now()'
        }
      };
    }

    var baseProperties = {
      name: modelName,
      schema: modelSchema,
      keyspace: this._keyspace,
      define_connection: this._define_connection,
      cql: this._client,
      esclient: this._esclient,
      gremlin_client: this._gremlin_client,
      get_constructor: this.getModel.bind(this, modelName),
      init: this.init.bind(this),
      dropTableOnSchemaChange: this._options.dropTableOnSchemaChange,
      createTable: this._options.createTable,
      migration: this._options.migration,
      disableTTYConfirmation: this._options.disableTTYConfirmation
    };

    this._models[modelName] = this._generate_model(baseProperties);
    return this._models[modelName];
  },

  getModel(modelName) {
    return this._models[modelName] || null;
  },

  close(callback) {
    callback = callback || noop;

    if (this.orm._esclient) {
      this.orm._esclient.close();
    }

    if (this.orm._gremlin_client && this.orm._gremlin_client.connection && this.orm._gremlin_client.connection.ws) {
      this.orm._gremlin_client.connection.ws.close();
    }

    var clientsToShutdown = [];
    if (this.orm._client) {
      clientsToShutdown.push(this.orm._client.shutdown());
    }
    if (this.orm._define_connection) {
      clientsToShutdown.push(this.orm._define_connection.shutdown());
    }

    Promise.all(clientsToShutdown).then(function () {
      callback();
    }).catch(function (err) {
      callback(err);
    });
  }
};

module.exports = Apollo;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcm0vYXBvbGxvLmpzIl0sIm5hbWVzIjpbIlByb21pc2UiLCJyZXF1aXJlIiwidXRpbCIsIl8iLCJlbGFzdGljc2VhcmNoIiwiZSIsImdyZW1saW4iLCJkc2VEcml2ZXIiLCJjcWwiLCJwcm9taXNpZnlBbGwiLCJCYXNlTW9kZWwiLCJzY2hlbWVyIiwibm9ybWFsaXplciIsImJ1aWxkRXJyb3IiLCJLZXlzcGFjZUJ1aWxkZXIiLCJVZHRCdWlsZGVyIiwiVWRmQnVpbGRlciIsIlVkYUJ1aWxkZXIiLCJFbGFzc2FuZHJhQnVpbGRlciIsIkphbnVzR3JhcGhCdWlsZGVyIiwiREVGQVVMVF9SRVBMSUNBVElPTl9GQUNUT1IiLCJub29wIiwiQXBvbGxvIiwiZiIsImNvbm5lY3Rpb24iLCJvcHRpb25zIiwiZGVmYXVsdFJlcGxpY2F0aW9uU3RyYXRlZ3kiLCJjbGFzcyIsInJlcGxpY2F0aW9uX2ZhY3RvciIsIl9vcHRpb25zIiwiX21vZGVscyIsIl9rZXlzcGFjZSIsImtleXNwYWNlIiwiX2Nvbm5lY3Rpb24iLCJfY2xpZW50IiwiX2VzY2xpZW50IiwiX2dyZW1saW5fY2xpZW50IiwicHJvdG90eXBlIiwiX2dlbmVyYXRlX21vZGVsIiwicHJvcGVydGllcyIsIk1vZGVsIiwiYXJncyIsImFwcGx5IiwiQXJyYXkiLCJzbGljZSIsImNhbGwiLCJpbmhlcml0cyIsIk9iamVjdCIsImtleXMiLCJmb3JFYWNoIiwia2V5IiwiX3NldF9wcm9wZXJ0aWVzIiwiY3JlYXRlX2VzX2NsaWVudCIsIkVycm9yIiwiY29udGFjdFBvaW50cyIsImRlZmF1bHRIb3N0cyIsImhvc3QiLCJwdXNoIiwiZXNDbGllbnRDb25maWciLCJkZWZhdWx0cyIsImhvc3RzIiwic25pZmZPblN0YXJ0IiwiQ2xpZW50IiwiX2Fzc2VydF9lc19pbmRleCIsImNhbGxiYWNrIiwiZXNDbGllbnQiLCJpbmRleE5hbWUiLCJlbGFzc2FuZHJhQnVpbGRlciIsImFzc2VydF9pbmRleCIsImNyZWF0ZV9ncmVtbGluX2NsaWVudCIsImdyZW1saW5Db25maWciLCJwb3J0Iiwic3RvcmFnZSIsImJhY2tlbmQiLCJob3N0bmFtZSIsImluZGV4Iiwic2VhcmNoIiwiY3JlYXRlQ2xpZW50IiwiX2dyZW1saW5fY29uZmlnIiwiX2Fzc2VydF9ncmVtbGluX2dyYXBoIiwiZ3JlbWxpbkNsaWVudCIsImtleXNwYWNlTmFtZSIsImdyYXBoTmFtZSIsImdyYXBoQnVpbGRlciIsImFzc2VydF9ncmFwaCIsImdldF9zeXN0ZW1fY2xpZW50IiwiY2xvbmVEZWVwIiwiZ2V0X2tleXNwYWNlX25hbWUiLCJfYXNzZXJ0X2tleXNwYWNlIiwiY2xpZW50Iiwia2V5c3BhY2VCdWlsZGVyIiwiZ2V0X2tleXNwYWNlIiwiZXJyIiwia2V5c3BhY2VPYmplY3QiLCJjcmVhdGVfa2V5c3BhY2UiLCJkYlJlcGxpY2F0aW9uIiwibm9ybWFsaXplX3JlcGxpY2F0aW9uX29wdGlvbiIsInJlcGxpY2F0aW9uIiwib3JtUmVwbGljYXRpb24iLCJpc0VxdWFsIiwiYWx0ZXJfa2V5c3BhY2UiLCJzaHV0ZG93biIsIl9hc3NlcnRfdXNlcl9kZWZpbmVkX3R5cGVzIiwiX2RlZmluZV9jb25uZWN0aW9uIiwidWR0cyIsInVkdEJ1aWxkZXIiLCJtYXBTZXJpZXMiLCJ1ZHRLZXkiLCJyZXNvbHZlIiwicmVqZWN0IiwidWR0Q2FsbGJhY2siLCJnZXRfdWR0IiwidWR0T2JqZWN0IiwiY3JlYXRlX3VkdCIsInVkdEtleXMiLCJ1ZHRWYWx1ZXMiLCJtYXAiLCJ2YWx1ZXMiLCJub3JtYWxpemVfdXNlcl9kZWZpbmVkX3R5cGUiLCJmaWVsZE5hbWVzIiwiZmllbGRfbmFtZXMiLCJmaWVsZFR5cGVzIiwiZmllbGRfdHlwZXMiLCJkaWZmZXJlbmNlIiwibGVuZ3RoIiwiZm9ybWF0IiwidGhlbiIsImNhdGNoIiwiX2Fzc2VydF91c2VyX2RlZmluZWRfZnVuY3Rpb25zIiwidWRmcyIsInVkZkJ1aWxkZXIiLCJ1ZGZLZXkiLCJ1ZGZDYWxsYmFjayIsInZhbGlkYXRlX2RlZmluaXRpb24iLCJnZXRfdWRmIiwidWRmT2JqZWN0IiwiY3JlYXRlX3VkZiIsInVkZkxhbmd1YWdlIiwibGFuZ3VhZ2UiLCJyZXN1bHRMYW5ndWFnZSIsInVkZkNvZGUiLCJjb2RlIiwicmVzdWx0Q29kZSIsImJvZHkiLCJ1ZGZSZXR1cm5UeXBlIiwicmV0dXJuVHlwZSIsInJlc3VsdFJldHVyblR5cGUiLCJyZXR1cm5fdHlwZSIsInVkZklucHV0cyIsImlucHV0cyIsInVkZklucHV0S2V5cyIsInVkZklucHV0VmFsdWVzIiwicmVzdWx0QXJndW1lbnROYW1lcyIsImFyZ3VtZW50X25hbWVzIiwicmVzdWx0QXJndW1lbnRUeXBlcyIsImFyZ3VtZW50X3R5cGVzIiwiX2Fzc2VydF91c2VyX2RlZmluZWRfYWdncmVnYXRlcyIsInVkYXMiLCJ1ZGFCdWlsZGVyIiwidWRhS2V5IiwidWRhQ2FsbGJhY2siLCJpbml0Y29uZCIsImdldF91ZGEiLCJ1ZGFPYmplY3RzIiwiY3JlYXRlX3VkYSIsImlucHV0VHlwZXMiLCJpbnB1dF90eXBlcyIsInNmdW5jIiwidG9Mb3dlckNhc2UiLCJzdHlwZSIsImZpbmFsZnVuYyIsInJlcGxhY2UiLCJpIiwicmVzdWx0U3RhdGVGdW5jIiwic3RhdGVfZnVuYyIsInJlc3VsdFN0YXRlVHlwZSIsInN0YXRlX3R5cGUiLCJyZXN1bHRGaW5hbEZ1bmMiLCJmaW5hbF9mdW5jIiwicmVzdWx0SW5pdGNvbmQiLCJfc2V0X2NsaWVudCIsImRlZmluZUNvbm5lY3Rpb25PcHRpb25zIiwiX3Byb3BlcnRpZXMiLCJkZWZpbmVfY29ubmVjdGlvbiIsImluaXQiLCJvblVzZXJEZWZpbmVkQWdncmVnYXRlcyIsIm1hbmFnZW1lbnRUYXNrcyIsIm1hbmFnZUVTSW5kZXgiLCJhc3NlcnRFU0luZGV4QXN5bmMiLCJwcm9taXNpZnkiLCJtYW5hZ2VHcmFwaHMiLCJhc3NlcnRHcmVtbGluR3JhcGhBc3luYyIsImFsbCIsImVycjEiLCJvblVzZXJEZWZpbmVkRnVuY3Rpb25zIiwiYmluZCIsIm1lc3NhZ2UiLCJvblVzZXJEZWZpbmVkVHlwZXMiLCJvbktleXNwYWNlIiwiY3JlYXRlS2V5c3BhY2UiLCJhZGRNb2RlbCIsIm1vZGVsTmFtZSIsIm1vZGVsU2NoZW1hIiwidmFsaWRhdGVfbW9kZWxfc2NoZW1hIiwidGltZXN0YW1wcyIsInRpbWVzdGFtcE9wdGlvbnMiLCJjcmVhdGVkQXQiLCJ1cGRhdGVkQXQiLCJmaWVsZHMiLCJ0eXBlIiwiZGVmYXVsdCIsIiRkYl9mdW5jdGlvbiIsInZlcnNpb25zIiwidmVyc2lvbk9wdGlvbnMiLCJiYXNlUHJvcGVydGllcyIsIm5hbWUiLCJzY2hlbWEiLCJlc2NsaWVudCIsImdyZW1saW5fY2xpZW50IiwiZ2V0X2NvbnN0cnVjdG9yIiwiZ2V0TW9kZWwiLCJkcm9wVGFibGVPblNjaGVtYUNoYW5nZSIsImNyZWF0ZVRhYmxlIiwibWlncmF0aW9uIiwiZGlzYWJsZVRUWUNvbmZpcm1hdGlvbiIsImNsb3NlIiwib3JtIiwid3MiLCJjbGllbnRzVG9TaHV0ZG93biIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBTUEsVUFBVUMsUUFBUSxVQUFSLENBQWhCO0FBQ0EsSUFBTUMsT0FBT0QsUUFBUSxNQUFSLENBQWI7QUFDQSxJQUFNRSxJQUFJRixRQUFRLFFBQVIsQ0FBVjs7QUFFQSxJQUFJRyxzQkFBSjtBQUNBLElBQUk7QUFDRjtBQUNBQSxrQkFBZ0JILFFBQVEsZUFBUixDQUFoQjtBQUNELENBSEQsQ0FHRSxPQUFPSSxDQUFQLEVBQVU7QUFDVkQsa0JBQWdCLElBQWhCO0FBQ0Q7O0FBRUQsSUFBSUUsZ0JBQUo7QUFDQSxJQUFJO0FBQ0Y7QUFDQUEsWUFBVUwsUUFBUSxTQUFSLENBQVY7QUFDRCxDQUhELENBR0UsT0FBT0ksQ0FBUCxFQUFVO0FBQ1ZDLFlBQVUsSUFBVjtBQUNEOztBQUVELElBQUlDLGtCQUFKO0FBQ0EsSUFBSTtBQUNGO0FBQ0FBLGNBQVlOLFFBQVEsWUFBUixDQUFaO0FBQ0QsQ0FIRCxDQUdFLE9BQU9JLENBQVAs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eUksT0FBT0MsT0FBUCxHQUFpQmhOLE1BQWpCIiwiZmlsZSI6ImFwb2xsby5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFByb21pc2UgPSByZXF1aXJlKCdibHVlYmlyZCcpO1xuY29uc3QgdXRpbCA9IHJlcXVpcmUoJ3V0aWwnKTtcbmNvbnN0IF8gPSByZXF1aXJlKCdsb2Rhc2gnKTtcblxubGV0IGVsYXN0aWNzZWFyY2g7XG50cnkge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L25vLWV4dHJhbmVvdXMtZGVwZW5kZW5jaWVzLCBpbXBvcnQvbm8tdW5yZXNvbHZlZFxuICBlbGFzdGljc2VhcmNoID0gcmVxdWlyZSgnZWxhc3RpY3NlYXJjaCcpO1xufSBjYXRjaCAoZSkge1xuICBlbGFzdGljc2VhcmNoID0gbnVsbDtcbn1cblxubGV0IGdyZW1saW47XG50cnkge1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L25vLWV4dHJhbmVvdXMtZGVwZW5kZW5jaWVzLCBpbXBvcnQvbm8tdW5yZXNvbHZlZFxuICBncmVtbGluID0gcmVxdWlyZSgnZ3JlbWxpbicpO1xufSBjYXRjaCAoZSkge1xuICBncmVtbGluID0gbnVsbDtcbn1cblxubGV0IGRzZURyaXZlcjtcbnRyeSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvbm8tZXh0cmFuZW91cy1kZXBlbmRlbmNpZXMsIGltcG9ydC9uby11bnJlc29sdmVkXG4gIGRzZURyaXZlciA9IHJlcXVpcmUoJ2RzZS1kcml2ZXInKTtcbn0gY2F0Y2ggKGUpIHtcbiAgZHNlRHJpdmVyID0gbnVsbDtcbn1cblxuY29uc3QgY3FsID0gUHJvbWlzZS5wcm9taXNpZnlBbGwoZHNlRHJpdmVyIHx8IHJlcXVpcmUoJ2Nhc3NhbmRyYS1kcml2ZXInKSk7XG5cbmNvbnN0IEJhc2VNb2RlbCA9IHJlcXVpcmUoJy4vYmFzZV9tb2RlbCcpO1xuY29uc3Qgc2NoZW1lciA9IHJlcXVpcmUoJy4uL3ZhbGlkYXRvcnMvc2NoZW1hJyk7XG5jb25zdCBub3JtYWxpemVyID0gcmVxdWlyZSgnLi4vdXRpbHMvbm9ybWFsaXplcicpO1xuY29uc3QgYnVpbGRFcnJvciA9IHJlcXVpcmUoJy4vYXBvbGxvX2Vycm9yLmpzJyk7XG5cbmNvbnN0IEtleXNwYWNlQnVpbGRlciA9IHJlcXVpcmUoJy4uL2J1aWxkZXJzL2tleXNwYWNlJyk7XG5jb25zdCBVZHRCdWlsZGVyID0gcmVxdWlyZSgnLi4vYnVpbGRlcnMvdWR0Jyk7XG5jb25zdCBVZGZCdWlsZGVyID0gcmVxdWlyZSgnLi4vYnVpbGRlcnMvdWRmJyk7XG5jb25zdCBVZGFCdWlsZGVyID0gcmVxdWlyZSgnLi4vYnVpbGRlcnMvdWRhJyk7XG5jb25zdCBFbGFzc2FuZHJhQnVpbGRlciA9IHJlcXVpcmUoJy4uL2J1aWxkZXJzL2VsYXNzYW5kcmEnKTtcbmNvbnN0IEphbnVzR3JhcGhCdWlsZGVyID0gcmVxdWlyZSgnLi4vYnVpbGRlcnMvamFudXNncmFwaCcpO1xuXG5jb25zdCBERUZBVUxUX1JFUExJQ0FUSU9OX0ZBQ1RPUiA9IDE7XG5cbmNvbnN0IG5vb3AgPSAoKSA9PiB7fTtcblxuY29uc3QgQXBvbGxvID0gZnVuY3Rpb24gZihjb25uZWN0aW9uLCBvcHRpb25zKSB7XG4gIGlmICghY29ubmVjdGlvbikge1xuICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC52YWxpZGF0b3IuaW52YWxpZGNvbmZpZycsICdDYXNzYW5kcmEgY29ubmVjdGlvbiBjb25maWd1cmF0aW9uIHVuZGVmaW5lZCcpKTtcbiAgfVxuXG4gIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gIGlmICghb3B0aW9ucy5kZWZhdWx0UmVwbGljYXRpb25TdHJhdGVneSkge1xuICAgIG9wdGlvbnMuZGVmYXVsdFJlcGxpY2F0aW9uU3RyYXRlZ3kgPSB7XG4gICAgICBjbGFzczogJ1NpbXBsZVN0cmF0ZWd5JyxcbiAgICAgIHJlcGxpY2F0aW9uX2ZhY3RvcjogREVGQVVMVF9SRVBMSUNBVElPTl9GQUNUT1IsXG4gICAgfTtcbiAgfVxuXG4gIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuICB0aGlzLl9tb2RlbHMgPSB7fTtcbiAgdGhpcy5fa2V5c3BhY2UgPSBjb25uZWN0aW9uLmtleXNwYWNlO1xuICB0aGlzLl9jb25uZWN0aW9uID0gY29ubmVjdGlvbjtcbiAgdGhpcy5fY2xpZW50ID0gbnVsbDtcbiAgdGhpcy5fZXNjbGllbnQgPSBudWxsO1xuICB0aGlzLl9ncmVtbGluX2NsaWVudCA9IG51bGw7XG59O1xuXG5BcG9sbG8ucHJvdG90eXBlID0ge1xuXG4gIF9nZW5lcmF0ZV9tb2RlbChwcm9wZXJ0aWVzKSB7XG4gICAgY29uc3QgTW9kZWwgPSBmdW5jdGlvbiBmKC4uLmFyZ3MpIHtcbiAgICAgIEJhc2VNb2RlbC5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmdzKSk7XG4gICAgfTtcblxuICAgIHV0aWwuaW5oZXJpdHMoTW9kZWwsIEJhc2VNb2RlbCk7XG5cbiAgICBPYmplY3Qua2V5cyhCYXNlTW9kZWwpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgTW9kZWxba2V5XSA9IEJhc2VNb2RlbFtrZXldO1xuICAgIH0pO1xuXG4gICAgTW9kZWwuX3NldF9wcm9wZXJ0aWVzKHByb3BlcnRpZXMpO1xuXG4gICAgcmV0dXJuIE1vZGVsO1xuICB9LFxuXG4gIGNyZWF0ZV9lc19jbGllbnQoKSB7XG4gICAgaWYgKCFlbGFzdGljc2VhcmNoKSB7XG4gICAgICB0aHJvdyAobmV3IEVycm9yKCdDb25maWd1cmVkIHRvIHVzZSBlbGFzc2FuZHJhLCBidXQgZWxhc3RpY3NlYXJjaCBtb2R1bGUgd2FzIG5vdCBmb3VuZCwgdHJ5IG5wbSBpbnN0YWxsIGVsYXN0aWNzZWFyY2gnKSk7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGFjdFBvaW50cyA9IHRoaXMuX2Nvbm5lY3Rpb24uY29udGFjdFBvaW50cztcbiAgICBjb25zdCBkZWZhdWx0SG9zdHMgPSBbXTtcbiAgICBjb250YWN0UG9pbnRzLmZvckVhY2goKGhvc3QpID0+IHtcbiAgICAgIGRlZmF1bHRIb3N0cy5wdXNoKHsgaG9zdCB9KTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGVzQ2xpZW50Q29uZmlnID0gXy5kZWZhdWx0cyh7fSwgdGhpcy5fY29ubmVjdGlvbi5lbGFzdGljc2VhcmNoLCB7XG4gICAgICBob3N0czogZGVmYXVsdEhvc3RzLFxuICAgICAgc25pZmZPblN0YXJ0OiB0cnVlLFxuICAgIH0pO1xuICAgIHRoaXMuX2VzY2xpZW50ID0gbmV3IGVsYXN0aWNzZWFyY2guQ2xpZW50KGVzQ2xpZW50Q29uZmlnKTtcbiAgICByZXR1cm4gdGhpcy5fZXNjbGllbnQ7XG4gIH0sXG5cbiAgX2Fzc2VydF9lc19pbmRleChjYWxsYmFjaykge1xuICAgIGNvbnN0IGVzQ2xpZW50ID0gdGhpcy5jcmVhdGVfZXNfY2xpZW50KCk7XG4gICAgY29uc3QgaW5kZXhOYW1lID0gdGhpcy5fa2V5c3BhY2U7XG5cbiAgICBjb25zdCBlbGFzc2FuZHJhQnVpbGRlciA9IG5ldyBFbGFzc2FuZHJhQnVpbGRlcihlc0NsaWVudCk7XG4gICAgZWxhc3NhbmRyYUJ1aWxkZXIuYXNzZXJ0X2luZGV4KGluZGV4TmFtZSwgaW5kZXhOYW1lLCBjYWxsYmFjayk7XG4gIH0sXG5cbiAgY3JlYXRlX2dyZW1saW5fY2xpZW50KCkge1xuICAgIGlmICghZ3JlbWxpbikge1xuICAgICAgdGhyb3cgKG5ldyBFcnJvcignQ29uZmlndXJlZCB0byB1c2UgamFudXMgZ3JhcGggc2VydmVyLCBidXQgZ3JlbWxpbiBtb2R1bGUgd2FzIG5vdCBmb3VuZCwgdHJ5IG5wbSBpbnN0YWxsIGdyZW1saW4nKSk7XG4gICAgfVxuXG4gICAgY29uc3QgZGVmYXVsdEhvc3RzID0gdGhpcy5fY29ubmVjdGlvbi5jb250YWN0UG9pbnRzO1xuXG4gICAgY29uc3QgZ3JlbWxpbkNvbmZpZyA9IF8uZGVmYXVsdHMoe30sIHRoaXMuX2Nvbm5lY3Rpb24uZ3JlbWxpbiwge1xuICAgICAgaG9zdDogZGVmYXVsdEhvc3RzWzBdLFxuICAgICAgcG9ydDogODE4MixcbiAgICAgIHN0b3JhZ2U6IHtcbiAgICAgICAgYmFja2VuZDogJ2Nhc3NhbmRyYXRocmlmdCcsXG4gICAgICAgIGhvc3RuYW1lOiBkZWZhdWx0SG9zdHNbMF0sXG4gICAgICAgIHBvcnQ6IDkxNjAsXG4gICAgICB9LFxuICAgICAgaW5kZXg6IHtcbiAgICAgICAgc2VhcmNoOiB7XG4gICAgICAgICAgYmFja2VuZDogJ2VsYXN0aWNzZWFyY2gnLFxuICAgICAgICAgIGhvc3RuYW1lOiBkZWZhdWx0SG9zdHNbMF0sXG4gICAgICAgICAgcG9ydDogOTIwMCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBvcHRpb25zOiB7fSxcbiAgICB9KTtcbiAgICB0aGlzLl9ncmVtbGluX2NsaWVudCA9IGdyZW1saW4uY3JlYXRlQ2xpZW50KGdyZW1saW5Db25maWcucG9ydCwgZ3JlbWxpbkNvbmZpZy5ob3N0LCBncmVtbGluQ29uZmlnLm9wdGlvbnMpO1xuICAgIHRoaXMuX2dyZW1saW5fY29uZmlnID0gZ3JlbWxpbkNvbmZpZztcbiAgICByZXR1cm4gdGhpcy5fZ3JlbWxpbl9jbGllbnQ7XG4gIH0sXG5cbiAgX2Fzc2VydF9ncmVtbGluX2dyYXBoKGNhbGxiYWNrKSB7XG4gICAgY29uc3QgZ3JlbWxpbkNsaWVudCA9IHRoaXMuY3JlYXRlX2dyZW1saW5fY2xpZW50KCk7XG4gICAgY29uc3QgZ3JlbWxpbkNvbmZpZyA9IHRoaXMuX2dyZW1saW5fY29uZmlnO1xuICAgIGNvbnN0IGtleXNwYWNlTmFtZSA9IHRoaXMuX2tleXNwYWNlO1xuICAgIGNvbnN0IGdyYXBoTmFtZSA9IGAke2tleXNwYWNlTmFtZX1fZ3JhcGhgO1xuXG4gICAgY29uc3QgZ3JhcGhCdWlsZGVyID0gbmV3IEphbnVzR3JhcGhCdWlsZGVyKGdyZW1saW5DbGllbnQsIGdyZW1saW5Db25maWcpO1xuICAgIGdyYXBoQnVpbGRlci5hc3NlcnRfZ3JhcGgoZ3JhcGhOYW1lLCBjYWxsYmFjayk7XG4gIH0sXG5cbiAgZ2V0X3N5c3RlbV9jbGllbnQoKSB7XG4gICAgY29uc3QgY29ubmVjdGlvbiA9IF8uY2xvbmVEZWVwKHRoaXMuX2Nvbm5lY3Rpb24pO1xuICAgIGRlbGV0ZSBjb25uZWN0aW9uLmtleXNwYWNlO1xuXG4gICAgcmV0dXJuIG5ldyBjcWwuQ2xpZW50KGNvbm5lY3Rpb24pO1xuICB9LFxuXG4gIGdldF9rZXlzcGFjZV9uYW1lKCkge1xuICAgIHJldHVybiB0aGlzLl9rZXlzcGFjZTtcbiAgfSxcblxuICBfYXNzZXJ0X2tleXNwYWNlKGNhbGxiYWNrKSB7XG4gICAgY29uc3QgY2xpZW50ID0gdGhpcy5nZXRfc3lzdGVtX2NsaWVudCgpO1xuICAgIGNvbnN0IGtleXNwYWNlTmFtZSA9IHRoaXMuX2tleXNwYWNlO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLl9vcHRpb25zO1xuXG4gICAgY29uc3Qga2V5c3BhY2VCdWlsZGVyID0gbmV3IEtleXNwYWNlQnVpbGRlcihjbGllbnQpO1xuXG4gICAga2V5c3BhY2VCdWlsZGVyLmdldF9rZXlzcGFjZShrZXlzcGFjZU5hbWUsIChlcnIsIGtleXNwYWNlT2JqZWN0KSA9PiB7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFrZXlzcGFjZU9iamVjdCkge1xuICAgICAgICBrZXlzcGFjZUJ1aWxkZXIuY3JlYXRlX2tleXNwYWNlKGtleXNwYWNlTmFtZSwgb3B0aW9ucy5kZWZhdWx0UmVwbGljYXRpb25TdHJhdGVneSwgY2FsbGJhY2spO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRiUmVwbGljYXRpb24gPSBub3JtYWxpemVyLm5vcm1hbGl6ZV9yZXBsaWNhdGlvbl9vcHRpb24oa2V5c3BhY2VPYmplY3QucmVwbGljYXRpb24pO1xuICAgICAgY29uc3Qgb3JtUmVwbGljYXRpb24gPSBub3JtYWxpemVyLm5vcm1hbGl6ZV9yZXBsaWNhdGlvbl9vcHRpb24ob3B0aW9ucy5kZWZhdWx0UmVwbGljYXRpb25TdHJhdGVneSk7XG5cbiAgICAgIGlmICghXy5pc0VxdWFsKGRiUmVwbGljYXRpb24sIG9ybVJlcGxpY2F0aW9uKSkge1xuICAgICAgICBrZXlzcGFjZUJ1aWxkZXIuYWx0ZXJfa2V5c3BhY2Uoa2V5c3BhY2VOYW1lLCBvcHRpb25zLmRlZmF1bHRSZXBsaWNhdGlvblN0cmF0ZWd5LCBjYWxsYmFjayk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgY2xpZW50LnNodXRkb3duKCgpID0+IHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9LFxuXG4gIF9hc3NlcnRfdXNlcl9kZWZpbmVkX3R5cGVzKGNhbGxiYWNrKSB7XG4gICAgY29uc3QgY2xpZW50ID0gdGhpcy5fZGVmaW5lX2Nvbm5lY3Rpb247XG4gICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuX29wdGlvbnM7XG4gICAgY29uc3Qga2V5c3BhY2UgPSB0aGlzLl9rZXlzcGFjZTtcblxuICAgIGlmICghb3B0aW9ucy51ZHRzKSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHVkdEJ1aWxkZXIgPSBuZXcgVWR0QnVpbGRlcihjbGllbnQpO1xuXG4gICAgUHJvbWlzZS5tYXBTZXJpZXMoT2JqZWN0LmtleXMob3B0aW9ucy51ZHRzKSwgKHVkdEtleSkgPT4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgdWR0Q2FsbGJhY2sgPSAoZXJyKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIHVkdEJ1aWxkZXIuZ2V0X3VkdCh1ZHRLZXksIGtleXNwYWNlLCAoZXJyLCB1ZHRPYmplY3QpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHVkdENhbGxiYWNrKGVycik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF1ZHRPYmplY3QpIHtcbiAgICAgICAgICB1ZHRCdWlsZGVyLmNyZWF0ZV91ZHQodWR0S2V5LCBvcHRpb25zLnVkdHNbdWR0S2V5XSwgdWR0Q2FsbGJhY2spO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHVkdEtleXMgPSBPYmplY3Qua2V5cyhvcHRpb25zLnVkdHNbdWR0S2V5XSk7XG4gICAgICAgIGNvbnN0IHVkdFZhbHVlcyA9IF8ubWFwKF8udmFsdWVzKG9wdGlvbnMudWR0c1t1ZHRLZXldKSwgbm9ybWFsaXplci5ub3JtYWxpemVfdXNlcl9kZWZpbmVkX3R5cGUpO1xuICAgICAgICBjb25zdCBmaWVsZE5hbWVzID0gdWR0T2JqZWN0LmZpZWxkX25hbWVzO1xuICAgICAgICBjb25zdCBmaWVsZFR5cGVzID0gXy5tYXAodWR0T2JqZWN0LmZpZWxkX3R5cGVzLCBub3JtYWxpemVyLm5vcm1hbGl6ZV91c2VyX2RlZmluZWRfdHlwZSk7XG5cbiAgICAgICAgaWYgKF8uZGlmZmVyZW5jZSh1ZHRLZXlzLCBmaWVsZE5hbWVzKS5sZW5ndGggPT09IDAgJiYgXy5kaWZmZXJlbmNlKHVkdFZhbHVlcywgZmllbGRUeXBlcykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdWR0Q2FsbGJhY2soKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aHJvdyAobmV3IEVycm9yKHV0aWwuZm9ybWF0KFxuICAgICAgICAgICdVc2VyIGRlZmluZWQgdHlwZSBcIiVzXCIgYWxyZWFkeSBleGlzdHMgYnV0IGRvZXMgbm90IG1hdGNoIHRoZSB1ZHQgZGVmaW5pdGlvbi4gJyArXG4gICAgICAgICAgJ0NvbnNpZGVyIGFsdGVyaW5nIG9yIGRyb3BpbmcgdGhlIHR5cGUuJyxcbiAgICAgICAgICB1ZHRLZXksXG4gICAgICAgICkpKTtcbiAgICAgIH0pO1xuICAgIH0pKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICB9KTtcbiAgfSxcblxuICBfYXNzZXJ0X3VzZXJfZGVmaW5lZF9mdW5jdGlvbnMoY2FsbGJhY2spIHtcbiAgICBjb25zdCBjbGllbnQgPSB0aGlzLl9kZWZpbmVfY29ubmVjdGlvbjtcbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5fb3B0aW9ucztcbiAgICBjb25zdCBrZXlzcGFjZSA9IHRoaXMuX2tleXNwYWNlO1xuXG4gICAgaWYgKCFvcHRpb25zLnVkZnMpIHtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdWRmQnVpbGRlciA9IG5ldyBVZGZCdWlsZGVyKGNsaWVudCk7XG5cbiAgICBQcm9taXNlLm1hcFNlcmllcyhPYmplY3Qua2V5cyhvcHRpb25zLnVkZnMpLCAodWRmS2V5KSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjb25zdCB1ZGZDYWxsYmFjayA9IChlcnIpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJlamVjdChlcnIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKCk7XG4gICAgICB9O1xuXG4gICAgICB1ZGZCdWlsZGVyLnZhbGlkYXRlX2RlZmluaXRpb24odWRmS2V5LCBvcHRpb25zLnVkZnNbdWRmS2V5XSk7XG5cbiAgICAgIHVkZkJ1aWxkZXIuZ2V0X3VkZih1ZGZLZXksIGtleXNwYWNlLCAoZXJyLCB1ZGZPYmplY3QpID0+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHVkZkNhbGxiYWNrKGVycik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF1ZGZPYmplY3QpIHtcbiAgICAgICAgICB1ZGZCdWlsZGVyLmNyZWF0ZV91ZGYodWRmS2V5LCBvcHRpb25zLnVkZnNbdWRmS2V5XSwgdWRmQ2FsbGJhY2spO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHVkZkxhbmd1YWdlID0gb3B0aW9ucy51ZGZzW3VkZktleV0ubGFuZ3VhZ2U7XG4gICAgICAgIGNvbnN0IHJlc3VsdExhbmd1YWdlID0gdWRmT2JqZWN0Lmxhbmd1YWdlO1xuXG4gICAgICAgIGNvbnN0IHVkZkNvZGUgPSBvcHRpb25zLnVkZnNbdWRmS2V5XS5jb2RlO1xuICAgICAgICBjb25zdCByZXN1bHRDb2RlID0gdWRmT2JqZWN0LmJvZHk7XG5cbiAgICAgICAgY29uc3QgdWRmUmV0dXJuVHlwZSA9IG5vcm1hbGl6ZXIubm9ybWFsaXplX3VzZXJfZGVmaW5lZF90eXBlKG9wdGlvbnMudWRmc1t1ZGZLZXldLnJldHVyblR5cGUpO1xuICAgICAgICBjb25zdCByZXN1bHRSZXR1cm5UeXBlID0gbm9ybWFsaXplci5ub3JtYWxpemVfdXNlcl9kZWZpbmVkX3R5cGUodWRmT2JqZWN0LnJldHVybl90eXBlKTtcblxuICAgICAgICBjb25zdCB1ZGZJbnB1dHMgPSBvcHRpb25zLnVkZnNbdWRmS2V5XS5pbnB1dHMgPyBvcHRpb25zLnVkZnNbdWRmS2V5XS5pbnB1dHMgOiB7fTtcbiAgICAgICAgY29uc3QgdWRmSW5wdXRLZXlzID0gT2JqZWN0LmtleXModWRmSW5wdXRzKTtcbiAgICAgICAgY29uc3QgdWRmSW5wdXRWYWx1ZXMgPSBfLm1hcChfLnZhbHVlcyh1ZGZJbnB1dHMpLCBub3JtYWxpemVyLm5vcm1hbGl6ZV91c2VyX2RlZmluZWRfdHlwZSk7XG4gICAgICAgIGNvbnN0IHJlc3VsdEFyZ3VtZW50TmFtZXMgPSB1ZGZPYmplY3QuYXJndW1lbnRfbmFtZXM7XG4gICAgICAgIGNvbnN0IHJlc3VsdEFyZ3VtZW50VHlwZXMgPSBfLm1hcCh1ZGZPYmplY3QuYXJndW1lbnRfdHlwZXMsIG5vcm1hbGl6ZXIubm9ybWFsaXplX3VzZXJfZGVmaW5lZF90eXBlKTtcblxuICAgICAgICBpZiAodWRmTGFuZ3VhZ2UgPT09IHJlc3VsdExhbmd1YWdlICYmXG4gICAgICAgICAgdWRmQ29kZSA9PT0gcmVzdWx0Q29kZSAmJlxuICAgICAgICAgIHVkZlJldHVyblR5cGUgPT09IHJlc3VsdFJldHVyblR5cGUgJiZcbiAgICAgICAgICBfLmlzRXF1YWwodWRmSW5wdXRLZXlzLCByZXN1bHRBcmd1bWVudE5hbWVzKSAmJlxuICAgICAgICAgIF8uaXNFcXVhbCh1ZGZJbnB1dFZhbHVlcywgcmVzdWx0QXJndW1lbnRUeXBlcykpIHtcbiAgICAgICAgICB1ZGZDYWxsYmFjaygpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHVkZkJ1aWxkZXIuY3JlYXRlX3VkZih1ZGZLZXksIG9wdGlvbnMudWRmc1t1ZGZLZXldLCB1ZGZDYWxsYmFjayk7XG4gICAgICB9KTtcbiAgICB9KSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgfSk7XG4gIH0sXG5cbiAgX2Fzc2VydF91c2VyX2RlZmluZWRfYWdncmVnYXRlcyhjYWxsYmFjaykge1xuICAgIGNvbnN0IGNsaWVudCA9IHRoaXMuX2RlZmluZV9jb25uZWN0aW9uO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLl9vcHRpb25zO1xuICAgIGNvbnN0IGtleXNwYWNlID0gdGhpcy5fa2V5c3BhY2U7XG5cbiAgICBpZiAoIW9wdGlvbnMudWRhcykge1xuICAgICAgY2FsbGJhY2soKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB1ZGFCdWlsZGVyID0gbmV3IFVkYUJ1aWxkZXIoY2xpZW50KTtcblxuICAgIFByb21pc2UubWFwU2VyaWVzKE9iamVjdC5rZXlzKG9wdGlvbnMudWRhcyksICh1ZGFLZXkpID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHVkYUNhbGxiYWNrID0gKGVycikgPT4ge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJlc29sdmUoKTtcbiAgICAgIH07XG5cbiAgICAgIHVkYUJ1aWxkZXIudmFsaWRhdGVfZGVmaW5pdGlvbih1ZGFLZXksIG9wdGlvbnMudWRhc1t1ZGFLZXldKTtcblxuICAgICAgaWYgKCFvcHRpb25zLnVkYXNbdWRhS2V5XS5pbml0Y29uZCkge1xuICAgICAgICBvcHRpb25zLnVkYXNbdWRhS2V5XS5pbml0Y29uZCA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIHVkYUJ1aWxkZXIuZ2V0X3VkYSh1ZGFLZXksIGtleXNwYWNlLCAoZXJyLCB1ZGFPYmplY3RzKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICB1ZGFDYWxsYmFjayhlcnIpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdWRhT2JqZWN0cykge1xuICAgICAgICAgIHVkYUJ1aWxkZXIuY3JlYXRlX3VkYSh1ZGFLZXksIG9wdGlvbnMudWRhc1t1ZGFLZXldLCB1ZGFDYWxsYmFjayk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaW5wdXRUeXBlcyA9IF8ubWFwKG9wdGlvbnMudWRhc1t1ZGFLZXldLmlucHV0X3R5cGVzLCBub3JtYWxpemVyLm5vcm1hbGl6ZV91c2VyX2RlZmluZWRfdHlwZSk7XG4gICAgICAgIGNvbnN0IHNmdW5jID0gb3B0aW9ucy51ZGFzW3VkYUtleV0uc2Z1bmMudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3Qgc3R5cGUgPSBub3JtYWxpemVyLm5vcm1hbGl6ZV91c2VyX2RlZmluZWRfdHlwZShvcHRpb25zLnVkYXNbdWRhS2V5XS5zdHlwZSk7XG4gICAgICAgIGNvbnN0IGZpbmFsZnVuYyA9IG9wdGlvbnMudWRhc1t1ZGFLZXldLmZpbmFsZnVuYyA/IG9wdGlvbnMudWRhc1t1ZGFLZXldLmZpbmFsZnVuYy50b0xvd2VyQ2FzZSgpIDogbnVsbDtcbiAgICAgICAgY29uc3QgaW5pdGNvbmQgPSBvcHRpb25zLnVkYXNbdWRhS2V5XS5pbml0Y29uZCA/IG9wdGlvbnMudWRhc1t1ZGFLZXldLmluaXRjb25kLnJlcGxhY2UoL1tcXHNdL2csICcnKSA6IG51bGw7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1ZGFPYmplY3RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0QXJndW1lbnRUeXBlcyA9IF8ubWFwKHVkYU9iamVjdHNbaV0uYXJndW1lbnRfdHlwZXMsIG5vcm1hbGl6ZXIubm9ybWFsaXplX3VzZXJfZGVmaW5lZF90eXBlKTtcblxuICAgICAgICAgIGNvbnN0IHJlc3VsdFN0YXRlRnVuYyA9IHVkYU9iamVjdHNbaV0uc3RhdGVfZnVuYztcbiAgICAgICAgICBjb25zdCByZXN1bHRTdGF0ZVR5cGUgPSBub3JtYWxpemVyLm5vcm1hbGl6ZV91c2VyX2RlZmluZWRfdHlwZSh1ZGFPYmplY3RzW2ldLnN0YXRlX3R5cGUpO1xuICAgICAgICAgIGNvbnN0IHJlc3VsdEZpbmFsRnVuYyA9IHVkYU9iamVjdHNbaV0uZmluYWxfZnVuYztcbiAgICAgICAgICBjb25zdCByZXN1bHRJbml0Y29uZCA9IHVkYU9iamVjdHNbaV0uaW5pdGNvbmQgPyB1ZGFPYmplY3RzW2ldLmluaXRjb25kLnJlcGxhY2UoL1tcXHNdL2csICcnKSA6IG51bGw7XG5cbiAgICAgICAgICBpZiAoc2Z1bmMgPT09IHJlc3VsdFN0YXRlRnVuYyAmJlxuICAgICAgICAgICAgc3R5cGUgPT09IHJlc3VsdFN0YXRlVHlwZSAmJlxuICAgICAgICAgICAgZmluYWxmdW5jID09PSByZXN1bHRGaW5hbEZ1bmMgJiZcbiAgICAgICAgICAgIGluaXRjb25kID09PSByZXN1bHRJbml0Y29uZCAmJlxuICAgICAgICAgICAgXy5pc0VxdWFsKGlucHV0VHlwZXMsIHJlc3VsdEFyZ3VtZW50VHlwZXMpKSB7XG4gICAgICAgICAgICB1ZGFDYWxsYmFjaygpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB1ZGFCdWlsZGVyLmNyZWF0ZV91ZGEodWRhS2V5LCBvcHRpb25zLnVkYXNbdWRhS2V5XSwgdWRhQ2FsbGJhY2spO1xuICAgICAgfSk7XG4gICAgfSkpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH0pO1xuICB9LFxuXG4gIF9zZXRfY2xpZW50KGNsaWVudCkge1xuICAgIGNvbnN0IGRlZmluZUNvbm5lY3Rpb25PcHRpb25zID0gXy5jbG9uZURlZXAodGhpcy5fY29ubmVjdGlvbik7XG5cbiAgICB0aGlzLl9jbGllbnQgPSBjbGllbnQ7XG4gICAgdGhpcy5fZGVmaW5lX2Nvbm5lY3Rpb24gPSBuZXcgY3FsLkNsaWVudChkZWZpbmVDb25uZWN0aW9uT3B0aW9ucyk7XG5cbiAgICAvLyBSZXNldCBjb25uZWN0aW9ucyBvbiBhbGwgbW9kZWxzXG4gICAgT2JqZWN0LmtleXModGhpcy5fbW9kZWxzKS5mb3JFYWNoKChpKSA9PiB7XG4gICAgICB0aGlzLl9tb2RlbHNbaV0uX3Byb3BlcnRpZXMuY3FsID0gdGhpcy5fY2xpZW50O1xuICAgICAgdGhpcy5fbW9kZWxzW2ldLl9wcm9wZXJ0aWVzLmRlZmluZV9jb25uZWN0aW9uID0gdGhpcy5fZGVmaW5lX2Nvbm5lY3Rpb247XG4gICAgfSk7XG4gIH0sXG5cbiAgaW5pdChjYWxsYmFjaykge1xuICAgIGNvbnN0IG9uVXNlckRlZmluZWRBZ2dyZWdhdGVzID0gKGVycikgPT4ge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1hbmFnZW1lbnRUYXNrcyA9IFtdO1xuICAgICAgaWYgKHRoaXMuX2tleXNwYWNlICYmIHRoaXMuX29wdGlvbnMubWFuYWdlRVNJbmRleCkge1xuICAgICAgICB0aGlzLmFzc2VydEVTSW5kZXhBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KHRoaXMuX2Fzc2VydF9lc19pbmRleCk7XG4gICAgICAgIG1hbmFnZW1lbnRUYXNrcy5wdXNoKHRoaXMuYXNzZXJ0RVNJbmRleEFzeW5jKCkpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuX2tleXNwYWNlICYmIHRoaXMuX29wdGlvbnMubWFuYWdlR3JhcGhzKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0R3JlbWxpbkdyYXBoQXN5bmMgPSBQcm9taXNlLnByb21pc2lmeSh0aGlzLl9hc3NlcnRfZ3JlbWxpbl9ncmFwaCk7XG4gICAgICAgIG1hbmFnZW1lbnRUYXNrcy5wdXNoKHRoaXMuYXNzZXJ0R3JlbWxpbkdyYXBoQXN5bmMoKSk7XG4gICAgICB9XG4gICAgICBQcm9taXNlLmFsbChtYW5hZ2VtZW50VGFza3MpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCB0aGlzKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIxKSA9PiB7XG4gICAgICAgICAgY2FsbGJhY2soZXJyMSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjb25zdCBvblVzZXJEZWZpbmVkRnVuY3Rpb25zID0gZnVuY3Rpb24gZihlcnIpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5fYXNzZXJ0X3VzZXJfZGVmaW5lZF9hZ2dyZWdhdGVzKG9uVXNlckRlZmluZWRBZ2dyZWdhdGVzLmJpbmQodGhpcykpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwudmFsaWRhdG9yLmludmFsaWR1ZGEnLCBlLm1lc3NhZ2UpKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3Qgb25Vc2VyRGVmaW5lZFR5cGVzID0gZnVuY3Rpb24gZihlcnIpIHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5fYXNzZXJ0X3VzZXJfZGVmaW5lZF9mdW5jdGlvbnMob25Vc2VyRGVmaW5lZEZ1bmN0aW9ucy5iaW5kKHRoaXMpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLnZhbGlkYXRvci5pbnZhbGlkdWRmJywgZS5tZXNzYWdlKSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IG9uS2V5c3BhY2UgPSBmdW5jdGlvbiBmKGVycikge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjYWxsYmFjayhlcnIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLl9zZXRfY2xpZW50KG5ldyBjcWwuQ2xpZW50KHRoaXMuX2Nvbm5lY3Rpb24pKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuX2Fzc2VydF91c2VyX2RlZmluZWRfdHlwZXMob25Vc2VyRGVmaW5lZFR5cGVzLmJpbmQodGhpcykpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB0aHJvdyAoYnVpbGRFcnJvcignbW9kZWwudmFsaWRhdG9yLmludmFsaWR1ZHQnLCBlLm1lc3NhZ2UpKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgaWYgKHRoaXMuX2tleXNwYWNlICYmIHRoaXMuX29wdGlvbnMuY3JlYXRlS2V5c3BhY2UgIT09IGZhbHNlKSB7XG4gICAgICB0aGlzLl9hc3NlcnRfa2V5c3BhY2Uob25LZXlzcGFjZS5iaW5kKHRoaXMpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgb25LZXlzcGFjZS5jYWxsKHRoaXMpO1xuICAgIH1cbiAgfSxcblxuICBhZGRNb2RlbChtb2RlbE5hbWUsIG1vZGVsU2NoZW1hKSB7XG4gICAgaWYgKCFtb2RlbE5hbWUgfHwgdHlwZW9mIChtb2RlbE5hbWUpICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhyb3cgKGJ1aWxkRXJyb3IoJ21vZGVsLnZhbGlkYXRvci5pbnZhbGlkc2NoZW1hJywgJ01vZGVsIG5hbWUgbXVzdCBiZSBhIHZhbGlkIHN0cmluZycpKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgc2NoZW1lci52YWxpZGF0ZV9tb2RlbF9zY2hlbWEobW9kZWxTY2hlbWEpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRocm93IChidWlsZEVycm9yKCdtb2RlbC52YWxpZGF0b3IuaW52YWxpZHNjaGVtYScsIGUubWVzc2FnZSkpO1xuICAgIH1cblxuICAgIGlmIChtb2RlbFNjaGVtYS5vcHRpb25zICYmIG1vZGVsU2NoZW1hLm9wdGlvbnMudGltZXN0YW1wcykge1xuICAgICAgY29uc3QgdGltZXN0YW1wT3B0aW9ucyA9IHtcbiAgICAgICAgY3JlYXRlZEF0OiBtb2RlbFNjaGVtYS5vcHRpb25zLnRpbWVzdGFtcHMuY3JlYXRlZEF0IHx8ICdjcmVhdGVkQXQnLFxuICAgICAgICB1cGRhdGVkQXQ6IG1vZGVsU2NoZW1hLm9wdGlvbnMudGltZXN0YW1wcy51cGRhdGVkQXQgfHwgJ3VwZGF0ZWRBdCcsXG4gICAgICB9O1xuICAgICAgbW9kZWxTY2hlbWEub3B0aW9ucy50aW1lc3RhbXBzID0gdGltZXN0YW1wT3B0aW9ucztcblxuICAgICAgbW9kZWxTY2hlbWEuZmllbGRzW21vZGVsU2NoZW1hLm9wdGlvbnMudGltZXN0YW1wcy5jcmVhdGVkQXRdID0ge1xuICAgICAgICB0eXBlOiAndGltZXN0YW1wJyxcbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICRkYl9mdW5jdGlvbjogJ3RvVGltZXN0YW1wKG5vdygpKScsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgICAgbW9kZWxTY2hlbWEuZmllbGRzW21vZGVsU2NoZW1hLm9wdGlvbnMudGltZXN0YW1wcy51cGRhdGVkQXRdID0ge1xuICAgICAgICB0eXBlOiAndGltZXN0YW1wJyxcbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICRkYl9mdW5jdGlvbjogJ3RvVGltZXN0YW1wKG5vdygpKScsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChtb2RlbFNjaGVtYS5vcHRpb25zICYmIG1vZGVsU2NoZW1hLm9wdGlvbnMudmVyc2lvbnMpIHtcbiAgICAgIGNvbnN0IHZlcnNpb25PcHRpb25zID0ge1xuICAgICAgICBrZXk6IG1vZGVsU2NoZW1hLm9wdGlvbnMudmVyc2lvbnMua2V5IHx8ICdfX3YnLFxuICAgICAgfTtcbiAgICAgIG1vZGVsU2NoZW1hLm9wdGlvbnMudmVyc2lvbnMgPSB2ZXJzaW9uT3B0aW9ucztcblxuICAgICAgbW9kZWxTY2hlbWEuZmllbGRzW21vZGVsU2NoZW1hLm9wdGlvbnMudmVyc2lvbnMua2V5XSA9IHtcbiAgICAgICAgdHlwZTogJ3RpbWV1dWlkJyxcbiAgICAgICAgZGVmYXVsdDoge1xuICAgICAgICAgICRkYl9mdW5jdGlvbjogJ25vdygpJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgYmFzZVByb3BlcnRpZXMgPSB7XG4gICAgICBuYW1lOiBtb2RlbE5hbWUsXG4gICAgICBzY2hlbWE6IG1vZGVsU2NoZW1hLFxuICAgICAga2V5c3BhY2U6IHRoaXMuX2tleXNwYWNlLFxuICAgICAgZGVmaW5lX2Nvbm5lY3Rpb246IHRoaXMuX2RlZmluZV9jb25uZWN0aW9uLFxuICAgICAgY3FsOiB0aGlzLl9jbGllbnQsXG4gICAgICBlc2NsaWVudDogdGhpcy5fZXNjbGllbnQsXG4gICAgICBncmVtbGluX2NsaWVudDogdGhpcy5fZ3JlbWxpbl9jbGllbnQsXG4gICAgICBnZXRfY29uc3RydWN0b3I6IHRoaXMuZ2V0TW9kZWwuYmluZCh0aGlzLCBtb2RlbE5hbWUpLFxuICAgICAgaW5pdDogdGhpcy5pbml0LmJpbmQodGhpcyksXG4gICAgICBkcm9wVGFibGVPblNjaGVtYUNoYW5nZTogdGhpcy5fb3B0aW9ucy5kcm9wVGFibGVPblNjaGVtYUNoYW5nZSxcbiAgICAgIGNyZWF0ZVRhYmxlOiB0aGlzLl9vcHRpb25zLmNyZWF0ZVRhYmxlLFxuICAgICAgbWlncmF0aW9uOiB0aGlzLl9vcHRpb25zLm1pZ3JhdGlvbixcbiAgICAgIGRpc2FibGVUVFlDb25maXJtYXRpb246IHRoaXMuX29wdGlvbnMuZGlzYWJsZVRUWUNvbmZpcm1hdGlvbixcbiAgICB9O1xuXG4gICAgdGhpcy5fbW9kZWxzW21vZGVsTmFtZV0gPSB0aGlzLl9nZW5lcmF0ZV9tb2RlbChiYXNlUHJvcGVydGllcyk7XG4gICAgcmV0dXJuIHRoaXMuX21vZGVsc1ttb2RlbE5hbWVdO1xuICB9LFxuXG4gIGdldE1vZGVsKG1vZGVsTmFtZSkge1xuICAgIHJldHVybiB0aGlzLl9tb2RlbHNbbW9kZWxOYW1lXSB8fCBudWxsO1xuICB9LFxuXG4gIGNsb3NlKGNhbGxiYWNrKSB7XG4gICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBub29wO1xuXG4gICAgaWYgKHRoaXMub3JtLl9lc2NsaWVudCkge1xuICAgICAgdGhpcy5vcm0uX2VzY2xpZW50LmNsb3NlKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMub3JtLl9ncmVtbGluX2NsaWVudCAmJiB0aGlzLm9ybS5fZ3JlbWxpbl9jbGllbnQuY29ubmVjdGlvbiAmJiB0aGlzLm9ybS5fZ3JlbWxpbl9jbGllbnQuY29ubmVjdGlvbi53cykge1xuICAgICAgdGhpcy5vcm0uX2dyZW1saW5fY2xpZW50LmNvbm5lY3Rpb24ud3MuY2xvc2UoKTtcbiAgICB9XG5cbiAgICBjb25zdCBjbGllbnRzVG9TaHV0ZG93biA9IFtdO1xuICAgIGlmICh0aGlzLm9ybS5fY2xpZW50KSB7XG4gICAgICBjbGllbnRzVG9TaHV0ZG93bi5wdXNoKHRoaXMub3JtLl9jbGllbnQuc2h1dGRvd24oKSk7XG4gICAgfVxuICAgIGlmICh0aGlzLm9ybS5fZGVmaW5lX2Nvbm5lY3Rpb24pIHtcbiAgICAgIGNsaWVudHNUb1NodXRkb3duLnB1c2godGhpcy5vcm0uX2RlZmluZV9jb25uZWN0aW9uLnNodXRkb3duKCkpO1xuICAgIH1cblxuICAgIFByb21pc2UuYWxsKGNsaWVudHNUb1NodXRkb3duKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICB9KTtcbiAgfSxcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gQXBvbGxvO1xuIl19