'use strict';

var datatypes = require('../validators/datatypes');
var _ = require('lodash');
var util = require('util');

var schemer = {
  normalize_model_schema: function normalize_model_schema(modelSchema) {
    var outputSchema = _.cloneDeep(modelSchema, true);
    var goodFields = {
      fields: true,
      key: true,
      clustering_order: true,
      materialized_views: true,
      indexes: true,
      custom_index: true,
      custom_indexes: true
    };

    Object.keys(outputSchema).forEach(function (k) {
      if (!(k in goodFields)) delete outputSchema[k];
    });

    Object.keys(outputSchema.fields).forEach(function (k) {
      if (typeof outputSchema.fields[k] === 'string') {
        outputSchema.fields[k] = { type: outputSchema.fields[k] };
      } else if (outputSchema.fields[k]) {
        if (outputSchema.fields[k].virtual) {
          delete outputSchema.fields[k];
        } else if (outputSchema.fields[k].typeDef) {
          outputSchema.fields[k] = { type: outputSchema.fields[k].type, typeDef: outputSchema.fields[k].typeDef };
        } else {
          outputSchema.fields[k] = { type: outputSchema.fields[k].type };
        }
      } else {
        throw new Error(util.format('schema field "%s" is not properly defined: %s', k, outputSchema.fields[k]));
      }

      if (k === 'solr_query') {
        delete outputSchema.fields[k];
      }

      if (outputSchema.fields[k] && outputSchema.fields[k].type === 'varchar') {
        outputSchema.fields[k].type = 'text';
      }

      if (outputSchema.fields[k] && ['map', 'list', 'set', 'frozen'].includes(outputSchema.fields[k].type)) {
        if (modelSchema.typeMaps && modelSchema.typeMaps[k]) {
          outputSchema.fields[k].typeDef = modelSchema.typeMaps[k];
        } else {
          // eslint-disable-next-line max-len
          outputSchema.fields[k].typeDef = outputSchema.fields[k].typeDef.replace(/[\s]/g, '').replace(/varchar/g, 'text');
        }
      }

      if (outputSchema.fields[k]) {
        if (modelSchema.staticMaps && modelSchema.staticMaps[k] === true) {
          outputSchema.fields[k].static = true;
        } else if (modelSchema.fields[k].static) {
          outputSchema.fields[k].static = true;
        }
      }
    });

    if (outputSchema.key && typeof outputSchema.key[0] === 'string') {
      outputSchema.key[0] = [outputSchema.key[0]];
    }

    if (outputSchema.key && outputSchema.key.length) {
      for (var i = 1; i < outputSchema.key.length; i++) {
        if (!outputSchema.clustering_order) outputSchema.clustering_order = {};
        if (!outputSchema.clustering_order[outputSchema.key[i]]) {
          outputSchema.clustering_order[outputSchema.key[i]] = 'ASC';
        }

        // eslint-disable-next-line max-len
        outputSchema.clustering_order[outputSchema.key[i]] = outputSchema.clustering_order[outputSchema.key[i]].toUpperCase();
      }
    }

    var arraySort = function arraySort(a, b) {
      if (a > b) return 1;
      if (a < b) return -1;
      return 0;
    };

    if (outputSchema.materialized_views) {
      Object.keys(outputSchema.materialized_views).forEach(function (mvindex) {
        var outputMView = outputSchema.materialized_views[mvindex];
        // make parition key an array
        if (outputMView.key && typeof outputMView.key[0] === 'string') {
          outputMView.key[0] = [outputMView.key[0]];
        }

        // add clustering_order for all clustering keys
        if (outputMView.key && outputMView.key.length) {
          for (var _i = 1; _i < outputMView.key.length; _i++) {
            if (!outputMView.clustering_order) {
              outputMView.clustering_order = {};
            }
            if (!outputMView.clustering_order[outputMView.key[_i]]) {
              outputMView.clustering_order[outputMView.key[_i]] = 'ASC';
            }
            // eslint-disable-next-line max-len
            outputMView.clustering_order[outputMView.key[_i]] = outputMView.clustering_order[outputMView.key[_i]].toUpperCase();
          }
        }

        // add all non existent primary key items to select and sort them
        for (var pkeyIndex = 0; pkeyIndex < outputMView.key.length; pkeyIndex++) {
          if (pkeyIndex === 0) {
            for (var partitionIndex = 0; partitionIndex < outputMView.key[pkeyIndex].length; partitionIndex++) {
              if (!outputMView.select.includes(outputMView.key[pkeyIndex][partitionIndex])) {
                outputMView.select.push(outputMView.key[pkeyIndex][partitionIndex]);
              }
            }
          } else if (!outputMView.select.includes(outputMView.key[pkeyIndex])) {
            outputMView.select.push(outputMView.key[pkeyIndex]);
          }
        }

        // check if select has * and then add all fields to select
        if (outputMView.select[0] === '*') {
          outputMView.select = Object.keys(outputSchema.fields);
        }

        outputMView.select.sort(arraySort);
      });
    } else {
      outputSchema.materialized_views = {};
    }

    if (outputSchema.indexes) {
      for (var _i2 = 0; _i2 < outputSchema.indexes.length; _i2++) {
        var indexNameList = outputSchema.indexes[_i2].replace(/["\s]/g, '').split(/[()]/g);
        if (indexNameList.length > 1) {
          indexNameList[0] = indexNameList[0].toLowerCase();
          if (indexNameList[0] === 'values') outputSchema.indexes[_i2] = indexNameList[1];else outputSchema.indexes[_i2] = util.format('%s(%s)', indexNameList[0], indexNameList[1]);
        } else {
          outputSchema.indexes[_i2] = indexNameList[0];
        }
      }
      outputSchema.indexes.sort(arraySort);
    } else {
      outputSchema.indexes = [];
    }

    if (outputSchema.custom_index) {
      outputSchema.custom_indexes = [outputSchema.custom_index];
      delete outputSchema.custom_index;
    }

    if (outputSchema.custom_indexes) {
      var customArraySort = function customArraySort(a, b) {
        if (a.on > b.on) return 1;
        if (a.on < b.on) return -1;

        if (a.using > b.using) return 1;
        if (a.using < b.using) return -1;

        if (a.options > b.options) return 1;
        if (a.options < b.options) return -1;

        return 0;
      };

      outputSchema.custom_indexes.sort(customArraySort);
    } else {
      outputSchema.custom_indexes = [];
    }

    outputSchema.custom_indexes = _.remove(outputSchema.custom_indexes, function (cindex) {
      return cindex.on !== 'solr_query';
    });

    return outputSchema;
  },
  validate_model_schema: function validate_model_schema(modelSchema) {
    var _this = this;

    if (!modelSchema) throw new Error('A schema must be specified');

    if (!_.isPlainObject(modelSchema.fields) || Object.keys(modelSchema.fields).length === 0) {
      throw new Error('Schema must contain a non-empty "fields" map object');
    }

    if (!modelSchema.key || !(modelSchema.key instanceof Array)) {
      throw new Error('Schema must contain "key" in the form: [ [partitionkey1, ...], clusteringkey1, ...]');
    }

    Object.keys(modelSchema.fields).forEach(function (k) {
      var fieldtype = _this.get_field_type(modelSchema, k);
      if (!(fieldtype in datatypes)) {
        throw new Error(util.format('Given schema field type is not supported for: %s(%s)', k, modelSchema.fields[k].type));
      }
      if (!_this.is_field_default_value_valid(modelSchema, k)) {
        throw new Error(util.format('Invalid defult definition for: %s(%s)', k, modelSchema.fields[k].type));
      }
    });

    // validate primary key
    if (typeof modelSchema.key[0] === 'string') {
      if (!(modelSchema.key[0] in modelSchema.fields)) {
        throw new Error('Partition Key must also be a valid field name');
      }
      if (modelSchema.fields[modelSchema.key[0]].virtual) {
        throw new Error("Partition Key must also be a db field name, can't be a virtual field name");
      }
    } else if (modelSchema.key[0] instanceof Array) {
      if (modelSchema.key[0].length === 0) {
        throw new Error("Partition Key array can't be empty");
      }
      for (var j = 0; j < modelSchema.key[0].length; j++) {
        if (typeof modelSchema.key[0][j] !== 'string' || !(modelSchema.key[0][j] in modelSchema.fields)) {
          throw new Error('Partition Key array must contain only valid field names');
        }
        if (modelSchema.fields[modelSchema.key[0][j]].virtual) {
          throw new Error("Partition Key array must contain only db field names, can't contain virtual field names");
        }
      }
    } else {
      throw new Error('Partition Key must be a field name string, or array of field names');
    }

    for (var i = 0; i < modelSchema.key.length; i++) {
      if (i > 0) {
        if (typeof modelSchema.key[i] !== 'string' || !(modelSchema.key[i] in modelSchema.fields)) {
          throw new Error('Clustering Keys must be valid field names');
        }
        if (modelSchema.fields[modelSchema.key[i]].virtual) {
          throw new Error("Clustering Keys must be db field names, can't be virtual field names");
        }
      }
    }

    if (modelSchema.clustering_order) {
      if (!_.isPlainObject(modelSchema.clustering_order)) {
        throw new Error('clustering_order must be an object of clustering_key attributes');
      }

      Object.keys(modelSchema.clustering_order).forEach(function (cindex) {
        if (!['asc', 'desc'].includes(modelSchema.clustering_order[cindex].toLowerCase())) {
          throw new Error('clustering_order attribute values can only be ASC or DESC');
        }
        if (modelSchema.key.indexOf(cindex) < 1) {
          throw new Error('clustering_order field attributes must be clustering keys only');
        }
      });
    }

    // validate materialized_view
    if (modelSchema.materialized_views) {
      if (!_.isPlainObject(modelSchema.materialized_views)) {
        throw new Error('materialized_views must be an object with view names as attributes');
      }

      Object.keys(modelSchema.materialized_views).forEach(function (mvindex) {
        var candidateMView = modelSchema.materialized_views[mvindex];
        if (!_.isPlainObject(candidateMView)) {
          throw new Error(util.format('attribute "%s" under materialized_views must be an object', mvindex));
        }

        if (!candidateMView.select || !candidateMView.key) {
          throw new Error(util.format('materialized_view "%s" must have "select" and "key" attributes', mvindex));
        }

        if (!(candidateMView.select instanceof Array) || !(candidateMView.key instanceof Array)) {
          throw new Error(util.format('"select" and "key" attributes must be an array under attribute %s of materialized_views', mvindex));
        }

        for (var selectindex = 0; selectindex < candidateMView.select.length; selectindex++) {
          if (typeof candidateMView.select[selectindex] !== 'string' || !(candidateMView.select[selectindex] in modelSchema.fields || candidateMView.select[selectindex] === '*')) {
            throw new Error(util.format('the select attribute under materialized_view %s must be an array of field name strings or ["*"]', mvindex));
          }

          if (modelSchema.fields[candidateMView.select[selectindex]] && modelSchema.fields[candidateMView.select[selectindex]].virtual) {
            throw new Error(util.format('the select attribute under %s of materialized_views must be an array of db field names, ' + 'cannot contain any virtual field name', mvindex));
          }
        }

        // validate materialized_view primary key
        if (typeof candidateMView.key[0] === 'string') {
          if (!(candidateMView.key[0] in modelSchema.fields)) {
            throw new Error(util.format('materialized_view %s: partition key string must match a valid field name', mvindex));
          }
          if (modelSchema.fields[candidateMView.key[0]].virtual) {
            throw new Error(util.format('materialized_view %s: partition key must match a db field name, cannot be a virtual field name', mvindex));
          }
        } else if (candidateMView.key[0] instanceof Array) {
          if (candidateMView.key[0].length === 0) {
            throw new Error(util.format('materialized_view %s: partition key array cannot be empty', mvindex));
          }
          for (var _j = 0; _j < candidateMView.key[0].length; _j++) {
            if (typeof candidateMView.key[0][_j] !== 'string' || !(candidateMView.key[0][_j] in modelSchema.fields)) {
              throw new Error(util.format('materialized_view %s: partition key array must contain only valid field names', mvindex));
            }
            if (modelSchema.fields[candidateMView.key[0][_j]].virtual) {
              throw new Error(util.format('materialized_view %s: partition key array must contain only db field names, ' + 'cannot contain virtual field names', mvindex));
            }
          }
        } else {
          throw new Error(util.format('materialized_view %s: partition key must be a field name string, or array of field names', mvindex));
        }

        for (var _i3 = 0; _i3 < candidateMView.key.length; _i3++) {
          if (_i3 > 0) {
            if (typeof candidateMView.key[_i3] !== 'string' || !(candidateMView.key[_i3] in modelSchema.fields)) {
              throw new Error(util.format('materialized_view %s: clustering keys must be valid field names', mvindex));
            }
            if (modelSchema.fields[candidateMView.key[_i3]].virtual) {
              throw new Error(util.format('materialized_view %s: clustering keys must be db field names, cannot contain virtual fields', mvindex));
            }
          }
        }

        if (candidateMView.clustering_order) {
          if (!_.isPlainObject(candidateMView.clustering_order)) {
            throw new Error(util.format('materialized_view %s: clustering_order must be an object of clustering_key attributes', mvindex));
          }

          Object.keys(candidateMView.clustering_order).forEach(function (cindex) {
            if (!['asc', 'desc'].includes(candidateMView.clustering_order[cindex].toLowerCase())) {
              throw new Error(util.format('materialized_view %s: clustering_order attribute values can only be ASC or DESC', mvindex));
            }
            if (candidateMView.key.indexOf(cindex) < 1) {
              throw new Error(util.format('materialized_view %s: clustering_order field attributes must be clustering keys only', mvindex));
            }
          });
        }
      });
    }

    // validate indexes
    if (modelSchema.indexes) {
      if (!(modelSchema.indexes instanceof Array)) {
        throw new Error('indexes must be an array of field name strings');
      }

      for (var l = 0; l < modelSchema.indexes.length; l++) {
        if (typeof modelSchema.indexes[l] !== 'string') {
          throw new Error('indexes must be an array of strings');
        }

        var indexNameList = modelSchema.indexes[l].replace(/["\s]/g, '').split(/[()]/g);
        if (indexNameList.length > 1) {
          indexNameList[0] = indexNameList[0].toLowerCase();
          if (!['entries', 'keys', 'values', 'full'].includes(indexNameList[0])) {
            throw new Error(util.format('index "%s" is not defined properly', modelSchema.indexes[l]));
          }
          if (!_.has(modelSchema.fields, indexNameList[1])) {
            throw new Error(util.format('"%s" is not a valid field name, indexes must be defined on field names', indexNameList[1]));
          }
          if (modelSchema.fields[indexNameList[1]].virtual) {
            throw new Error("indexes must be an array of db field names, can't contain virtual fields");
          }
        } else {
          if (!_.has(modelSchema.fields, indexNameList[0])) {
            throw new Error(util.format('"%s" is not a valid field, indexes must be defined on field names', indexNameList[0]));
          }
          if (modelSchema.fields[indexNameList[0]].virtual) {
            throw new Error("indexes must be an array of db field names, can't contain virtual fields");
          }
        }
      }
    }

    var validateCustomIndex = function validateCustomIndex(customIndex) {
      if (!_.isPlainObject(customIndex)) {
        throw new Error('custom_index must be an object with proper indexing attributes');
      }
      if (typeof customIndex.on !== 'string' || !(customIndex.on in modelSchema.fields)) {
        throw new Error("custom_index must have an 'on' attribute with string value and value must be a valid field name");
      }
      if (modelSchema.fields[customIndex.on].virtual) {
        throw new Error("custom_index 'on' attribute must be a db field name, can't contain virtual fields");
      }
      if (typeof customIndex.using !== 'string') {
        throw new Error("custom_index must have a 'using' attribute with string value");
      }
      if (!_.isPlainObject(customIndex.options)) {
        throw new Error('custom_index must have an "options" attribute and it must be an object, ' + 'pass blank {} object if no options are required');
      }
    };

    if (modelSchema.custom_index && modelSchema.custom_indexes) {
      throw new Error('both custom_index and custom_indexes are defined in schema, only one of them should be defined');
    }

    if (modelSchema.custom_index) {
      validateCustomIndex(modelSchema.custom_index);
    }

    if (modelSchema.custom_indexes) {
      if (modelSchema.custom_indexes instanceof Array) {
        for (var ci = 0; ci < modelSchema.custom_indexes.length; ci++) {
          validateCustomIndex(modelSchema.custom_indexes[ci]);
        }
      } else {
        throw new Error('custom_indexes must be an array with objects with proper indexing attributes');
      }
    }
  },
  get_field_type: function get_field_type(modelSchema, fieldname) {
    var fieldob = modelSchema.fields[fieldname];

    if (typeof fieldob === 'string') return fieldob;else if (_.isPlainObject(fieldob)) return fieldob.type;
    throw new Error(util.format('Field type not defined for field "%s"', fieldname));
  },
  is_field_default_value_valid: function is_field_default_value_valid(modelSchema, fieldname) {
    if (_.isPlainObject(modelSchema.fields[fieldname]) && modelSchema.fields[fieldname].default) {
      if (_.isPlainObject(modelSchema.fields[fieldname].default) && !modelSchema.fields[fieldname].default.$db_function) {
        return ['map', 'list', 'set', 'frozen'].includes(modelSchema.fields[fieldname].type);
      }
      return true;
    }
    return true;
  }
};

module.exports = schemer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcm0vYXBvbGxvX3NjaGVtZXIuanMiXSwibmFtZXMiOlsiZGF0YXR5cGVzIiwicmVxdWlyZSIsIl8iLCJ1dGlsIiwic2NoZW1lciIsIm5vcm1hbGl6ZV9tb2RlbF9zY2hlbWEiLCJtb2RlbFNjaGVtYSIsIm91dHB1dFNjaGVtYSIsImNsb25lRGVlcCIsImdvb2RGaWVsZHMiLCJmaWVsZHMiLCJrZXkiLCJjbHVzdGVyaW5nX29yZGVyIiwibWF0ZXJpYWxpemVkX3ZpZXdzIiwiaW5kZXhlcyIsImN1c3RvbV9pbmRleCIsImN1c3RvbV9pbmRleGVzIiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJrIiwidHlwZSIsInZpcnR1YWwiLCJ0eXBlRGVmIiwiRXJyb3IiLCJmb3JtYXQiLCJpbmNsdWRlcyIsInR5cGVNYXBzIiwicmVwbGFjZSIsInN0YXRpY01hcHMiLCJzdGF0aWMiLCJsZW5ndGgiLCJpIiwidG9VcHBlckNhc2UiLCJhcnJheVNvcnQiLCJhIiwiYiIsIm12aW5kZXgiLCJvdXRwdXRNVmlldyIsInBrZXlJbmRleCIsInBhcnRpdGlvbkluZGV4Iiwic2VsZWN0IiwicHVzaCIsInNvcnQiLCJpbmRleE5hbWVMaXN0Iiwic3BsaXQiLCJ0b0xvd2VyQ2FzZSIsImN1c3RvbUFycmF5U29ydCIsIm9uIiwidXNpbmciLCJvcHRpb25zIiwicmVtb3ZlIiwiY2luZGV4IiwidmFsaWRhdGVfbW9kZWxfc2NoZW1hIiwiaXNQbGFpbk9iamVjdCIsIkFycmF5IiwiZmllbGR0eXBlIiwiZ2V0X2ZpZWxkX3R5cGUiLCJpc19maWVsZF9kZWZhdWx0X3ZhbHVlX3ZhbGlkIiwiaiIsImluZGV4T2YiLCJjYW5kaWRhdGVNVmlldyIsInNlbGVjdGluZGV4IiwibCIsImhhcyIsInZhbGlkYXRlQ3VzdG9tSW5kZXgiLCJjdXN0b21JbmRleCIsImNpIiwiZmllbGRuYW1lIiwiZmllbGRvYiIsImRlZmF1bHQiLCIkZGJfZnVuY3Rpb24iLCJtb2R1bGUiLCJleHBv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IjpbImNvbnN0IGRhdGF0eXBlcyA9IHJlcXVpcmUoJy4uL3ZhbGlkYXRvcnMvZGF0YXR5cGVzJyk7XG5jb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5jb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpO1xuXG5jb25zdCBzY2hlbWVyID0ge1xuXG4gIG5vcm1hbGl6ZV9tb2RlbF9zY2hlbWEobW9kZWxTY2hlbWEpIHtcbiAgICBjb25zdCBvdXRwdXRTY2hlbWEgPSBfLmNsb25lRGVlcChtb2RlbFNjaGVtYSwgdHJ1ZSk7XG4gICAgY29uc3QgZ29vZEZpZWxkcyA9IHtcbiAgICAgIGZpZWxkczogdHJ1ZSxcbiAgICAgIGtleTogdHJ1ZSxcbiAgICAgIGNsdXN0ZXJpbmdfb3JkZXI6IHRydWUsXG4gICAgICBtYXRlcmlhbGl6ZWRfdmlld3M6IHRydWUsXG4gICAgICBpbmRleGVzOiB0cnVlLFxuICAgICAgY3VzdG9tX2luZGV4OiB0cnVlLFxuICAgICAgY3VzdG9tX2luZGV4ZXM6IHRydWUsXG4gICAgfTtcblxuICAgIE9iamVjdC5rZXlzKG91dHB1dFNjaGVtYSkuZm9yRWFjaCgoaykgPT4ge1xuICAgICAgaWYgKCEoayBpbiBnb29kRmllbGRzKSkgZGVsZXRlIChvdXRwdXRTY2hlbWFba10pO1xuICAgIH0pO1xuXG4gICAgT2JqZWN0LmtleXMob3V0cHV0U2NoZW1hLmZpZWxkcykuZm9yRWFjaCgoaykgPT4ge1xuICAgICAgaWYgKHR5cGVvZiAob3V0cHV0U2NoZW1hLmZpZWxkc1trXSkgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIG91dHB1dFNjaGVtYS5maWVsZHNba10gPSB7IHR5cGU6IG91dHB1dFNjaGVtYS5maWVsZHNba10gfTtcbiAgICAgIH0gZWxzZSBpZiAob3V0cHV0U2NoZW1hLmZpZWxkc1trXSkge1xuICAgICAgICBpZiAob3V0cHV0U2NoZW1hLmZpZWxkc1trXS52aXJ0dWFsKSB7XG4gICAgICAgICAgZGVsZXRlIG91dHB1dFNjaGVtYS5maWVsZHNba107XG4gICAgICAgIH0gZWxzZSBpZiAob3V0cHV0U2NoZW1hLmZpZWxkc1trXS50eXBlRGVmKSB7XG4gICAgICAgICAgb3V0cHV0U2NoZW1hLmZpZWxkc1trXSA9IHsgdHlwZTogb3V0cHV0U2NoZW1hLmZpZWxkc1trXS50eXBlLCB0eXBlRGVmOiBvdXRwdXRTY2hlbWEuZmllbGRzW2tdLnR5cGVEZWYgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvdXRwdXRTY2hlbWEuZmllbGRzW2tdID0geyB0eXBlOiBvdXRwdXRTY2hlbWEuZmllbGRzW2tdLnR5cGUgfTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICB1dGlsLmZvcm1hdCgnc2NoZW1hIGZpZWxkIFwiJXNcIiBpcyBub3QgcHJvcGVybHkgZGVmaW5lZDogJXMnLCBrLCBvdXRwdXRTY2hlbWEuZmllbGRzW2tdKSxcbiAgICAgICAgKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChrID09PSAnc29scl9xdWVyeScpIHtcbiAgICAgICAgZGVsZXRlIG91dHB1dFNjaGVtYS5maWVsZHNba107XG4gICAgICB9XG5cbiAgICAgIGlmIChvdXRwdXRTY2hlbWEuZmllbGRzW2tdICYmIG91dHB1dFNjaGVtYS5maWVsZHNba10udHlwZSA9PT0gJ3ZhcmNoYXInKSB7XG4gICAgICAgIG91dHB1dFNjaGVtYS5maWVsZHNba10udHlwZSA9ICd0ZXh0JztcbiAgICAgIH1cblxuICAgICAgaWYgKG91dHB1dFNjaGVtYS5maWVsZHNba10gJiYgWydtYXAnLCAnbGlzdCcsICdzZXQnLCAnZnJvemVuJ10uaW5jbHVkZXMob3V0cHV0U2NoZW1hLmZpZWxkc1trXS50eXBlKSkge1xuICAgICAgICBpZiAobW9kZWxTY2hlbWEudHlwZU1hcHMgJiYgbW9kZWxTY2hlbWEudHlwZU1hcHNba10pIHtcbiAgICAgICAgICBvdXRwdXRTY2hlbWEuZmllbGRzW2tdLnR5cGVEZWYgPSBtb2RlbFNjaGVtYS50eXBlTWFwc1trXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuICAgICAgICAgIG91dHB1dFNjaGVtYS5maWVsZHNba10udHlwZURlZiA9IG91dHB1dFNjaGVtYS5maWVsZHNba10udHlwZURlZi5yZXBsYWNlKC9bXFxzXS9nLCAnJykucmVwbGFjZSgvdmFyY2hhci9nLCAndGV4dCcpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChvdXRwdXRTY2hlbWEuZmllbGRzW2tdKSB7XG4gICAgICAgIGlmIChtb2RlbFNjaGVtYS5zdGF0aWNNYXBzICYmIG1vZGVsU2NoZW1hLnN0YXRpY01hcHNba10gPT09IHRydWUpIHtcbiAgICAgICAgICBvdXRwdXRTY2hlbWEuZmllbGRzW2tdLnN0YXRpYyA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAobW9kZWxTY2hlbWEuZmllbGRzW2tdLnN0YXRpYykge1xuICAgICAgICAgIG91dHB1dFNjaGVtYS5maWVsZHNba10uc3RhdGljID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKG91dHB1dFNjaGVtYS5rZXkgJiYgdHlwZW9mIG91dHB1dFNjaGVtYS5rZXlbMF0gPT09ICdzdHJpbmcnKSB7XG4gICAgICBvdXRwdXRTY2hlbWEua2V5WzBdID0gW291dHB1dFNjaGVtYS5rZXlbMF1dO1xuICAgIH1cblxuICAgIGlmIChvdXRwdXRTY2hlbWEua2V5ICYmIG91dHB1dFNjaGVtYS5rZXkubGVuZ3RoKSB7XG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG91dHB1dFNjaGVtYS5rZXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKCFvdXRwdXRTY2hlbWEuY2x1c3RlcmluZ19vcmRlcikgb3V0cHV0U2NoZW1hLmNsdXN0ZXJpbmdfb3JkZXIgPSB7fTtcbiAgICAgICAgaWYgKCFvdXRwdXRTY2hlbWEuY2x1c3RlcmluZ19vcmRlcltvdXRwdXRTY2hlbWEua2V5W2ldXSkge1xuICAgICAgICAgIG91dHB1dFNjaGVtYS5jbHVzdGVyaW5nX29yZGVyW291dHB1dFNjaGVtYS5rZXlbaV1dID0gJ0FTQyc7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuICAgICAgICBvdXRwdXRTY2hlbWEuY2x1c3RlcmluZ19vcmRlcltvdXRwdXRTY2hlbWEua2V5W2ldXSA9IG91dHB1dFNjaGVtYS5jbHVzdGVyaW5nX29yZGVyW291dHB1dFNjaGVtYS5rZXlbaV1dLnRvVXBwZXJDYXNlKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgYXJyYXlTb3J0ID0gKGEsIGIpID0+IHtcbiAgICAgIGlmIChhID4gYikgcmV0dXJuIDE7XG4gICAgICBpZiAoYSA8IGIpIHJldHVybiAtMTtcbiAgICAgIHJldHVybiAwO1xuICAgIH07XG5cbiAgICBpZiAob3V0cHV0U2NoZW1hLm1hdGVyaWFsaXplZF92aWV3cykge1xuICAgICAgT2JqZWN0LmtleXMob3V0cHV0U2NoZW1hLm1hdGVyaWFsaXplZF92aWV3cykuZm9yRWFjaCgobXZpbmRleCkgPT4ge1xuICAgICAgICBjb25zdCBvdXRwdXRNVmlldyA9IG91dHB1dFNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3NbbXZpbmRleF07XG4gICAgICAgIC8vIG1ha2UgcGFyaXRpb24ga2V5IGFuIGFycmF5XG4gICAgICAgIGlmIChvdXRwdXRNVmlldy5rZXlcbiAgICAgICAgICAgICAgJiYgdHlwZW9mIG91dHB1dE1WaWV3LmtleVswXSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICBvdXRwdXRNVmlldy5rZXlbMF0gPSBbb3V0cHV0TVZpZXcua2V5WzBdXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGFkZCBjbHVzdGVyaW5nX29yZGVyIGZvciBhbGwgY2x1c3RlcmluZyBrZXlzXG4gICAgICAgIGlmIChvdXRwdXRNVmlldy5rZXlcbiAgICAgICAgICAgICAgJiYgb3V0cHV0TVZpZXcua2V5Lmxlbmd0aCkge1xuICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgb3V0cHV0TVZpZXcua2V5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoIW91dHB1dE1WaWV3LmNsdXN0ZXJpbmdfb3JkZXIpIHtcbiAgICAgICAgICAgICAgb3V0cHV0TVZpZXcuY2x1c3RlcmluZ19vcmRlciA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFvdXRwdXRNVmlldy5jbHVzdGVyaW5nX29yZGVyW291dHB1dE1WaWV3LmtleVtpXV0pIHtcbiAgICAgICAgICAgICAgb3V0cHV0TVZpZXcuY2x1c3RlcmluZ19vcmRlcltvdXRwdXRNVmlldy5rZXlbaV1dID0gJ0FTQyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LWxlblxuICAgICAgICAgICAgb3V0cHV0TVZpZXcuY2x1c3RlcmluZ19vcmRlcltvdXRwdXRNVmlldy5rZXlbaV1dID0gb3V0cHV0TVZpZXcuY2x1c3RlcmluZ19vcmRlcltvdXRwdXRNVmlldy5rZXlbaV1dLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWRkIGFsbCBub24gZXhpc3RlbnQgcHJpbWFyeSBrZXkgaXRlbXMgdG8gc2VsZWN0IGFuZCBzb3J0IHRoZW1cbiAgICAgICAgZm9yIChsZXQgcGtleUluZGV4ID0gMDsgcGtleUluZGV4IDwgb3V0cHV0TVZpZXcua2V5Lmxlbmd0aDsgcGtleUluZGV4KyspIHtcbiAgICAgICAgICBpZiAocGtleUluZGV4ID09PSAwKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBwYXJ0aXRpb25JbmRleCA9IDA7IHBhcnRpdGlvbkluZGV4IDwgb3V0cHV0TVZpZXcua2V5W3BrZXlJbmRleF0ubGVuZ3RoOyBwYXJ0aXRpb25JbmRleCsrKSB7XG4gICAgICAgICAgICAgIGlmICghb3V0cHV0TVZpZXcuc2VsZWN0LmluY2x1ZGVzKG91dHB1dE1WaWV3LmtleVtwa2V5SW5kZXhdW3BhcnRpdGlvbkluZGV4XSkpIHtcbiAgICAgICAgICAgICAgICBvdXRwdXRNVmlldy5zZWxlY3QucHVzaChvdXRwdXRNVmlldy5rZXlbcGtleUluZGV4XVtwYXJ0aXRpb25JbmRleF0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIGlmICghb3V0cHV0TVZpZXcuc2VsZWN0LmluY2x1ZGVzKG91dHB1dE1WaWV3LmtleVtwa2V5SW5kZXhdKSkge1xuICAgICAgICAgICAgb3V0cHV0TVZpZXcuc2VsZWN0LnB1c2gob3V0cHV0TVZpZXcua2V5W3BrZXlJbmRleF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNoZWNrIGlmIHNlbGVjdCBoYXMgKiBhbmQgdGhlbiBhZGQgYWxsIGZpZWxkcyB0byBzZWxlY3RcbiAgICAgICAgaWYgKG91dHB1dE1WaWV3LnNlbGVjdFswXSA9PT0gJyonKSB7XG4gICAgICAgICAgb3V0cHV0TVZpZXcuc2VsZWN0ID0gT2JqZWN0LmtleXMob3V0cHV0U2NoZW1hLmZpZWxkcyk7XG4gICAgICAgIH1cblxuICAgICAgICBvdXRwdXRNVmlldy5zZWxlY3Quc29ydChhcnJheVNvcnQpO1xuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG91dHB1dFNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3MgPSB7fTtcbiAgICB9XG5cbiAgICBpZiAob3V0cHV0U2NoZW1hLmluZGV4ZXMpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3V0cHV0U2NoZW1hLmluZGV4ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgaW5kZXhOYW1lTGlzdCA9IG91dHB1dFNjaGVtYS5pbmRleGVzW2ldLnJlcGxhY2UoL1tcIlxcc10vZywgJycpLnNwbGl0KC9bKCldL2cpO1xuICAgICAgICBpZiAoaW5kZXhOYW1lTGlzdC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgaW5kZXhOYW1lTGlzdFswXSA9IGluZGV4TmFtZUxpc3RbMF0udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpZiAoaW5kZXhOYW1lTGlzdFswXSA9PT0gJ3ZhbHVlcycpIG91dHB1dFNjaGVtYS5pbmRleGVzW2ldID0gaW5kZXhOYW1lTGlzdFsxXTtcbiAgICAgICAgICBlbHNlIG91dHB1dFNjaGVtYS5pbmRleGVzW2ldID0gdXRpbC5mb3JtYXQoJyVzKCVzKScsIGluZGV4TmFtZUxpc3RbMF0sIGluZGV4TmFtZUxpc3RbMV0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG91dHB1dFNjaGVtYS5pbmRleGVzW2ldID0gaW5kZXhOYW1lTGlzdFswXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgb3V0cHV0U2NoZW1hLmluZGV4ZXMuc29ydChhcnJheVNvcnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBvdXRwdXRTY2hlbWEuaW5kZXhlcyA9IFtdO1xuICAgIH1cblxuICAgIGlmIChvdXRwdXRTY2hlbWEuY3VzdG9tX2luZGV4KSB7XG4gICAgICBvdXRwdXRTY2hlbWEuY3VzdG9tX2luZGV4ZXMgPSBbb3V0cHV0U2NoZW1hLmN1c3RvbV9pbmRleF07XG4gICAgICBkZWxldGUgb3V0cHV0U2NoZW1hLmN1c3RvbV9pbmRleDtcbiAgICB9XG5cbiAgICBpZiAob3V0cHV0U2NoZW1hLmN1c3RvbV9pbmRleGVzKSB7XG4gICAgICBjb25zdCBjdXN0b21BcnJheVNvcnQgPSAoYSwgYikgPT4ge1xuICAgICAgICBpZiAoYS5vbiA+IGIub24pIHJldHVybiAxO1xuICAgICAgICBpZiAoYS5vbiA8IGIub24pIHJldHVybiAtMTtcblxuICAgICAgICBpZiAoYS51c2luZyA+IGIudXNpbmcpIHJldHVybiAxO1xuICAgICAgICBpZiAoYS51c2luZyA8IGIudXNpbmcpIHJldHVybiAtMTtcblxuICAgICAgICBpZiAoYS5vcHRpb25zID4gYi5vcHRpb25zKSByZXR1cm4gMTtcbiAgICAgICAgaWYgKGEub3B0aW9ucyA8IGIub3B0aW9ucykgcmV0dXJuIC0xO1xuXG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfTtcblxuICAgICAgb3V0cHV0U2NoZW1hLmN1c3RvbV9pbmRleGVzLnNvcnQoY3VzdG9tQXJyYXlTb3J0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3V0cHV0U2NoZW1hLmN1c3RvbV9pbmRleGVzID0gW107XG4gICAgfVxuXG4gICAgb3V0cHV0U2NoZW1hLmN1c3RvbV9pbmRleGVzID0gXy5yZW1vdmUob3V0cHV0U2NoZW1hLmN1c3RvbV9pbmRleGVzLCAoY2luZGV4KSA9PiAoY2luZGV4Lm9uICE9PSAnc29scl9xdWVyeScpKTtcblxuICAgIHJldHVybiBvdXRwdXRTY2hlbWE7XG4gIH0sXG5cbiAgdmFsaWRhdGVfbW9kZWxfc2NoZW1hKG1vZGVsU2NoZW1hKSB7XG4gICAgaWYgKCFtb2RlbFNjaGVtYSkgdGhyb3cgKG5ldyBFcnJvcignQSBzY2hlbWEgbXVzdCBiZSBzcGVjaWZpZWQnKSk7XG5cbiAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChtb2RlbFNjaGVtYS5maWVsZHMpIHx8IE9iamVjdC5rZXlzKG1vZGVsU2NoZW1hLmZpZWxkcykubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyAobmV3IEVycm9yKCdTY2hlbWEgbXVzdCBjb250YWluIGEgbm9uLWVtcHR5IFwiZmllbGRzXCIgbWFwIG9iamVjdCcpKTtcbiAgICB9XG5cbiAgICBpZiAoIW1vZGVsU2NoZW1hLmtleSB8fCAhKG1vZGVsU2NoZW1hLmtleSBpbnN0YW5jZW9mIEFycmF5KSkge1xuICAgICAgdGhyb3cgKG5ldyBFcnJvcignU2NoZW1hIG11c3QgY29udGFpbiBcImtleVwiIGluIHRoZSBmb3JtOiBbIFtwYXJ0aXRpb25rZXkxLCAuLi5dLCBjbHVzdGVyaW5na2V5MSwgLi4uXScpKTtcbiAgICB9XG5cbiAgICBPYmplY3Qua2V5cyhtb2RlbFNjaGVtYS5maWVsZHMpLmZvckVhY2goKGspID0+IHtcbiAgICAgIGNvbnN0IGZpZWxkdHlwZSA9IHRoaXMuZ2V0X2ZpZWxkX3R5cGUobW9kZWxTY2hlbWEsIGspO1xuICAgICAgaWYgKCEoZmllbGR0eXBlIGluIGRhdGF0eXBlcykpIHtcbiAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICB1dGlsLmZvcm1hdCgnR2l2ZW4gc2NoZW1hIGZpZWxkIHR5cGUgaXMgbm90IHN1cHBvcnRlZCBmb3I6ICVzKCVzKScsIGssIG1vZGVsU2NoZW1hLmZpZWxkc1trXS50eXBlKSxcbiAgICAgICAgKSk7XG4gICAgICB9XG4gICAgICBpZiAoISh0aGlzLmlzX2ZpZWxkX2RlZmF1bHRfdmFsdWVfdmFsaWQobW9kZWxTY2hlbWEsIGspKSkge1xuICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgIHV0aWwuZm9ybWF0KCdJbnZhbGlkIGRlZnVsdCBkZWZpbml0aW9uIGZvcjogJXMoJXMpJywgaywgbW9kZWxTY2hlbWEuZmllbGRzW2tdLnR5cGUpLFxuICAgICAgICApKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIHZhbGlkYXRlIHByaW1hcnkga2V5XG4gICAgaWYgKHR5cGVvZiAobW9kZWxTY2hlbWEua2V5WzBdKSA9PT0gJ3N0cmluZycpIHtcbiAgICAgIGlmICghKG1vZGVsU2NoZW1hLmtleVswXSBpbiBtb2RlbFNjaGVtYS5maWVsZHMpKSB7XG4gICAgICAgIHRocm93IChuZXcgRXJyb3IoJ1BhcnRpdGlvbiBLZXkgbXVzdCBhbHNvIGJlIGEgdmFsaWQgZmllbGQgbmFtZScpKTtcbiAgICAgIH1cbiAgICAgIGlmIChtb2RlbFNjaGVtYS5maWVsZHNbbW9kZWxTY2hlbWEua2V5WzBdXS52aXJ0dWFsKSB7XG4gICAgICAgIHRocm93IChuZXcgRXJyb3IoXCJQYXJ0aXRpb24gS2V5IG11c3QgYWxzbyBiZSBhIGRiIGZpZWxkIG5hbWUsIGNhbid0IGJlIGEgdmlydHVhbCBmaWVsZCBuYW1lXCIpKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKG1vZGVsU2NoZW1hLmtleVswXSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICBpZiAobW9kZWxTY2hlbWEua2V5WzBdLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyAobmV3IEVycm9yKFwiUGFydGl0aW9uIEtleSBhcnJheSBjYW4ndCBiZSBlbXB0eVwiKSk7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IG1vZGVsU2NoZW1hLmtleVswXS5sZW5ndGg7IGorKykge1xuICAgICAgICBpZiAoKHR5cGVvZiAobW9kZWxTY2hlbWEua2V5WzBdW2pdKSAhPT0gJ3N0cmluZycpIHx8ICEobW9kZWxTY2hlbWEua2V5WzBdW2pdIGluIG1vZGVsU2NoZW1hLmZpZWxkcykpIHtcbiAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKCdQYXJ0aXRpb24gS2V5IGFycmF5IG11c3QgY29udGFpbiBvbmx5IHZhbGlkIGZpZWxkIG5hbWVzJykpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChtb2RlbFNjaGVtYS5maWVsZHNbbW9kZWxTY2hlbWEua2V5WzBdW2pdXS52aXJ0dWFsKSB7XG4gICAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiUGFydGl0aW9uIEtleSBhcnJheSBtdXN0IGNvbnRhaW4gb25seSBkYiBmaWVsZCBuYW1lcywgY2FuJ3QgY29udGFpbiB2aXJ0dWFsIGZpZWxkIG5hbWVzXCIsXG4gICAgICAgICAgKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgKG5ldyBFcnJvcignUGFydGl0aW9uIEtleSBtdXN0IGJlIGEgZmllbGQgbmFtZSBzdHJpbmcsIG9yIGFycmF5IG9mIGZpZWxkIG5hbWVzJykpO1xuICAgIH1cblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbW9kZWxTY2hlbWEua2V5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoaSA+IDApIHtcbiAgICAgICAgaWYgKCh0eXBlb2YgKG1vZGVsU2NoZW1hLmtleVtpXSkgIT09ICdzdHJpbmcnKSB8fCAhKG1vZGVsU2NoZW1hLmtleVtpXSBpbiBtb2RlbFNjaGVtYS5maWVsZHMpKSB7XG4gICAgICAgICAgdGhyb3cgKG5ldyBFcnJvcignQ2x1c3RlcmluZyBLZXlzIG11c3QgYmUgdmFsaWQgZmllbGQgbmFtZXMnKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1vZGVsU2NoZW1hLmZpZWxkc1ttb2RlbFNjaGVtYS5rZXlbaV1dLnZpcnR1YWwpIHtcbiAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgXCJDbHVzdGVyaW5nIEtleXMgbXVzdCBiZSBkYiBmaWVsZCBuYW1lcywgY2FuJ3QgYmUgdmlydHVhbCBmaWVsZCBuYW1lc1wiLFxuICAgICAgICAgICkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG1vZGVsU2NoZW1hLmNsdXN0ZXJpbmdfb3JkZXIpIHtcbiAgICAgIGlmICghXy5pc1BsYWluT2JqZWN0KG1vZGVsU2NoZW1hLmNsdXN0ZXJpbmdfb3JkZXIpKSB7XG4gICAgICAgIHRocm93IChuZXcgRXJyb3IoJ2NsdXN0ZXJpbmdfb3JkZXIgbXVzdCBiZSBhbiBvYmplY3Qgb2YgY2x1c3RlcmluZ19rZXkgYXR0cmlidXRlcycpKTtcbiAgICAgIH1cblxuICAgICAgT2JqZWN0LmtleXMobW9kZWxTY2hlbWEuY2x1c3RlcmluZ19vcmRlcikuZm9yRWFjaCgoY2luZGV4KSA9PiB7XG4gICAgICAgIGlmICghWydhc2MnLCAnZGVzYyddLmluY2x1ZGVzKG1vZGVsU2NoZW1hLmNsdXN0ZXJpbmdfb3JkZXJbY2luZGV4XS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoJ2NsdXN0ZXJpbmdfb3JkZXIgYXR0cmlidXRlIHZhbHVlcyBjYW4gb25seSBiZSBBU0Mgb3IgREVTQycpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobW9kZWxTY2hlbWEua2V5LmluZGV4T2YoY2luZGV4KSA8IDEpIHtcbiAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKCdjbHVzdGVyaW5nX29yZGVyIGZpZWxkIGF0dHJpYnV0ZXMgbXVzdCBiZSBjbHVzdGVyaW5nIGtleXMgb25seScpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gdmFsaWRhdGUgbWF0ZXJpYWxpemVkX3ZpZXdcbiAgICBpZiAobW9kZWxTY2hlbWEubWF0ZXJpYWxpemVkX3ZpZXdzKSB7XG4gICAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChtb2RlbFNjaGVtYS5tYXRlcmlhbGl6ZWRfdmlld3MpKSB7XG4gICAgICAgIHRocm93IChuZXcgRXJyb3IoJ21hdGVyaWFsaXplZF92aWV3cyBtdXN0IGJlIGFuIG9iamVjdCB3aXRoIHZpZXcgbmFtZXMgYXMgYXR0cmlidXRlcycpKTtcbiAgICAgIH1cblxuICAgICAgT2JqZWN0LmtleXMobW9kZWxTY2hlbWEubWF0ZXJpYWxpemVkX3ZpZXdzKS5mb3JFYWNoKChtdmluZGV4KSA9PiB7XG4gICAgICAgIGNvbnN0IGNhbmRpZGF0ZU1WaWV3ID0gbW9kZWxTY2hlbWEubWF0ZXJpYWxpemVkX3ZpZXdzW212aW5kZXhdO1xuICAgICAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChjYW5kaWRhdGVNVmlldykpIHtcbiAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgdXRpbC5mb3JtYXQoJ2F0dHJpYnV0ZSBcIiVzXCIgdW5kZXIgbWF0ZXJpYWxpemVkX3ZpZXdzIG11c3QgYmUgYW4gb2JqZWN0JywgbXZpbmRleCksXG4gICAgICAgICAgKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNhbmRpZGF0ZU1WaWV3LnNlbGVjdCB8fCAhY2FuZGlkYXRlTVZpZXcua2V5KSB7XG4gICAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICAgIHV0aWwuZm9ybWF0KCdtYXRlcmlhbGl6ZWRfdmlldyBcIiVzXCIgbXVzdCBoYXZlIFwic2VsZWN0XCIgYW5kIFwia2V5XCIgYXR0cmlidXRlcycsIG12aW5kZXgpLFxuICAgICAgICAgICkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCEoY2FuZGlkYXRlTVZpZXcuc2VsZWN0IGluc3RhbmNlb2YgQXJyYXkpIHx8ICEoY2FuZGlkYXRlTVZpZXcua2V5IGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICAgIHV0aWwuZm9ybWF0KFxuICAgICAgICAgICAgICAnXCJzZWxlY3RcIiBhbmQgXCJrZXlcIiBhdHRyaWJ1dGVzIG11c3QgYmUgYW4gYXJyYXkgdW5kZXIgYXR0cmlidXRlICVzIG9mIG1hdGVyaWFsaXplZF92aWV3cycsIG12aW5kZXgsXG4gICAgICAgICAgICApLFxuICAgICAgICAgICkpO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgc2VsZWN0aW5kZXggPSAwOyBzZWxlY3RpbmRleCA8IGNhbmRpZGF0ZU1WaWV3LnNlbGVjdC5sZW5ndGg7IHNlbGVjdGluZGV4KyspIHtcbiAgICAgICAgICBpZiAoKHR5cGVvZiAoY2FuZGlkYXRlTVZpZXcuc2VsZWN0W3NlbGVjdGluZGV4XSkgIT09ICdzdHJpbmcnKVxuICAgICAgICAgICAgICAgIHx8ICEoY2FuZGlkYXRlTVZpZXcuc2VsZWN0W3NlbGVjdGluZGV4XSBpbiBtb2RlbFNjaGVtYS5maWVsZHNcbiAgICAgICAgICAgICAgICB8fCBjYW5kaWRhdGVNVmlldy5zZWxlY3Rbc2VsZWN0aW5kZXhdID09PSAnKicpKSB7XG4gICAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgICB1dGlsLmZvcm1hdChcbiAgICAgICAgICAgICAgICAndGhlIHNlbGVjdCBhdHRyaWJ1dGUgdW5kZXIgbWF0ZXJpYWxpemVkX3ZpZXcgJXMgbXVzdCBiZSBhbiBhcnJheSBvZiBmaWVsZCBuYW1lIHN0cmluZ3Mgb3IgW1wiKlwiXScsXG4gICAgICAgICAgICAgICAgbXZpbmRleCxcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChtb2RlbFNjaGVtYS5maWVsZHNbY2FuZGlkYXRlTVZpZXcuc2VsZWN0W3NlbGVjdGluZGV4XV1cbiAgICAgICAgICAgICAgJiYgbW9kZWxTY2hlbWEuZmllbGRzW2NhbmRpZGF0ZU1WaWV3LnNlbGVjdFtzZWxlY3RpbmRleF1dLnZpcnR1YWwpIHtcbiAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIHV0aWwuZm9ybWF0KFxuICAgICAgICAgICAgICAgICd0aGUgc2VsZWN0IGF0dHJpYnV0ZSB1bmRlciAlcyBvZiBtYXRlcmlhbGl6ZWRfdmlld3MgbXVzdCBiZSBhbiBhcnJheSBvZiBkYiBmaWVsZCBuYW1lcywgJyArXG4gICAgICAgICAgICAgICAgJ2Nhbm5vdCBjb250YWluIGFueSB2aXJ0dWFsIGZpZWxkIG5hbWUnLFxuICAgICAgICAgICAgICAgIG12aW5kZXgsXG4gICAgICAgICAgICAgICksXG4gICAgICAgICAgICApKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyB2YWxpZGF0ZSBtYXRlcmlhbGl6ZWRfdmlldyBwcmltYXJ5IGtleVxuICAgICAgICBpZiAodHlwZW9mIChjYW5kaWRhdGVNVmlldy5rZXlbMF0pID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIGlmICghKGNhbmRpZGF0ZU1WaWV3LmtleVswXSBpbiBtb2RlbFNjaGVtYS5maWVsZHMpKSB7XG4gICAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgICB1dGlsLmZvcm1hdCgnbWF0ZXJpYWxpemVkX3ZpZXcgJXM6IHBhcnRpdGlvbiBrZXkgc3RyaW5nIG11c3QgbWF0Y2ggYSB2YWxpZCBmaWVsZCBuYW1lJywgbXZpbmRleCksXG4gICAgICAgICAgICApKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsU2NoZW1hLmZpZWxkc1tjYW5kaWRhdGVNVmlldy5rZXlbMF1dLnZpcnR1YWwpIHtcbiAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIHV0aWwuZm9ybWF0KFxuICAgICAgICAgICAgICAgICdtYXRlcmlhbGl6ZWRfdmlldyAlczogcGFydGl0aW9uIGtleSBtdXN0IG1hdGNoIGEgZGIgZmllbGQgbmFtZSwgY2Fubm90IGJlIGEgdmlydHVhbCBmaWVsZCBuYW1lJyxcbiAgICAgICAgICAgICAgICBtdmluZGV4LFxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGNhbmRpZGF0ZU1WaWV3LmtleVswXSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgaWYgKGNhbmRpZGF0ZU1WaWV3LmtleVswXS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIHV0aWwuZm9ybWF0KCdtYXRlcmlhbGl6ZWRfdmlldyAlczogcGFydGl0aW9uIGtleSBhcnJheSBjYW5ub3QgYmUgZW1wdHknLCBtdmluZGV4KSxcbiAgICAgICAgICAgICkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGNhbmRpZGF0ZU1WaWV3LmtleVswXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgaWYgKCh0eXBlb2YgKGNhbmRpZGF0ZU1WaWV3LmtleVswXVtqXSkgIT09ICdzdHJpbmcnKSB8fCAhKGNhbmRpZGF0ZU1WaWV3LmtleVswXVtqXSBpbiBtb2RlbFNjaGVtYS5maWVsZHMpKSB7XG4gICAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgdXRpbC5mb3JtYXQoJ21hdGVyaWFsaXplZF92aWV3ICVzOiBwYXJ0aXRpb24ga2V5IGFycmF5IG11c3QgY29udGFpbiBvbmx5IHZhbGlkIGZpZWxkIG5hbWVzJywgbXZpbmRleCksXG4gICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1vZGVsU2NoZW1hLmZpZWxkc1tjYW5kaWRhdGVNVmlldy5rZXlbMF1bal1dLnZpcnR1YWwpIHtcbiAgICAgICAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICB1dGlsLmZvcm1hdChcbiAgICAgICAgICAgICAgICAgICdtYXRlcmlhbGl6ZWRfdmlldyAlczogcGFydGl0aW9uIGtleSBhcnJheSBtdXN0IGNvbnRhaW4gb25seSBkYiBmaWVsZCBuYW1lcywgJyArXG4gICAgICAgICAgICAgICAgICAnY2Fubm90IGNvbnRhaW4gdmlydHVhbCBmaWVsZCBuYW1lcycsXG4gICAgICAgICAgICAgICAgICBtdmluZGV4LFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgdXRpbC5mb3JtYXQoXG4gICAgICAgICAgICAgICdtYXRlcmlhbGl6ZWRfdmlldyAlczogcGFydGl0aW9uIGtleSBtdXN0IGJlIGEgZmllbGQgbmFtZSBzdHJpbmcsIG9yIGFycmF5IG9mIGZpZWxkIG5hbWVzJyxcbiAgICAgICAgICAgICAgbXZpbmRleCxcbiAgICAgICAgICAgICksXG4gICAgICAgICAgKSk7XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhbmRpZGF0ZU1WaWV3LmtleS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChpID4gMCkge1xuICAgICAgICAgICAgaWYgKCh0eXBlb2YgKGNhbmRpZGF0ZU1WaWV3LmtleVtpXSkgIT09ICdzdHJpbmcnKSB8fCAhKGNhbmRpZGF0ZU1WaWV3LmtleVtpXSBpbiBtb2RlbFNjaGVtYS5maWVsZHMpKSB7XG4gICAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgdXRpbC5mb3JtYXQoJ21hdGVyaWFsaXplZF92aWV3ICVzOiBjbHVzdGVyaW5nIGtleXMgbXVzdCBiZSB2YWxpZCBmaWVsZCBuYW1lcycsIG12aW5kZXgpLFxuICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtb2RlbFNjaGVtYS5maWVsZHNbY2FuZGlkYXRlTVZpZXcua2V5W2ldXS52aXJ0dWFsKSB7XG4gICAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgICAgdXRpbC5mb3JtYXQoXG4gICAgICAgICAgICAgICAgICAnbWF0ZXJpYWxpemVkX3ZpZXcgJXM6IGNsdXN0ZXJpbmcga2V5cyBtdXN0IGJlIGRiIGZpZWxkIG5hbWVzLCBjYW5ub3QgY29udGFpbiB2aXJ0dWFsIGZpZWxkcycsXG4gICAgICAgICAgICAgICAgICBtdmluZGV4LFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChjYW5kaWRhdGVNVmlldy5jbHVzdGVyaW5nX29yZGVyKSB7XG4gICAgICAgICAgaWYgKCFfLmlzUGxhaW5PYmplY3QoY2FuZGlkYXRlTVZpZXcuY2x1c3RlcmluZ19vcmRlcikpIHtcbiAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIHV0aWwuZm9ybWF0KFxuICAgICAgICAgICAgICAgICdtYXRlcmlhbGl6ZWRfdmlldyAlczogY2x1c3RlcmluZ19vcmRlciBtdXN0IGJlIGFuIG9iamVjdCBvZiBjbHVzdGVyaW5nX2tleSBhdHRyaWJ1dGVzJyxcbiAgICAgICAgICAgICAgICBtdmluZGV4LFxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgKSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgT2JqZWN0LmtleXMoY2FuZGlkYXRlTVZpZXcuY2x1c3RlcmluZ19vcmRlcikuZm9yRWFjaCgoY2luZGV4KSA9PiB7XG4gICAgICAgICAgICBpZiAoIVsnYXNjJywgJ2Rlc2MnXS5pbmNsdWRlcyhjYW5kaWRhdGVNVmlldy5jbHVzdGVyaW5nX29yZGVyW2NpbmRleF0udG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICAgICAgICB1dGlsLmZvcm1hdCgnbWF0ZXJpYWxpemVkX3ZpZXcgJXM6IGNsdXN0ZXJpbmdfb3JkZXIgYXR0cmlidXRlIHZhbHVlcyBjYW4gb25seSBiZSBBU0Mgb3IgREVTQycsIG12aW5kZXgpLFxuICAgICAgICAgICAgICApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjYW5kaWRhdGVNVmlldy5rZXkuaW5kZXhPZihjaW5kZXgpIDwgMSkge1xuICAgICAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFxuICAgICAgICAgICAgICAgIHV0aWwuZm9ybWF0KFxuICAgICAgICAgICAgICAgICAgJ21hdGVyaWFsaXplZF92aWV3ICVzOiBjbHVzdGVyaW5nX29yZGVyIGZpZWxkIGF0dHJpYnV0ZXMgbXVzdCBiZSBjbHVzdGVyaW5nIGtleXMgb25seScsXG4gICAgICAgICAgICAgICAgICBtdmluZGV4LFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyB2YWxpZGF0ZSBpbmRleGVzXG4gICAgaWYgKG1vZGVsU2NoZW1hLmluZGV4ZXMpIHtcbiAgICAgIGlmICghKG1vZGVsU2NoZW1hLmluZGV4ZXMgaW5zdGFuY2VvZiBBcnJheSkpIHtcbiAgICAgICAgdGhyb3cgKG5ldyBFcnJvcignaW5kZXhlcyBtdXN0IGJlIGFuIGFycmF5IG9mIGZpZWxkIG5hbWUgc3RyaW5ncycpKTtcbiAgICAgIH1cblxuICAgICAgZm9yIChsZXQgbCA9IDA7IGwgPCBtb2RlbFNjaGVtYS5pbmRleGVzLmxlbmd0aDsgbCsrKSB7XG4gICAgICAgIGlmICh0eXBlb2YgbW9kZWxTY2hlbWEuaW5kZXhlc1tsXSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKCdpbmRleGVzIG11c3QgYmUgYW4gYXJyYXkgb2Ygc3RyaW5ncycpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGluZGV4TmFtZUxpc3QgPSBtb2RlbFNjaGVtYS5pbmRleGVzW2xdLnJlcGxhY2UoL1tcIlxcc10vZywgJycpLnNwbGl0KC9bKCldL2cpO1xuICAgICAgICBpZiAoaW5kZXhOYW1lTGlzdC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgaW5kZXhOYW1lTGlzdFswXSA9IGluZGV4TmFtZUxpc3RbMF0udG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICBpZiAoIVsnZW50cmllcycsICdrZXlzJywgJ3ZhbHVlcycsICdmdWxsJ10uaW5jbHVkZXMoaW5kZXhOYW1lTGlzdFswXSkpIHtcbiAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIHV0aWwuZm9ybWF0KCdpbmRleCBcIiVzXCIgaXMgbm90IGRlZmluZWQgcHJvcGVybHknLCBtb2RlbFNjaGVtYS5pbmRleGVzW2xdKSxcbiAgICAgICAgICAgICkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIV8uaGFzKG1vZGVsU2NoZW1hLmZpZWxkcywgaW5kZXhOYW1lTGlzdFsxXSkpIHtcbiAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIHV0aWwuZm9ybWF0KCdcIiVzXCIgaXMgbm90IGEgdmFsaWQgZmllbGQgbmFtZSwgaW5kZXhlcyBtdXN0IGJlIGRlZmluZWQgb24gZmllbGQgbmFtZXMnLCBpbmRleE5hbWVMaXN0WzFdKSxcbiAgICAgICAgICAgICkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW9kZWxTY2hlbWEuZmllbGRzW2luZGV4TmFtZUxpc3RbMV1dLnZpcnR1YWwpIHtcbiAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXCJpbmRleGVzIG11c3QgYmUgYW4gYXJyYXkgb2YgZGIgZmllbGQgbmFtZXMsIGNhbid0IGNvbnRhaW4gdmlydHVhbCBmaWVsZHNcIikpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoIV8uaGFzKG1vZGVsU2NoZW1hLmZpZWxkcywgaW5kZXhOYW1lTGlzdFswXSkpIHtcbiAgICAgICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIHV0aWwuZm9ybWF0KCdcIiVzXCIgaXMgbm90IGEgdmFsaWQgZmllbGQsIGluZGV4ZXMgbXVzdCBiZSBkZWZpbmVkIG9uIGZpZWxkIG5hbWVzJywgaW5kZXhOYW1lTGlzdFswXSksXG4gICAgICAgICAgICApKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vZGVsU2NoZW1hLmZpZWxkc1tpbmRleE5hbWVMaXN0WzBdXS52aXJ0dWFsKSB7XG4gICAgICAgICAgICB0aHJvdyAobmV3IEVycm9yKFwiaW5kZXhlcyBtdXN0IGJlIGFuIGFycmF5IG9mIGRiIGZpZWxkIG5hbWVzLCBjYW4ndCBjb250YWluIHZpcnR1YWwgZmllbGRzXCIpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCB2YWxpZGF0ZUN1c3RvbUluZGV4ID0gKGN1c3RvbUluZGV4KSA9PiB7XG4gICAgICBpZiAoIV8uaXNQbGFpbk9iamVjdChjdXN0b21JbmRleCkpIHtcbiAgICAgICAgdGhyb3cgKG5ldyBFcnJvcignY3VzdG9tX2luZGV4IG11c3QgYmUgYW4gb2JqZWN0IHdpdGggcHJvcGVyIGluZGV4aW5nIGF0dHJpYnV0ZXMnKSk7XG4gICAgICB9XG4gICAgICBpZiAoKHR5cGVvZiAoY3VzdG9tSW5kZXgub24pICE9PSAnc3RyaW5nJykgfHwgIShjdXN0b21JbmRleC5vbiBpbiBtb2RlbFNjaGVtYS5maWVsZHMpKSB7XG4gICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgXCJjdXN0b21faW5kZXggbXVzdCBoYXZlIGFuICdvbicgYXR0cmlidXRlIHdpdGggc3RyaW5nIHZhbHVlIGFuZCB2YWx1ZSBtdXN0IGJlIGEgdmFsaWQgZmllbGQgbmFtZVwiLFxuICAgICAgICApKTtcbiAgICAgIH1cbiAgICAgIGlmIChtb2RlbFNjaGVtYS5maWVsZHNbY3VzdG9tSW5kZXgub25dLnZpcnR1YWwpIHtcbiAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICBcImN1c3RvbV9pbmRleCAnb24nIGF0dHJpYnV0ZSBtdXN0IGJlIGEgZGIgZmllbGQgbmFtZSwgY2FuJ3QgY29udGFpbiB2aXJ0dWFsIGZpZWxkc1wiLFxuICAgICAgICApKTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlb2YgKGN1c3RvbUluZGV4LnVzaW5nKSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgdGhyb3cgKG5ldyBFcnJvcihcbiAgICAgICAgICBcImN1c3RvbV9pbmRleCBtdXN0IGhhdmUgYSAndXNpbmcnIGF0dHJpYnV0ZSB3aXRoIHN0cmluZyB2YWx1ZVwiLFxuICAgICAgICApKTtcbiAgICAgIH1cbiAgICAgIGlmICghXy5pc1BsYWluT2JqZWN0KGN1c3RvbUluZGV4Lm9wdGlvbnMpKSB7XG4gICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgJ2N1c3RvbV9pbmRleCBtdXN0IGhhdmUgYW4gXCJvcHRpb25zXCIgYXR0cmlidXRlIGFuZCBpdCBtdXN0IGJlIGFuIG9iamVjdCwgJyArXG4gICAgICAgICAgJ3Bhc3MgYmxhbmsge30gb2JqZWN0IGlmIG5vIG9wdGlvbnMgYXJlIHJlcXVpcmVkJyxcbiAgICAgICAgKSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmIChtb2RlbFNjaGVtYS5jdXN0b21faW5kZXggJiYgbW9kZWxTY2hlbWEuY3VzdG9tX2luZGV4ZXMpIHtcbiAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICdib3RoIGN1c3RvbV9pbmRleCBhbmQgY3VzdG9tX2luZGV4ZXMgYXJlIGRlZmluZWQgaW4gc2NoZW1hLCBvbmx5IG9uZSBvZiB0aGVtIHNob3VsZCBiZSBkZWZpbmVkJyxcbiAgICAgICkpO1xuICAgIH1cblxuICAgIGlmIChtb2RlbFNjaGVtYS5jdXN0b21faW5kZXgpIHtcbiAgICAgIHZhbGlkYXRlQ3VzdG9tSW5kZXgobW9kZWxTY2hlbWEuY3VzdG9tX2luZGV4KTtcbiAgICB9XG5cbiAgICBpZiAobW9kZWxTY2hlbWEuY3VzdG9tX2luZGV4ZXMpIHtcbiAgICAgIGlmIChtb2RlbFNjaGVtYS5jdXN0b21faW5kZXhlcyBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIGZvciAobGV0IGNpID0gMDsgY2kgPCBtb2RlbFNjaGVtYS5jdXN0b21faW5kZXhlcy5sZW5ndGg7IGNpKyspIHtcbiAgICAgICAgICB2YWxpZGF0ZUN1c3RvbUluZGV4KG1vZGVsU2NoZW1hLmN1c3RvbV9pbmRleGVzW2NpXSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IChuZXcgRXJyb3IoXG4gICAgICAgICAgJ2N1c3RvbV9pbmRleGVzIG11c3QgYmUgYW4gYXJyYXkgd2l0aCBvYmplY3RzIHdpdGggcHJvcGVyIGluZGV4aW5nIGF0dHJpYnV0ZXMnLFxuICAgICAgICApKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgZ2V0X2ZpZWxkX3R5cGUobW9kZWxTY2hlbWEsIGZpZWxkbmFtZSkge1xuICAgIGNvbnN0IGZpZWxkb2IgPSBtb2RlbFNjaGVtYS5maWVsZHNbZmllbGRuYW1lXTtcblxuICAgIGlmICh0eXBlb2YgZmllbGRvYiA9PT0gJ3N0cmluZycpIHJldHVybiBmaWVsZG9iO1xuICAgIGVsc2UgaWYgKF8uaXNQbGFpbk9iamVjdChmaWVsZG9iKSkgcmV0dXJuIGZpZWxkb2IudHlwZTtcbiAgICB0aHJvdyAobmV3IEVycm9yKHV0aWwuZm9ybWF0KCdGaWVsZCB0eXBlIG5vdCBkZWZpbmVkIGZvciBmaWVsZCBcIiVzXCInLCBmaWVsZG5hbWUpKSk7XG4gIH0sXG5cbiAgaXNfZmllbGRfZGVmYXVsdF92YWx1ZV92YWxpZChtb2RlbFNjaGVtYSwgZmllbGRuYW1lKSB7XG4gICAgaWYgKF8uaXNQbGFpbk9iamVjdChtb2RlbFNjaGVtYS5maWVsZHNbZmllbGRuYW1lXSkgJiYgbW9kZWxTY2hlbWEuZmllbGRzW2ZpZWxkbmFtZV0uZGVmYXVsdCkge1xuICAgICAgaWYgKF8uaXNQbGFpbk9iamVjdChtb2RlbFNjaGVtYS5maWVsZHNbZmllbGRuYW1lXS5kZWZhdWx0KVxuICAgICAgICAgICYmICEobW9kZWxTY2hlbWEuZmllbGRzW2ZpZWxkbmFtZV0uZGVmYXVsdC4kZGJfZnVuY3Rpb24pKSB7XG4gICAgICAgIHJldHVybiBbJ21hcCcsICdsaXN0JywgJ3NldCcsICdmcm96ZW4nXS5pbmNsdWRlcyhtb2RlbFNjaGVtYS5maWVsZHNbZmllbGRuYW1lXS50eXBlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSxcblxufTtcblxubW9kdWxlLmV4cG9ydHMgPSBzY2hlbWVyO1xuIl19