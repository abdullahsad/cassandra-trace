'use strict';

var check = require('check-types');
var util = require('util');
var cql = require('dse-driver');

var validators = {};
validators.is_array = function (obj) {
  return check.array(obj);
};
validators.is_object = function (obj) {
  return check.object(obj);
};
validators.is_long = function (obj) {
  return obj instanceof cql.types.Long;
};
validators.is_decimal = function (obj) {
  return obj instanceof cql.types.BigDecimal;
};
validators.is_integer = function (obj) {
  return check.intNumber(obj);
};
validators.is_var_int = function (obj) {
  return obj instanceof cql.types.Integer;
};
validators.is_boolean = function (obj) {
  return obj === true || obj === false;
};
validators.is_number = function (obj) {
  return check.number(obj);
};
validators.is_string = function (obj) {
  return check.string(obj);
};
validators.is_local_date = function (obj) {
  return obj instanceof cql.types.LocalDate;
};
validators.is_local_time = function (obj) {
  return obj instanceof cql.types.LocalTime;
};
validators.is_date = function (obj) {
  return check.date(new Date(obj));
};
validators.is_buffer = function (obj) {
  return obj instanceof Buffer;
};
validators.is_timeuuid = function (obj) {
  return obj instanceof cql.types.TimeUuid;
};
validators.is_uuid = function (obj) {
  return obj instanceof cql.types.Uuid;
};
validators.is_inet = function (obj) {
  return obj instanceof cql.types.InetAddress;
};
validators.is_frozen = function (obj) {
  return validators.is_array(obj) || validators.is_object(obj);
};

var TYPE_MAP = {
  ascii: { validator: validators.is_string },
  bigint: { validator: validators.is_long },
  blob: { validator: validators.is_buffer },
  boolean: { validator: validators.is_boolean },
  counter: { validator: validators.is_long },
  date: { validator: validators.is_local_date },
  decimal: { validator: validators.is_decimal },
  double: { validator: validators.is_number },
  float: { validator: validators.is_number },
  inet: { validator: validators.is_inet },
  int: { validator: validators.is_integer },
  list: { validator: validators.is_array },
  map: { validator: validators.is_object },
  set: { validator: validators.is_array },
  smallint: { validator: validators.is_integer },
  text: { validator: validators.is_string },
  time: { validator: validators.is_local_time },
  timestamp: { validator: validators.is_date },
  timeuuid: { validator: validators.is_timeuuid },
  tinyint: { validator: validators.is_integer },
  uuid: { validator: validators.is_uuid },
  varchar: { validator: validators.is_string },
  varint: { validator: validators.is_var_int },
  frozen: { validator: validators.is_frozen }
};

TYPE_MAP.generic_type_validator = function f(fieldtype) {
  if (!this[fieldtype]) return null;

  return {
    validator: this[fieldtype].validator,
    message: function message(value, propName, fieldType) {
      return util.format('Invalid Value: "%s" for Field: %s (Type: %s)', value, propName, fieldType);
    },

    type: 'type_validator'
  };
};

TYPE_MAP.extract_type = function f(val) {
  // decompose composite types
  var decomposed = val ? val.replace(/[\s]/g, '').split(/[<,>]/g) : [''];

  for (var d = 0; d < decomposed.length; d++) {
    if (Object.keys(this).indexOf(decomposed[d]) > -1) {
      return decomposed[d];
    }
  }

  return val;
};

TYPE_MAP.extract_typeDef = function f(val) {
  // decompose composite types
  var decomposed = val ? val.replace(/[\s]/g, '') : '';
  decomposed = decomposed.substr(decomposed.indexOf('<'), decomposed.length - decomposed.indexOf('<'));

  return decomposed;
};

module.exports = TYPE_MAP;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcm0vY2Fzc2FuZHJhX3R5cGVzLmpzIl0sIm5hbWVzIjpbImNoZWNrIiwicmVxdWlyZSIsInV0aWwiLCJjcWwiLCJ2YWxpZGF0b3JzIiwiaXNfYXJyYXkiLCJvYmoiLCJhcnJheSIsImlzX29iamVjdCIsIm9iamVjdCIsImlzX2xvbmciLCJ0eXBlcyIsIkxvbmciLCJpc19kZWNpbWFsIiwiQmlnRGVjaW1hbCIsImlzX2ludGVnZXIiLCJpbnROdW1iZXIiLCJpc192YXJfaW50IiwiSW50ZWdlciIsImlzX2Jvb2xlYW4iLCJpc19udW1iZXIiLCJudW1iZXIiLCJpc19zdHJpbmciLCJzdHJpbmciLCJpc19sb2NhbF9kYXRlIiwiTG9jYWxEYXRlIiwiaXNfbG9jYWxfdGltZSIsIkxvY2FsVGltZSIsImlzX2RhdGUiLCJkYXRlIiwiRGF0ZSIsImlzX2J1ZmZlciIsIkJ1ZmZlciIsImlzX3RpbWV1dWlkIiwiVGltZVV1aWQiLCJpc191dWlkIiwiVXVpZCIsImlzX2luZXQiLCJJbmV0QWRkcmVzcyIsImlzX2Zyb3plbiIsIlRZUEVfTUFQIiwiYXNjaWkiLCJ2YWxpZGF0b3IiLCJiaWdpbnQiLCJibG9iIiwiYm9vbGVhbiIsImNvdW50ZXIiLCJkZWNpbWFsIiwiZG91YmxlIiwiZmxvYXQiLCJpbmV0IiwiaW50IiwibGlzdCIsIm1hcCIsInNldCIsInNtYWxsaW50IiwidGV4dCIsInRpbWUiLCJ0aW1lc3RhbXAiLCJ0aW1ldXVpZCIsInRpbnlpbnQiLCJ1dWlkIiwidmFyY2hhciIsInZhcmludCIsImZyb3plbiIsImdlbmVyaWNfdHlwZV92YWxpZGF0b3IiLCJmIiwiZmllbGR0eXBlIiwibWVzc2FnZSIsInZhbHVlIiwicHJvcE5hbWUiLCJmaWVsZFR5cGUiLCJmb3JtYXQiLCJ0eXBlIiwiZXh0cmFjdF90eXBlIiwidmFsIiwiZGVjb21wb3NlZCIsInJlcGxhY2UiLCJzcGxpdCIsImQiLCJsZW5ndGgiLCJPYmplY3QiLCJrZXlzIiwiaW5kZXhPZiIs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LEdBQWlDLEVBQWxEO0FBQ0FELGVBQWFBLFdBQVdTLE1BQVgsQ0FBa0JULFdBQVdPLE9BQVgsQ0FBbUIsR0FBbkIsQ0FBbEIsRUFBMkNQLFdBQVdJLE1BQVgsR0FBb0JKLFdBQVdPLE9BQVgsQ0FBbUIsR0FBbkIsQ0FBL0QsQ0FBYjs7QUFFQSxTQUFPUCxVQUFQO0FBQ0QsQ0FORDs7QUFRQVUsT0FBT0MsT0FBUCxHQUFpQi9DLFFBQWpCIiwiZmlsZSI6ImNhc3NhbmRyYV90eXBlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGNoZWNrID0gcmVxdWlyZSgnY2hlY2stdHlwZXMnKTtcbmNvbnN0IHV0aWwgPSByZXF1aXJlKCd1dGlsJyk7XG5jb25zdCBjcWwgPSByZXF1aXJlKCdkc2UtZHJpdmVyJyk7XG5cbmNvbnN0IHZhbGlkYXRvcnMgPSB7fTtcbnZhbGlkYXRvcnMuaXNfYXJyYXkgPSAob2JqKSA9PiAoY2hlY2suYXJyYXkob2JqKSk7XG52YWxpZGF0b3JzLmlzX29iamVjdCA9IChvYmopID0+IChjaGVjay5vYmplY3Qob2JqKSk7XG52YWxpZGF0b3JzLmlzX2xvbmcgPSAob2JqKSA9PiAoKG9iaiBpbnN0YW5jZW9mIGNxbC50eXBlcy5Mb25nKSk7XG52YWxpZGF0b3JzLmlzX2RlY2ltYWwgPSAob2JqKSA9PiAoKG9iaiBpbnN0YW5jZW9mIGNxbC50eXBlcy5CaWdEZWNpbWFsKSk7XG52YWxpZGF0b3JzLmlzX2ludGVnZXIgPSAob2JqKSA9PiAoY2hlY2suaW50TnVtYmVyKG9iaikpO1xudmFsaWRhdG9ycy5pc192YXJfaW50ID0gKG9iaikgPT4gKChvYmogaW5zdGFuY2VvZiBjcWwudHlwZXMuSW50ZWdlcikpO1xudmFsaWRhdG9ycy5pc19ib29sZWFuID0gKG9iaikgPT4gKChvYmogPT09IHRydWUgfHwgb2JqID09PSBmYWxzZSkpO1xudmFsaWRhdG9ycy5pc19udW1iZXIgPSAob2JqKSA9PiAoY2hlY2subnVtYmVyKG9iaikpO1xudmFsaWRhdG9ycy5pc19zdHJpbmcgPSAob2JqKSA9PiAoY2hlY2suc3RyaW5nKG9iaikpO1xudmFsaWRhdG9ycy5pc19sb2NhbF9kYXRlID0gKG9iaikgPT4gKChvYmogaW5zdGFuY2VvZiBjcWwudHlwZXMuTG9jYWxEYXRlKSk7XG52YWxpZGF0b3JzLmlzX2xvY2FsX3RpbWUgPSAob2JqKSA9PiAoKG9iaiBpbnN0YW5jZW9mIGNxbC50eXBlcy5Mb2NhbFRpbWUpKTtcbnZhbGlkYXRvcnMuaXNfZGF0ZSA9IChvYmopID0+IChjaGVjay5kYXRlKG5ldyBEYXRlKG9iaikpKTtcbnZhbGlkYXRvcnMuaXNfYnVmZmVyID0gKG9iaikgPT4gKChvYmogaW5zdGFuY2VvZiBCdWZmZXIpKTtcbnZhbGlkYXRvcnMuaXNfdGltZXV1aWQgPSAob2JqKSA9PiAoKG9iaiBpbnN0YW5jZW9mIGNxbC50eXBlcy5UaW1lVXVpZCkpO1xudmFsaWRhdG9ycy5pc191dWlkID0gKG9iaikgPT4gKChvYmogaW5zdGFuY2VvZiBjcWwudHlwZXMuVXVpZCkpO1xudmFsaWRhdG9ycy5pc19pbmV0ID0gKG9iaikgPT4gKChvYmogaW5zdGFuY2VvZiBjcWwudHlwZXMuSW5ldEFkZHJlc3MpKTtcbnZhbGlkYXRvcnMuaXNfZnJvemVuID0gKG9iaikgPT4gKCh2YWxpZGF0b3JzLmlzX2FycmF5KG9iaikgfHwgdmFsaWRhdG9ycy5pc19vYmplY3Qob2JqKSkpO1xuXG5jb25zdCBUWVBFX01BUCA9IHtcbiAgYXNjaWk6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX3N0cmluZyB9LFxuICBiaWdpbnQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2xvbmcgfSxcbiAgYmxvYjogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfYnVmZmVyIH0sXG4gIGJvb2xlYW46IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2Jvb2xlYW4gfSxcbiAgY291bnRlcjogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfbG9uZyB9LFxuICBkYXRlOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19sb2NhbF9kYXRlIH0sXG4gIGRlY2ltYWw6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2RlY2ltYWwgfSxcbiAgZG91YmxlOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19udW1iZXIgfSxcbiAgZmxvYXQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX251bWJlciB9LFxuICBpbmV0OiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19pbmV0IH0sXG4gIGludDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfaW50ZWdlciB9LFxuICBsaXN0OiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19hcnJheSB9LFxuICBtYXA6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX29iamVjdCB9LFxuICBzZXQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2FycmF5IH0sXG4gIHNtYWxsaW50OiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19pbnRlZ2VyIH0sXG4gIHRleHQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX3N0cmluZyB9LFxuICB0aW1lOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19sb2NhbF90aW1lIH0sXG4gIHRpbWVzdGFtcDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfZGF0ZSB9LFxuICB0aW1ldXVpZDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfdGltZXV1aWQgfSxcbiAgdGlueWludDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfaW50ZWdlciB9LFxuICB1dWlkOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc191dWlkIH0sXG4gIHZhcmNoYXI6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX3N0cmluZyB9LFxuICB2YXJpbnQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX3Zhcl9pbnQgfSxcbiAgZnJvemVuOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19mcm96ZW4gfSxcbn07XG5cblxuVFlQRV9NQVAuZ2VuZXJpY190eXBlX3ZhbGlkYXRvciA9IGZ1bmN0aW9uIGYoZmllbGR0eXBlKSB7XG4gIGlmICghdGhpc1tmaWVsZHR5cGVdKSByZXR1cm4gbnVsbDtcblxuICByZXR1cm4ge1xuICAgIHZhbGlkYXRvcjogdGhpc1tmaWVsZHR5cGVdLnZhbGlkYXRvcixcbiAgICBtZXNzYWdlKHZhbHVlLCBwcm9wTmFtZSwgZmllbGRUeXBlKSB7XG4gICAgICByZXR1cm4gdXRpbC5mb3JtYXQoJ0ludmFsaWQgVmFsdWU6IFwiJXNcIiBmb3IgRmllbGQ6ICVzIChUeXBlOiAlcyknLCB2YWx1ZSwgcHJvcE5hbWUsIGZpZWxkVHlwZSk7XG4gICAgfSxcbiAgICB0eXBlOiAndHlwZV92YWxpZGF0b3InLFxuICB9O1xufTtcblxuVFlQRV9NQVAuZXh0cmFjdF90eXBlID0gZnVuY3Rpb24gZih2YWwpIHtcbiAgLy8gZGVjb21wb3NlIGNvbXBvc2l0ZSB0eXBlc1xuICBjb25zdCBkZWNvbXBvc2VkID0gdmFsID8gdmFsLnJlcGxhY2UoL1tcXHNdL2csICcnKS5zcGxpdCgvWzwsPl0vZykgOiBbJyddO1xuXG4gIGZvciAobGV0IGQgPSAwOyBkIDwgZGVjb21wb3NlZC5sZW5ndGg7IGQrKykge1xuICAgIGlmIChPYmplY3Qua2V5cyh0aGlzKS5pbmRleE9mKGRlY29tcG9zZWRbZF0pID4gLTEpIHtcbiAgICAgIHJldHVybiBkZWNvbXBvc2VkW2RdO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB2YWw7XG59O1xuXG5UWVBFX01BUC5leHRyYWN0X3R5cGVEZWYgPSBmdW5jdGlvbiBmKHZhbCkge1xuICAvLyBkZWNvbXBvc2UgY29tcG9zaXRlIHR5cGVzXG4gIGxldCBkZWNvbXBvc2VkID0gdmFsID8gdmFsLnJlcGxhY2UoL1tcXHNdL2csICcnKSA6ICcnO1xuICBkZWNvbXBvc2VkID0gZGVjb21wb3NlZC5zdWJzdHIoZGVjb21wb3NlZC5pbmRleE9mKCc8JyksIGRlY29tcG9zZWQubGVuZ3RoIC0gZGVjb21wb3NlZC5pbmRleE9mKCc8JykpO1xuXG4gIHJldHVybiBkZWNvbXBvc2VkO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBUWVBFX01BUDtcbiJdfQ==