'use strict';

var semver = require('semver');

if (!semver.satisfies(process.version, '>=6.0.0')) {
  require('babel-polyfill');
}

var Promise = require('bluebird');
var _ = require('lodash');
var path = require('path');

var dseDriver = void 0;
try {
  // eslint-disable-next-line import/no-extraneous-dependencies, import/no-unresolved
  dseDriver = require('dse-driver');
} catch (e) {
  dseDriver = null;
}

var cql = Promise.promisifyAll(dseDriver || require('cassandra-driver'));

var ORM = Promise.promisifyAll(require('./orm/apollo'));
var readdirpAsync = Promise.promisify(require('readdirp'));
var debug = require('debug')('express-cassandra');

var exporter = require('./utils/exporter');
var importer = require('./utils/importer');

var CassandraClient = function f(options) {
  this.modelInstance = {};
  this.orm = new ORM(options.clientOptions, options.ormOptions);
  this.orm = Promise.promisifyAll(this.orm);
};

CassandraClient.createClient = function (options) {
  return new CassandraClient(options);
};

CassandraClient.setDirectory = function (directory) {
  CassandraClient.directory = directory;
  return CassandraClient;
};

CassandraClient.syncModelFileToDB = function (file, callback) {
  if (!file.name.includes('Model')) {
    callback();
    return;
  }

  var modelName = CassandraClient._translateFileNameToModelName(file.name);

  if (modelName) {
    var fileLocation = path.join(CassandraClient.directory, file.path);
    // eslint-disable-next-line import/no-dynamic-require
    var defaultModelSchema = require(fileLocation);
    var modelSchema = defaultModelSchema.default ? defaultModelSchema.default : defaultModelSchema;
    CassandraClient.modelInstance[modelName] = CassandraClient.orm.addModel(modelName.toLowerCase(), modelSchema);
    CassandraClient.modelInstance[modelName].syncDB(callback);
    CassandraClient.modelInstance[modelName] = Promise.promisifyAll(CassandraClient.modelInstance[modelName]);
    return;
  }

  callback();
};

CassandraClient.bind = function (options, cb) {
  CassandraClient.modelInstance = {};
  CassandraClient.orm = new ORM(options.clientOptions, options.ormOptions);
  CassandraClient.orm = Promise.promisifyAll(CassandraClient.orm);
  CassandraClient.orm.initAsync().then(function () {
    return readdirpAsync({
      root: CassandraClient.directory,
      fileFilter: ['*.js', '*.javascript', '*.jsx', '*.coffee', '*.coffeescript', '*.iced', '*.script', '*.ts', '*.tsx', '*.typescript', '*.cjsx', '*.co', '*.json', '*.json5', '*.litcoffee', '*.liticed', '*.ls', '*.node', '*.toml', '*.wisp']
    });
  }).then(function (fileList) {
    var syncModelTasks = [];
    var syncModelFileToDBAsync = Promise.promisify(CassandraClient.syncModelFileToDB);
    fileList = fileList.files;
    fileList.forEach(function (file) {
      syncModelTasks.push(syncModelFileToDBAsync(file));
    });
    return Promise.all(syncModelTasks);
  }).then(function () {
    if (cb) cb();
  }).catch(function (err) {
    if (cb && _.isArray(err) && err.length > 0) cb(err[0]);else if (cb) cb(err);
  });
};

CassandraClient.bindAsync = Promise.promisify(CassandraClient.bind);

CassandraClient.prototype.init = function f(callback) {
  this.orm.init(callback);
};

CassandraClient.prototype.initAsync = Promise.promisify(CassandraClient.prototype.init);

CassandraClient.getTableList = function f(callback) {
  var systemClient = this.orm.get_system_client();
  var keyspace = this.orm.get_keyspace_name();
  var tables = [];

  systemClient.connect().then(function () {
    var systemQuery = 'SELECT table_name FROM system_schema.tables WHERE keyspace_name = ?';
    debug(`Finding tables in keyspace: ${keyspace}`);
    return systemClient.execute(systemQuery, [keyspace]);
  }).then(function (result) {
    for (var i = 0; i < result.rows.length; i++) {
      tables.push(result.rows[i].table_name);
    }
  }).then(function () {
    return systemClient.shutdown();
  }).then(function () {
    callback(null, tables);
  }).catch(function (err) {
    callback(err);
  });
};

CassandraClient.getTableListAsync = Promise.promisify(CassandraClient.getTableList);

CassandraClient.export = function f(fixtureDirectory, callback) {
  var _this = this;

  var systemClient = this.orm.get_system_client();
  var keyspace = this.orm.get_keyspace_name();

  systemClient.connect().then(function () {
    return _this.getTableListAsync();
  }).then(function (tables) {
    return Promise.each(tables, function (table) {
      return exporter.processTableExport(systemClient, fixtureDirectory, keyspace, table);
    });
  }).then(function () {
    return systemClient.shutdown();
  }).then(function () {
    debug('==================================================');
    debug(`Completed exporting all tables from keyspace: ${keyspace}`);
    callback();
  }).catch(function (err) {
    debug(err);
    callback(err);
  });
};

CassandraClient.exportAsync = Promise.promisify(CassandraClient.export);

CassandraClient.import = function f(fixtureDirectory, options, callback) {
  var _this2 = this;

  if (arguments.length === 2) {
    callback = options;
    options = {};
  }

  var defaults = {
    batchSize: 1
  };

  options = _.defaultsDeep({}, options, defaults);

  var systemClient = this.orm.get_system_client();
  var keyspace = this.orm.get_keyspace_name();

  systemClient.connect().then(function () {
    return _this2.getTableListAsync();
  }).then(function (tables) {
    return Promise.each(tables, function (table) {
      return importer.processTableImport(systemClient, fixtureDirectory, keyspace, table, options.batchSize);
    });
  }).then(function () {
    return systemClient.shutdown();
  }).then(function () {
    debug('==================================================');
    debug(`Completed importing to keyspace: ${keyspace}`);
    callback();
  }).catch(function (err) {
    debug(err);
    callback(err);
  });
};

CassandraClient.importAsync = Promise.promisify(CassandraClient.import);

CassandraClient.prototype.loadSchema = function f(modelName, modelSchema) {
  this.modelInstance[modelName] = this.orm.addModel(modelName, modelSchema);
  this.modelInstance[modelName] = Promise.promisifyAll(this.modelInstance[modelName]);
  return this.modelInstance[modelName];
};

CassandraClient.uuid = function () {
  return cql.types.Uuid.random();
};

CassandraClient.uuidFromString = function (str) {
  return cql.types.Uuid.fromString(str);
};

CassandraClient.uuidFromBuffer = function (buf) {
  return new cql.types.Uuid(buf);
};

CassandraClient.timeuuid = function () {
  return cql.types.TimeUuid.now();
};

CassandraClient.timeuuidFromDate = function (date) {
  return cql.types.TimeUuid.fromDate(date);
};

CassandraClient.timeuuidFromString = function (str) {
  return cql.types.TimeUuid.fromString(str);
};

CassandraClient.timeuuidFromBuffer = function (buf) {
  return new cql.types.TimeUuid(buf);
};

CassandraClient.maxTimeuuid = function (date) {
  return cql.types.TimeUuid.max(date);
};

CassandraClient.minTimeuuid = function (date) {
  return cql.types.TimeUuid.min(date);
};

CassandraClient.prototype.doBatch = function f(queries, options, callback) {
  if (arguments.length === 2) {
    callback = options;
    options = {};
  }

  var defaults = {
    prepare: true
  };

  options = _.defaultsDeep({}, options, defaults);

  var randomModel = this.modelInstance[Object.keys(this.modelInstance)[0]];
  var beforeHooks = [];

  var batchResult = void 0;
  Promise.all(beforeHooks).then(function () {
    if (queries.length > 1) {
      return randomModel.execute_batchAsync(queries, options);
    }
    if (queries.length > 0) {
      debug('single query provided for batch request, applying as non batch query');
      return randomModel.execute_queryAsync(queries[0].query, queries[0].params, options);
    }
    debug('no queries provided for batch request, empty array found, doing nothing');
    return {};
  }).then(function (response) {
    batchResult = response;
    for (var i = 0; i < queries.length; i++) {
      var afterHookResponse = queries[i].after_hook();
      if (afterHookResponse !== true) {
        callback(afterHookResponse);
        return;
      }
    }
    callback(null, batchResult);
  }).catch(function (err) {
    callback(err);
  });
};

CassandraClient.prototype.doBatchAsync = Promise.promisify(CassandraClient.prototype.doBatch);

CassandraClient.doBatch = function f(queries, options, callback) {
  if (arguments.length === 2) {
    callback = options;
    options = {};
  }

  var defaults = {
    prepare: true
  };

  options = _.defaultsDeep({}, options, defaults);

  CassandraClient.prototype.doBatch.call(CassandraClient, queries, options, callback);
};

CassandraClient.doBatchAsync = Promise.promisify(CassandraClient.doBatch);

CassandraClient._translateFileNameToModelName = function (fileName) {
  return fileName.slice(0, fileName.lastIndexOf('.')).replace('Model', '');
};

Object.defineProperties(CassandraClient, {
  consistencies: {
    get() {
      return cql.types.consistencies;
    }
  },
  datatypes: {
    get() {
      return cql.types;
    }
  },
  driver: {
    get() {
      return cql;
    }
  },
  instance: {
    get() {
      return CassandraClient.modelInstance;
    }
  },
  close: {
    get() {
      return CassandraClient.orm.close;
    }
  },
  closeAsync: {
    get() {
      return Promise.promisify(CassandraClient.orm.close);
    }
  }
});

Object.defineProperties(CassandraClient.prototype, {
  consistencies: {
    get() {
      return cql.types.consistencies;
    }
  },
  datatypes: {
    get() {
      return cql.types;
    }
  },
  driver: {
    get() {
      return cql;
    }
  },
  instance: {
    get() {
      return this.modelInstance;
    }
  },
  close: {
    get() {
      return this.orm.close;
    }
  },
  closeAsync: {
    get() {
      return Promise.promisify(this.orm.close);
    }
  }
});

CassandraClient.prototype.uuid = CassandraClient.uuid;
CassandraClient.prototype.uuidFromString = CassandraClient.uuidFromString;
CassandraClient.prototype.uuidFromBuffer = CassandraClient.uuidFromBuffer;
CassandraClient.prototype.timeuuid = CassandraClient.timeuuid;
CassandraClient.prototype.timeuuidFromDate = CassandraClient.timeuuidFromDate;
CassandraClient.prototype.timeuuidFromString = CassandraClient.timeuuidFromString;
CassandraClient.prototype.timeuuidFromBuffer = CassandraClient.timeuuidFromBuffer;
CassandraClient.prototype.maxTimeuuid = CassandraClient.maxTimeuuid;
CassandraClient.prototype.minTimeuuid = CassandraClient.minTimeuuid;

CassandraClient.prototype._translateFileNameToModelName = CassandraClient._translateFileNameToModelName;

module.exports = CassandraClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9leHByZXNzQ2Fzc2FuZHJhLmpzIl0sIm5hbWVzIjpbInNlbXZlciIsInJlcXVpcmUiLCJzYXRpc2ZpZXMiLCJwcm9jZXNzIiwidmVyc2lvbiIsIlByb21pc2UiLCJfIiwicGF0aCIsImRzZURyaXZlciIsImUiLCJjcWwiLCJwcm9taXNpZnlBbGwiLCJPUk0iLCJyZWFkZGlycEFzeW5jIiwicHJvbWlzaWZ5IiwiZGVidWciLCJleHBvcnRlciIsImltcG9ydGVyIiwiQ2Fzc2FuZHJhQ2xpZW50IiwiZiIsIm9wdGlvbnMiLCJtb2RlbEluc3RhbmNlIiwib3JtIiwiY2xpZW50T3B0aW9ucyIsIm9ybU9wdGlvbnMiLCJjcmVhdGVDbGllbnQiLCJzZXREaXJlY3RvcnkiLCJkaXJlY3RvcnkiLCJzeW5jTW9kZWxGaWxlVG9EQiIsImZpbGUiLCJjYWxsYmFjayIsIm5hbWUiLCJpbmNsdWRlcyIsIm1vZGVsTmFtZSIsIl90cmFuc2xhdGVGaWxlTmFtZVRvTW9kZWxOYW1lIiwiZmlsZUxvY2F0aW9uIiwiam9pbiIsImRlZmF1bHRNb2RlbFNjaGVtYSIsIm1vZGVsU2NoZW1hIiwiZGVmYXVsdCIsImFkZE1vZGVsIiwidG9Mb3dlckNhc2UiLCJzeW5jREIiLCJiaW5kIiwiY2IiLCJpbml0QXN5bmMiLCJ0aGVuIiwicm9vdCIsImZpbGVGaWx0ZXIiLCJmaWxlTGlzdCIsInN5bmNNb2RlbFRhc2tzIiwic3luY01vZGVsRmlsZVRvREJBc3luYyIsImZpbGVzIiwiZm9yRWFjaCIsInB1c2giLCJhbGwiLCJjYXRjaCIsImVyciIsImlzQXJyYXkiLCJsZW5ndGgiLCJiaW5kQXN5bmMiLCJwcm90b3R5cGUiLCJpbml0IiwiZ2V0VGFibGVMaXN0Iiwic3lzdGVtQ2xpZW50IiwiZ2V0X3N5c3RlbV9jbGllbnQiLCJrZXlzcGFjZSIsImdldF9rZXlzcGFjZV9uYW1lIiwidGFibGVzIiwiY29ubmVjdCIsInN5c3RlbVF1ZXJ5IiwiZXhlY3V0ZSIsInJlc3VsdCIsImkiLCJyb3dzIiwidGFibGVfbmFtZSIsInNodXRkb3duIiwiZ2V0VGFibGVMaXN0QXN5bmMiLCJleHBvcnQiLCJmaXh0dXJlRGlyZWN0b3J5IiwiZWFjaCIsInRhYmxlIiwicHJvY2Vzc1RhYmxlRXhwb3J0IiwiZXhwb3J0QXN5bmMiLCJpbXBvcnQiLCJhcmd1bWVudHMiLCJkZWZhdWx0cyIsImJhdGNoU2l6ZSIsImRlZmF1bHRzRGVlcCIsInByb2Nlc3NUYWJsZUltcG9ydCIsImltcG9ydEFzeW5jIiwibG9hZFNjaGVtYSIsInV1aWQiLCJ0eXBlcyIsIlV1aWQiLCJyYW5kb20iLCJ1dWlkRnJvbVN0cmluZyIsInN0ciIsImZyb21TdHJpbmciLCJ1dWlkRnJvbUJ1ZmZlciIsImJ1ZiIsInRpbWV1dWlkIiwiVGltZVV1aWQiLCJub3ciLCJ0aW1ldXVpZEZyb21EYXRlIiwiZGF0ZSIsImZyb21EYXRlIiwidGltZXV1aWRGcm9tU3RyaW5nIiwidGltZXV1aWRGcm9tQnVmZmVyIiwibWF4VGltZXV1aWQiLCJtYXgiLCJtaW5UaW1ldXVpZCIsIm1pbiIsImRvQmF0Y2giLCJxdWVyaWVzIiwicHJlcGFyZSIsInJhbmRvbU1vZGVsIiwiT2JqZWN0Iiwia2V5cyIsImJlZm9yZUhvb2tzIiwiYmF0Y2hSZXN1bHQiLCJleGVjdXRlX2JhdGNoQXN5bmMiLCJleGVjdXRlX3F1ZXJ5QXN5bmMiLCJxdWVyeSIsInBhcmFtcyIsInJlc3BvbnNlIiwiYWZ0ZXJIb29rUmVzcG9uc2UiLCJhZnRlcl9ob29rIiwiZG9CYXRjaEFzeW5jIiwiY2FsbCIsImZpbGVOYW1lIiwic2xpY2UiLCJsYXN0SW5kZXhPZiIsInJlcGxhY2UiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiY29uc2lzdGVuY2llcyIsImdldCIsImRhdGF0eXBlcyIsImRyaXZlciIsImluc3RhbmNlIiwiY2xvc2UiLCJjbG9zZUFzeW5jIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxTQUFTQyxRQUFRLFFBQVIsQ0FBZjs7QUFFQSxJQUFJLENB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QjJDLFNBQWhCLENBQTBCbUMsY0FBMUIsR0FBMkM5RSxnQkFBZ0I4RSxjQUEzRDtBQUNBOUUsZ0JBQWdCMkMsU0FBaEIsQ0FBMEJzQyxjQUExQixHQUEyQ2pGLGdCQUFnQmlGLGNBQTNEO0FBQ0FqRixnQkFBZ0IyQyxTQUFoQixDQUEwQndDLFFBQTFCLEdBQXFDbkYsZ0JBQWdCbUYsUUFBckQ7QUFDQW5GLGdCQUFnQjJDLFNBQWhCLENBQTBCMkMsZ0JBQTFCLEdBQTZDdEYsZ0JBQWdCc0YsZ0JBQTdEO0FBQ0F0RixnQkFBZ0IyQyxTQUFoQixDQUEwQjhDLGtCQUExQixHQUErQ3pGLGdCQUFnQnlGLGtCQUEvRDtBQUNBekYsZ0JBQWdCMkMsU0FBaEIsQ0FBMEIrQyxrQkFBMUIsR0FBK0MxRixnQkFBZ0IwRixrQkFBL0Q7QUFDQTFGLGdCQUFnQjJDLFNBQWhCLENBQTBCZ0QsV0FBMUIsR0FBd0MzRixnQkFBZ0IyRixXQUF4RDtBQUNBM0YsZ0JBQWdCMkMsU0FBaEIsQ0FBMEJrRCxXQUExQixHQUF3QzdGLGdCQUFnQjZGLFdBQXhEOztBQUVBN0YsZ0JBQWdCMkMsU0FBaEIsQ0FBMEIzQiw2QkFBMUIsR0FBMERoQixnQkFBZ0JnQiw2QkFBMUU7O0FBRUE0RyxPQUFPQyxPQUFQLEdBQWlCN0gsZUFBakIiLCJmaWxlIjoiZXhwcmVzc0Nhc3NhbmRyYS5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNlbXZlciA9IHJlcXVpcmUoJ3NlbXZlcicpO1xuXG5pZiAoIXNlbXZlci5zYXRpc2ZpZXMocHJvY2Vzcy52ZXJzaW9uLCAnPj02LjAuMCcpKSB7XG4gIHJlcXVpcmUoJ2JhYmVsLXBvbHlmaWxsJyk7XG59XG5cbmNvbnN0IFByb21pc2UgPSByZXF1aXJlKCdibHVlYmlyZCcpO1xuY29uc3QgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcblxubGV0IGRzZURyaXZlcjtcbnRyeSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvbm8tZXh0cmFuZW91cy1kZXBlbmRlbmNpZXMsIGltcG9ydC9uby11bnJlc29sdmVkXG4gIGRzZURyaXZlciA9IHJlcXVpcmUoJ2RzZS1kcml2ZXInKTtcbn0gY2F0Y2ggKGUpIHtcbiAgZHNlRHJpdmVyID0gbnVsbDtcbn1cblxuY29uc3QgY3FsID0gUHJvbWlzZS5wcm9taXNpZnlBbGwoZHNlRHJpdmVyIHx8IHJlcXVpcmUoJ2Nhc3NhbmRyYS1kcml2ZXInKSk7XG5cbmNvbnN0IE9STSA9IFByb21pc2UucHJvbWlzaWZ5QWxsKHJlcXVpcmUoJy4vb3JtL2Fwb2xsbycpKTtcbmNvbnN0IHJlYWRkaXJwQXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShyZXF1aXJlKCdyZWFkZGlycCcpKTtcbmNvbnN0IGRlYnVnID0gcmVxdWlyZSgnZGVidWcnKSgnZXhwcmVzcy1jYXNzYW5kcmEnKTtcblxuY29uc3QgZXhwb3J0ZXIgPSByZXF1aXJlKCcuL3V0aWxzL2V4cG9ydGVyJyk7XG5jb25zdCBpbXBvcnRlciA9IHJlcXVpcmUoJy4vdXRpbHMvaW1wb3J0ZXInKTtcblxuY29uc3QgQ2Fzc2FuZHJhQ2xpZW50ID0gZnVuY3Rpb24gZihvcHRpb25zKSB7XG4gIHRoaXMubW9kZWxJbnN0YW5jZSA9IHt9O1xuICB0aGlzLm9ybSA9IG5ldyBPUk0ob3B0aW9ucy5jbGllbnRPcHRpb25zLCBvcHRpb25zLm9ybU9wdGlvbnMpO1xuICB0aGlzLm9ybSA9IFByb21pc2UucHJvbWlzaWZ5QWxsKHRoaXMub3JtKTtcbn07XG5cbkNhc3NhbmRyYUNsaWVudC5jcmVhdGVDbGllbnQgPSAob3B0aW9ucykgPT4gKG5ldyBDYXNzYW5kcmFDbGllbnQob3B0aW9ucykpO1xuXG5DYXNzYW5kcmFDbGllbnQuc2V0RGlyZWN0b3J5ID0gKGRpcmVjdG9yeSkgPT4ge1xuICBDYXNzYW5kcmFDbGllbnQuZGlyZWN0b3J5ID0gZGlyZWN0b3J5O1xuICByZXR1cm4gQ2Fzc2FuZHJhQ2xpZW50O1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnN5bmNNb2RlbEZpbGVUb0RCID0gKGZpbGUsIGNhbGxiYWNrKSA9PiB7XG4gIGlmICghZmlsZS5uYW1lLmluY2x1ZGVzKCdNb2RlbCcpKSB7XG4gICAgY2FsbGJhY2soKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBtb2RlbE5hbWUgPSBDYXNzYW5kcmFDbGllbnQuX3RyYW5zbGF0ZUZpbGVOYW1lVG9Nb2RlbE5hbWUoZmlsZS5uYW1lKTtcblxuICBpZiAobW9kZWxOYW1lKSB7XG4gICAgY29uc3QgZmlsZUxvY2F0aW9uID0gcGF0aC5qb2luKENhc3NhbmRyYUNsaWVudC5kaXJlY3RvcnksIGZpbGUucGF0aCk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGltcG9ydC9uby1keW5hbWljLXJlcXVpcmVcbiAgICBjb25zdCBkZWZhdWx0TW9kZWxTY2hlbWEgPSByZXF1aXJlKGZpbGVMb2NhdGlvbik7XG4gICAgY29uc3QgbW9kZWxTY2hlbWEgPSBkZWZhdWx0TW9kZWxTY2hlbWEuZGVmYXVsdCA/IGRlZmF1bHRNb2RlbFNjaGVtYS5kZWZhdWx0IDogZGVmYXVsdE1vZGVsU2NoZW1hO1xuICAgIENhc3NhbmRyYUNsaWVudC5tb2RlbEluc3RhbmNlW21vZGVsTmFtZV0gPSBDYXNzYW5kcmFDbGllbnQub3JtLmFkZE1vZGVsKG1vZGVsTmFtZS50b0xvd2VyQ2FzZSgpLCBtb2RlbFNjaGVtYSk7XG4gICAgQ2Fzc2FuZHJhQ2xpZW50Lm1vZGVsSW5zdGFuY2VbbW9kZWxOYW1lXS5zeW5jREIoY2FsbGJhY2spO1xuICAgIENhc3NhbmRyYUNsaWVudC5tb2RlbEluc3RhbmNlW21vZGVsTmFtZV0gPSBQcm9taXNlLnByb21pc2lmeUFsbChDYXNzYW5kcmFDbGllbnQubW9kZWxJbnN0YW5jZVttb2RlbE5hbWVdKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjYWxsYmFjaygpO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmJpbmQgPSAob3B0aW9ucywgY2IpID0+IHtcbiAgQ2Fzc2FuZHJhQ2xpZW50Lm1vZGVsSW5zdGFuY2UgPSB7fTtcbiAgQ2Fzc2FuZHJhQ2xpZW50Lm9ybSA9IG5ldyBPUk0ob3B0aW9ucy5jbGllbnRPcHRpb25zLCBvcHRpb25zLm9ybU9wdGlvbnMpO1xuICBDYXNzYW5kcmFDbGllbnQub3JtID0gUHJvbWlzZS5wcm9taXNpZnlBbGwoQ2Fzc2FuZHJhQ2xpZW50Lm9ybSk7XG4gIENhc3NhbmRyYUNsaWVudC5vcm0uaW5pdEFzeW5jKClcbiAgICAudGhlbigoKSA9PiByZWFkZGlycEFzeW5jKHtcbiAgICAgIHJvb3Q6IENhc3NhbmRyYUNsaWVudC5kaXJlY3RvcnksXG4gICAgICBmaWxlRmlsdGVyOiBbXG4gICAgICAgICcqLmpzJywgJyouamF2YXNjcmlwdCcsICcqLmpzeCcsICcqLmNvZmZlZScsICcqLmNvZmZlZXNjcmlwdCcsICcqLmljZWQnLFxuICAgICAgICAnKi5zY3JpcHQnLCAnKi50cycsICcqLnRzeCcsICcqLnR5cGVzY3JpcHQnLCAnKi5janN4JywgJyouY28nLCAnKi5qc29uJyxcbiAgICAgICAgJyouanNvbjUnLCAnKi5saXRjb2ZmZWUnLCAnKi5saXRpY2VkJywgJyoubHMnLCAnKi5ub2RlJywgJyoudG9tbCcsICcqLndpc3AnLFxuICAgICAgXSxcbiAgICB9KSlcbiAgICAudGhlbigoZmlsZUxpc3QpID0+IHtcbiAgICAgIGNvbnN0IHN5bmNNb2RlbFRhc2tzID0gW107XG4gICAgICBjb25zdCBzeW5jTW9kZWxGaWxlVG9EQkFzeW5jID0gUHJvbWlzZS5wcm9taXNpZnkoQ2Fzc2FuZHJhQ2xpZW50LnN5bmNNb2RlbEZpbGVUb0RCKTtcbiAgICAgIGZpbGVMaXN0ID0gZmlsZUxpc3QuZmlsZXM7XG4gICAgICBmaWxlTGlzdC5mb3JFYWNoKChmaWxlKSA9PiB7XG4gICAgICAgIHN5bmNNb2RlbFRhc2tzLnB1c2goc3luY01vZGVsRmlsZVRvREJBc3luYyhmaWxlKSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChzeW5jTW9kZWxUYXNrcyk7XG4gICAgfSlcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBpZiAoY2IpIGNiKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgaWYgKGNiICYmIF8uaXNBcnJheShlcnIpICYmIGVyci5sZW5ndGggPiAwKSBjYihlcnJbMF0pO1xuICAgICAgZWxzZSBpZiAoY2IpIGNiKGVycik7XG4gICAgfSk7XG59O1xuXG5DYXNzYW5kcmFDbGllbnQuYmluZEFzeW5jID0gUHJvbWlzZS5wcm9taXNpZnkoQ2Fzc2FuZHJhQ2xpZW50LmJpbmQpO1xuXG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiBmKGNhbGxiYWNrKSB7XG4gIHRoaXMub3JtLmluaXQoY2FsbGJhY2spO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS5pbml0QXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmluaXQpO1xuXG5DYXNzYW5kcmFDbGllbnQuZ2V0VGFibGVMaXN0ID0gZnVuY3Rpb24gZihjYWxsYmFjaykge1xuICBjb25zdCBzeXN0ZW1DbGllbnQgPSB0aGlzLm9ybS5nZXRfc3lzdGVtX2NsaWVudCgpO1xuICBjb25zdCBrZXlzcGFjZSA9IHRoaXMub3JtLmdldF9rZXlzcGFjZV9uYW1lKCk7XG4gIGNvbnN0IHRhYmxlcyA9IFtdO1xuXG4gIHN5c3RlbUNsaWVudC5jb25uZWN0KClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBjb25zdCBzeXN0ZW1RdWVyeSA9ICdTRUxFQ1QgdGFibGVfbmFtZSBGUk9NIHN5c3RlbV9zY2hlbWEudGFibGVzIFdIRVJFIGtleXNwYWNlX25hbWUgPSA/JztcbiAgICAgIGRlYnVnKGBGaW5kaW5nIHRhYmxlcyBpbiBrZXlzcGFjZTogJHtrZXlzcGFjZX1gKTtcbiAgICAgIHJldHVybiBzeXN0ZW1DbGllbnQuZXhlY3V0ZShzeXN0ZW1RdWVyeSwgW2tleXNwYWNlXSk7XG4gICAgfSlcbiAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdC5yb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRhYmxlcy5wdXNoKHJlc3VsdC5yb3dzW2ldLnRhYmxlX25hbWUpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLnRoZW4oKCkgPT4gc3lzdGVtQ2xpZW50LnNodXRkb3duKCkpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgY2FsbGJhY2sobnVsbCwgdGFibGVzKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjYWxsYmFjayhlcnIpO1xuICAgIH0pO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmdldFRhYmxlTGlzdEFzeW5jID0gUHJvbWlzZS5wcm9taXNpZnkoQ2Fzc2FuZHJhQ2xpZW50LmdldFRhYmxlTGlzdCk7XG5cbkNhc3NhbmRyYUNsaWVudC5leHBvcnQgPSBmdW5jdGlvbiBmKGZpeHR1cmVEaXJlY3RvcnksIGNhbGxiYWNrKSB7XG4gIGNvbnN0IHN5c3RlbUNsaWVudCA9IHRoaXMub3JtLmdldF9zeXN0ZW1fY2xpZW50KCk7XG4gIGNvbnN0IGtleXNwYWNlID0gdGhpcy5vcm0uZ2V0X2tleXNwYWNlX25hbWUoKTtcblxuICBzeXN0ZW1DbGllbnQuY29ubmVjdCgpXG4gICAgLnRoZW4oKCkgPT4gdGhpcy5nZXRUYWJsZUxpc3RBc3luYygpKVxuICAgIC50aGVuKCh0YWJsZXMpID0+XG4gICAgICBQcm9taXNlLmVhY2godGFibGVzLCAodGFibGUpID0+XG4gICAgICAgIGV4cG9ydGVyLnByb2Nlc3NUYWJsZUV4cG9ydChzeXN0ZW1DbGllbnQsIGZpeHR1cmVEaXJlY3RvcnksIGtleXNwYWNlLCB0YWJsZSkpKVxuICAgIC50aGVuKCgpID0+IHN5c3RlbUNsaWVudC5zaHV0ZG93bigpKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGRlYnVnKCc9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScpO1xuICAgICAgZGVidWcoYENvbXBsZXRlZCBleHBvcnRpbmcgYWxsIHRhYmxlcyBmcm9tIGtleXNwYWNlOiAke2tleXNwYWNlfWApO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBkZWJ1ZyhlcnIpO1xuICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICB9KTtcbn07XG5cbkNhc3NhbmRyYUNsaWVudC5leHBvcnRBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KENhc3NhbmRyYUNsaWVudC5leHBvcnQpO1xuXG5DYXNzYW5kcmFDbGllbnQuaW1wb3J0ID0gZnVuY3Rpb24gZihmaXh0dXJlRGlyZWN0b3J5LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICBvcHRpb25zID0ge307XG4gIH1cblxuICBjb25zdCBkZWZhdWx0cyA9IHtcbiAgICBiYXRjaFNpemU6IDEsXG4gIH07XG5cbiAgb3B0aW9ucyA9IF8uZGVmYXVsdHNEZWVwKHt9LCBvcHRpb25zLCBkZWZhdWx0cyk7XG5cbiAgY29uc3Qgc3lzdGVtQ2xpZW50ID0gdGhpcy5vcm0uZ2V0X3N5c3RlbV9jbGllbnQoKTtcbiAgY29uc3Qga2V5c3BhY2UgPSB0aGlzLm9ybS5nZXRfa2V5c3BhY2VfbmFtZSgpO1xuXG4gIHN5c3RlbUNsaWVudC5jb25uZWN0KClcbiAgICAudGhlbigoKSA9PiB0aGlzLmdldFRhYmxlTGlzdEFzeW5jKCkpXG4gICAgLnRoZW4oKHRhYmxlcykgPT5cbiAgICAgIFByb21pc2UuZWFjaCh0YWJsZXMsICh0YWJsZSkgPT5cbiAgICAgICAgaW1wb3J0ZXIucHJvY2Vzc1RhYmxlSW1wb3J0KHN5c3RlbUNsaWVudCwgZml4dHVyZURpcmVjdG9yeSwga2V5c3BhY2UsIHRhYmxlLCBvcHRpb25zLmJhdGNoU2l6ZSkpKVxuICAgIC50aGVuKCgpID0+IHN5c3RlbUNsaWVudC5zaHV0ZG93bigpKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGRlYnVnKCc9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScpO1xuICAgICAgZGVidWcoYENvbXBsZXRlZCBpbXBvcnRpbmcgdG8ga2V5c3BhY2U6ICR7a2V5c3BhY2V9YCk7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGRlYnVnKGVycik7XG4gICAgICBjYWxsYmFjayhlcnIpO1xuICAgIH0pO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmltcG9ydEFzeW5jID0gUHJvbWlzZS5wcm9taXNpZnkoQ2Fzc2FuZHJhQ2xpZW50LmltcG9ydCk7XG5cbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUubG9hZFNjaGVtYSA9IGZ1bmN0aW9uIGYobW9kZWxOYW1lLCBtb2RlbFNjaGVtYSkge1xuICB0aGlzLm1vZGVsSW5zdGFuY2VbbW9kZWxOYW1lXSA9IHRoaXMub3JtLmFkZE1vZGVsKG1vZGVsTmFtZSwgbW9kZWxTY2hlbWEpO1xuICB0aGlzLm1vZGVsSW5zdGFuY2VbbW9kZWxOYW1lXSA9IFByb21pc2UucHJvbWlzaWZ5QWxsKHRoaXMubW9kZWxJbnN0YW5jZVttb2RlbE5hbWVdKTtcbiAgcmV0dXJuIHRoaXMubW9kZWxJbnN0YW5jZVttb2RlbE5hbWVdO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnV1aWQgPSAoKSA9PiAoY3FsLnR5cGVzLlV1aWQucmFuZG9tKCkpO1xuXG5DYXNzYW5kcmFDbGllbnQudXVpZEZyb21TdHJpbmcgPSAoc3RyKSA9PiAoY3FsLnR5cGVzLlV1aWQuZnJvbVN0cmluZyhzdHIpKTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnV1aWRGcm9tQnVmZmVyID0gKGJ1ZikgPT4gKG5ldyBjcWwudHlwZXMuVXVpZChidWYpKTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnRpbWV1dWlkID0gKCkgPT4gKGNxbC50eXBlcy5UaW1lVXVpZC5ub3coKSk7XG5cbkNhc3NhbmRyYUNsaWVudC50aW1ldXVpZEZyb21EYXRlID0gKGRhdGUpID0+IChjcWwudHlwZXMuVGltZVV1aWQuZnJvbURhdGUoZGF0ZSkpO1xuXG5DYXNzYW5kcmFDbGllbnQudGltZXV1aWRGcm9tU3RyaW5nID0gKHN0cikgPT4gKGNxbC50eXBlcy5UaW1lVXVpZC5mcm9tU3RyaW5nKHN0cikpO1xuXG5DYXNzYW5kcmFDbGllbnQudGltZXV1aWRGcm9tQnVmZmVyID0gKGJ1ZikgPT4gKG5ldyBjcWwudHlwZXMuVGltZVV1aWQoYnVmKSk7XG5cbkNhc3NhbmRyYUNsaWVudC5tYXhUaW1ldXVpZCA9IChkYXRlKSA9PiAoY3FsLnR5cGVzLlRpbWVVdWlkLm1heChkYXRlKSk7XG5cbkNhc3NhbmRyYUNsaWVudC5taW5UaW1ldXVpZCA9IChkYXRlKSA9PiAoY3FsLnR5cGVzLlRpbWVVdWlkLm1pbihkYXRlKSk7XG5cbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUuZG9CYXRjaCA9IGZ1bmN0aW9uIGYocXVlcmllcywgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9XG5cbiAgY29uc3QgZGVmYXVsdHMgPSB7XG4gICAgcHJlcGFyZTogdHJ1ZSxcbiAgfTtcblxuICBvcHRpb25zID0gXy5kZWZhdWx0c0RlZXAoe30sIG9wdGlvbnMsIGRlZmF1bHRzKTtcblxuICBjb25zdCByYW5kb21Nb2RlbCA9IHRoaXMubW9kZWxJbnN0YW5jZVtPYmplY3Qua2V5cyh0aGlzLm1vZGVsSW5zdGFuY2UpWzBdXTtcbiAgY29uc3QgYmVmb3JlSG9va3MgPSBbXTtcblxuICBsZXQgYmF0Y2hSZXN1bHQ7XG4gIFByb21pc2UuYWxsKGJlZm9yZUhvb2tzKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGlmIChxdWVyaWVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgcmV0dXJuIHJhbmRvbU1vZGVsLmV4ZWN1dGVfYmF0Y2hBc3luYyhxdWVyaWVzLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIGlmIChxdWVyaWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZGVidWcoJ3NpbmdsZSBxdWVyeSBwcm92aWRlZCBmb3IgYmF0Y2ggcmVxdWVzdCwgYXBwbHlpbmcgYXMgbm9uIGJhdGNoIHF1ZXJ5Jyk7XG4gICAgICAgIHJldHVybiByYW5kb21Nb2RlbC5leGVjdXRlX3F1ZXJ5QXN5bmMocXVlcmllc1swXS5xdWVyeSwgcXVlcmllc1swXS5wYXJhbXMsIG9wdGlvbnMpO1xuICAgICAgfVxuICAgICAgZGVidWcoJ25vIHF1ZXJpZXMgcHJvdmlkZWQgZm9yIGJhdGNoIHJlcXVlc3QsIGVtcHR5IGFycmF5IGZvdW5kLCBkb2luZyBub3RoaW5nJyk7XG4gICAgICByZXR1cm4ge307XG4gICAgfSlcbiAgICAudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgIGJhdGNoUmVzdWx0ID0gcmVzcG9uc2U7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1ZXJpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgYWZ0ZXJIb29rUmVzcG9uc2UgPSBxdWVyaWVzW2ldLmFmdGVyX2hvb2soKTtcbiAgICAgICAgaWYgKGFmdGVySG9va1Jlc3BvbnNlICE9PSB0cnVlKSB7XG4gICAgICAgICAgY2FsbGJhY2soYWZ0ZXJIb29rUmVzcG9uc2UpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY2FsbGJhY2sobnVsbCwgYmF0Y2hSZXN1bHQpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgfSk7XG59O1xuXG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmRvQmF0Y2hBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KENhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUuZG9CYXRjaCk7XG5cbkNhc3NhbmRyYUNsaWVudC5kb0JhdGNoID0gZnVuY3Rpb24gZihxdWVyaWVzLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMikge1xuICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICBvcHRpb25zID0ge307XG4gIH1cblxuICBjb25zdCBkZWZhdWx0cyA9IHtcbiAgICBwcmVwYXJlOiB0cnVlLFxuICB9O1xuXG4gIG9wdGlvbnMgPSBfLmRlZmF1bHRzRGVlcCh7fSwgb3B0aW9ucywgZGVmYXVsdHMpO1xuXG4gIENhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUuZG9CYXRjaC5jYWxsKENhc3NhbmRyYUNsaWVudCwgcXVlcmllcywgb3B0aW9ucywgY2FsbGJhY2spO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmRvQmF0Y2hBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KENhc3NhbmRyYUNsaWVudC5kb0JhdGNoKTtcblxuQ2Fzc2FuZHJhQ2xpZW50Ll90cmFuc2xhdGVGaWxlTmFtZVRvTW9kZWxOYW1lID0gKGZpbGVOYW1lKSA9PiAoXG4gIGZpbGVOYW1lLnNsaWNlKDAsIGZpbGVOYW1lLmxhc3RJbmRleE9mKCcuJykpLnJlcGxhY2UoJ01vZGVsJywgJycpXG4pO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhDYXNzYW5kcmFDbGllbnQsIHtcbiAgY29uc2lzdGVuY2llczoge1xuICAgIGdldCgpIHtcbiAgICAgIHJldHVybiBjcWwudHlwZXMuY29uc2lzdGVuY2llcztcbiAgICB9LFxuICB9LFxuICBkYXRhdHlwZXM6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gY3FsLnR5cGVzO1xuICAgIH0sXG4gIH0sXG4gIGRyaXZlcjoge1xuICAgIGdldCgpIHtcbiAgICAgIHJldHVybiBjcWw7XG4gICAgfSxcbiAgfSxcbiAgaW5zdGFuY2U6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gQ2Fzc2FuZHJhQ2xpZW50Lm1vZGVsSW5zdGFuY2U7XG4gICAgfSxcbiAgfSxcbiAgY2xvc2U6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gQ2Fzc2FuZHJhQ2xpZW50Lm9ybS5jbG9zZTtcbiAgICB9LFxuICB9LFxuICBjbG9zZUFzeW5jOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucHJvbWlzaWZ5KENhc3NhbmRyYUNsaWVudC5vcm0uY2xvc2UpO1xuICAgIH0sXG4gIH0sXG59KTtcblxuXG5PYmplY3QuZGVmaW5lUHJvcGVydGllcyhDYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLCB7XG4gIGNvbnNpc3RlbmNpZXM6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gY3FsLnR5cGVzLmNvbnNpc3RlbmNpZXM7XG4gICAgfSxcbiAgfSxcbiAgZGF0YXR5cGVzOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIGNxbC50eXBlcztcbiAgICB9LFxuICB9LFxuICBkcml2ZXI6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gY3FsO1xuICAgIH0sXG4gIH0sXG4gIGluc3RhbmNlOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMubW9kZWxJbnN0YW5jZTtcbiAgICB9LFxuICB9LFxuICBjbG9zZToge1xuICAgIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLm9ybS5jbG9zZTtcbiAgICB9LFxuICB9LFxuICBjbG9zZUFzeW5jOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIFByb21pc2UucHJvbWlzaWZ5KHRoaXMub3JtLmNsb3NlKTtcbiAgICB9LFxuICB9LFxufSk7XG5cbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUudXVpZCA9IENhc3NhbmRyYUNsaWVudC51dWlkO1xuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS51dWlkRnJvbVN0cmluZyA9IENhc3NhbmRyYUNsaWVudC51dWlkRnJvbVN0cmluZztcbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUudXVpZEZyb21CdWZmZXIgPSBDYXNzYW5kcmFDbGllbnQudXVpZEZyb21CdWZmZXI7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLnRpbWV1dWlkID0gQ2Fzc2FuZHJhQ2xpZW50LnRpbWV1dWlkO1xuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS50aW1ldXVpZEZyb21EYXRlID0gQ2Fzc2FuZHJhQ2xpZW50LnRpbWV1dWlkRnJvbURhdGU7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLnRpbWV1dWlkRnJvbVN0cmluZyA9IENhc3NhbmRyYUNsaWVudC50aW1ldXVpZEZyb21TdHJpbmc7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLnRpbWV1dWlkRnJvbUJ1ZmZlciA9IENhc3NhbmRyYUNsaWVudC50aW1ldXVpZEZyb21CdWZmZXI7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLm1heFRpbWV1dWlkID0gQ2Fzc2FuZHJhQ2xpZW50Lm1heFRpbWV1dWlkO1xuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS5taW5UaW1ldXVpZCA9IENhc3NhbmRyYUNsaWVudC5taW5UaW1ldXVpZDtcblxuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS5fdHJhbnNsYXRlRmlsZU5hbWVUb01vZGVsTmFtZSA9IENhc3NhbmRyYUNsaWVudC5fdHJhbnNsYXRlRmlsZU5hbWVUb01vZGVsTmFtZTtcblxubW9kdWxlLmV4cG9ydHMgPSBDYXNzYW5kcmFDbGllbnQ7XG4iXX0=