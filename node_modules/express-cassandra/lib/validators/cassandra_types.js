'use strict';

var check = require('check-types');
var util = require('util');
var cql = require('dse-driver');

var validators = {};
validators.is_array = function (obj) {
  return check.array(obj);
};
validators.is_object = function (obj) {
  return check.object(obj);
};
validators.is_long = function (obj) {
  return obj instanceof cql.types.Long;
};
validators.is_decimal = function (obj) {
  return obj instanceof cql.types.BigDecimal;
};
validators.is_integer = function (obj) {
  return check.intNumber(obj);
};
validators.is_var_int = function (obj) {
  return obj instanceof cql.types.Integer;
};
validators.is_boolean = function (obj) {
  return obj === true || obj === false;
};
validators.is_number = function (obj) {
  return check.number(obj);
};
validators.is_string = function (obj) {
  return check.string(obj);
};
validators.is_local_date = function (obj) {
  return obj instanceof cql.types.LocalDate;
};
validators.is_local_time = function (obj) {
  return obj instanceof cql.types.LocalTime;
};
validators.is_date = function (obj) {
  return check.date(new Date(obj));
};
validators.is_buffer = function (obj) {
  return obj instanceof Buffer;
};
validators.is_timeuuid = function (obj) {
  return obj instanceof cql.types.TimeUuid;
};
validators.is_uuid = function (obj) {
  return obj instanceof cql.types.Uuid;
};
validators.is_inet = function (obj) {
  return obj instanceof cql.types.InetAddress;
};
validators.is_frozen = function (obj) {
  return validators.is_array(obj) || validators.is_object(obj);
};

var TYPE_MAP = {
  ascii: { validator: validators.is_string },
  bigint: { validator: validators.is_long },
  blob: { validator: validators.is_buffer },
  boolean: { validator: validators.is_boolean },
  counter: { validator: validators.is_long },
  date: { validator: validators.is_local_date },
  decimal: { validator: validators.is_decimal },
  double: { validator: validators.is_number },
  float: { validator: validators.is_number },
  inet: { validator: validators.is_inet },
  int: { validator: validators.is_integer },
  list: { validator: validators.is_array },
  map: { validator: validators.is_object },
  set: { validator: validators.is_array },
  smallint: { validator: validators.is_integer },
  text: { validator: validators.is_string },
  time: { validator: validators.is_local_time },
  timestamp: { validator: validators.is_date },
  timeuuid: { validator: validators.is_timeuuid },
  tinyint: { validator: validators.is_integer },
  uuid: { validator: validators.is_uuid },
  varchar: { validator: validators.is_string },
  varint: { validator: validators.is_var_int },
  frozen: { validator: validators.is_frozen }
};

TYPE_MAP.generic_type_validator = function f(fieldtype) {
  if (!this[fieldtype]) return null;

  return {
    validator: this[fieldtype].validator,
    message: function message(value, propName, fieldType) {
      return util.format('Invalid Value: "%s" for Field: %s (Type: %s)', value, propName, fieldType);
    },

    type: 'type_validator'
  };
};

TYPE_MAP.extract_type = function f(val) {
  // decompose composite types
  var decomposed = val ? val.replace(/[\s]/g, '').split(/[<,>]/g) : [''];

  for (var d = 0; d < decomposed.length; d++) {
    if (Object.keys(this).indexOf(decomposed[d]) > -1) {
      return decomposed[d];
    }
  }

  return val;
};

TYPE_MAP.extract_typeDef = function f(val) {
  // decompose composite types
  var decomposed = val ? val.replace(/[\s]/g, '') : '';
  decomposed = decomposed.substr(decomposed.indexOf('<'), decomposed.length - decomposed.indexOf('<'));

  return decomposed;
};

module.exports = TYPE_MAP;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy92YWxpZGF0b3JzL2Nhc3NhbmRyYV90eXBlcy5qcyJdLCJuYW1lcyI6WyJjaGVjayIsInJlcXVpcmUiLCJ1dGlsIiwiY3FsIiwidmFsaWRhdG9ycyIsImlzX2FycmF5Iiwib2JqIiwiYXJyYXkiLCJpc19vYmplY3QiLCJvYmplY3QiLCJpc19sb25nIiwidHlwZXMiLCJMb25nIiwiaXNfZGVjaW1hbCIsIkJpZ0RlY2ltYWwiLCJpc19pbnRlZ2VyIiwiaW50TnVtYmVyIiwiaXNfdmFyX2ludCIsIkludGVnZXIiLCJpc19ib29sZWFuIiwiaXNfbnVtYmVyIiwibnVtYmVyIiwiaXNfc3RyaW5nIiwic3RyaW5nIiwiaXNfbG9jYWxfZGF0ZSIsIkxvY2FsRGF0ZSIsImlzX2xvY2FsX3RpbWUiLCJMb2NhbFRpbWUiLCJpc19kYXRlIiwiZGF0ZSIsIkRhdGUiLCJpc19idWZmZXIiLCJCdWZmZXIiLCJpc190aW1ldXVpZCIsIlRpbWVVdWlkIiwiaXNfdXVpZCIsIlV1aWQiLCJpc19pbmV0IiwiSW5ldEFkZHJlc3MiLCJpc19mcm96ZW4iLCJUWVBFX01BUCIsImFzY2lpIiwidmFsaWRhdG9yIiwiYmlnaW50IiwiYmxvYiIsImJvb2xlYW4iLCJjb3VudGVyIiwiZGVjaW1hbCIsImRvdWJsZSIsImZsb2F0IiwiaW5ldCIsImludCIsImxpc3QiLCJtYXAiLCJzZXQiLCJzbWFsbGludCIsInRleHQiLCJ0aW1lIiwidGltZXN0YW1wIiwidGltZXV1aWQiLCJ0aW55aW50IiwidXVpZCIsInZhcmNoYXIiLCJ2YXJpbnQiLCJmcm96ZW4iLCJnZW5lcmljX3R5cGVfdmFsaWRhdG9yIiwiZiIsImZpZWxkdHlwZSIsIm1lc3NhZ2UiLCJ2YWx1ZSIsInByb3BOYW1lIiwiZmllbGRUeXBlIiwiZm9ybWF0IiwidHlwZSIsImV4dHJhY3RfdHlwZSIsInZhbCIsImRlY29tcG9zZWQiLCJyZXBsYWNlIiwic3BsaXQiLCJkIiwibGVuZ3RoIiwiT2JqZWN0Iiwia2V5cyIsImlu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ckIsQ0FBTixHQUFpQyxFQUFsRDtBQUNBRCxlQUFhQSxXQUFXUyxNQUFYLENBQWtCVCxXQUFXTyxPQUFYLENBQW1CLEdBQW5CLENBQWxCLEVBQTJDUCxXQUFXSSxNQUFYLEdBQW9CSixXQUFXTyxPQUFYLENBQW1CLEdBQW5CLENBQS9ELENBQWI7O0FBRUEsU0FBT1AsVUFBUDtBQUNELENBTkQ7O0FBUUFVLE9BQU9DLE9BQVAsR0FBaUIvQyxRQUFqQiIsImZpbGUiOiJjYXNzYW5kcmFfdHlwZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjaGVjayA9IHJlcXVpcmUoJ2NoZWNrLXR5cGVzJyk7XG5jb25zdCB1dGlsID0gcmVxdWlyZSgndXRpbCcpO1xuY29uc3QgY3FsID0gcmVxdWlyZSgnZHNlLWRyaXZlcicpO1xuXG5jb25zdCB2YWxpZGF0b3JzID0ge307XG52YWxpZGF0b3JzLmlzX2FycmF5ID0gKG9iaikgPT4gKGNoZWNrLmFycmF5KG9iaikpO1xudmFsaWRhdG9ycy5pc19vYmplY3QgPSAob2JqKSA9PiAoY2hlY2sub2JqZWN0KG9iaikpO1xudmFsaWRhdG9ycy5pc19sb25nID0gKG9iaikgPT4gKChvYmogaW5zdGFuY2VvZiBjcWwudHlwZXMuTG9uZykpO1xudmFsaWRhdG9ycy5pc19kZWNpbWFsID0gKG9iaikgPT4gKChvYmogaW5zdGFuY2VvZiBjcWwudHlwZXMuQmlnRGVjaW1hbCkpO1xudmFsaWRhdG9ycy5pc19pbnRlZ2VyID0gKG9iaikgPT4gKGNoZWNrLmludE51bWJlcihvYmopKTtcbnZhbGlkYXRvcnMuaXNfdmFyX2ludCA9IChvYmopID0+ICgob2JqIGluc3RhbmNlb2YgY3FsLnR5cGVzLkludGVnZXIpKTtcbnZhbGlkYXRvcnMuaXNfYm9vbGVhbiA9IChvYmopID0+ICgob2JqID09PSB0cnVlIHx8IG9iaiA9PT0gZmFsc2UpKTtcbnZhbGlkYXRvcnMuaXNfbnVtYmVyID0gKG9iaikgPT4gKGNoZWNrLm51bWJlcihvYmopKTtcbnZhbGlkYXRvcnMuaXNfc3RyaW5nID0gKG9iaikgPT4gKGNoZWNrLnN0cmluZyhvYmopKTtcbnZhbGlkYXRvcnMuaXNfbG9jYWxfZGF0ZSA9IChvYmopID0+ICgob2JqIGluc3RhbmNlb2YgY3FsLnR5cGVzLkxvY2FsRGF0ZSkpO1xudmFsaWRhdG9ycy5pc19sb2NhbF90aW1lID0gKG9iaikgPT4gKChvYmogaW5zdGFuY2VvZiBjcWwudHlwZXMuTG9jYWxUaW1lKSk7XG52YWxpZGF0b3JzLmlzX2RhdGUgPSAob2JqKSA9PiAoY2hlY2suZGF0ZShuZXcgRGF0ZShvYmopKSk7XG52YWxpZGF0b3JzLmlzX2J1ZmZlciA9IChvYmopID0+ICgob2JqIGluc3RhbmNlb2YgQnVmZmVyKSk7XG52YWxpZGF0b3JzLmlzX3RpbWV1dWlkID0gKG9iaikgPT4gKChvYmogaW5zdGFuY2VvZiBjcWwudHlwZXMuVGltZVV1aWQpKTtcbnZhbGlkYXRvcnMuaXNfdXVpZCA9IChvYmopID0+ICgob2JqIGluc3RhbmNlb2YgY3FsLnR5cGVzLlV1aWQpKTtcbnZhbGlkYXRvcnMuaXNfaW5ldCA9IChvYmopID0+ICgob2JqIGluc3RhbmNlb2YgY3FsLnR5cGVzLkluZXRBZGRyZXNzKSk7XG52YWxpZGF0b3JzLmlzX2Zyb3plbiA9IChvYmopID0+ICgodmFsaWRhdG9ycy5pc19hcnJheShvYmopIHx8IHZhbGlkYXRvcnMuaXNfb2JqZWN0KG9iaikpKTtcblxuY29uc3QgVFlQRV9NQVAgPSB7XG4gIGFzY2lpOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19zdHJpbmcgfSxcbiAgYmlnaW50OiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19sb25nIH0sXG4gIGJsb2I6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2J1ZmZlciB9LFxuICBib29sZWFuOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19ib29sZWFuIH0sXG4gIGNvdW50ZXI6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2xvbmcgfSxcbiAgZGF0ZTogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfbG9jYWxfZGF0ZSB9LFxuICBkZWNpbWFsOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19kZWNpbWFsIH0sXG4gIGRvdWJsZTogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfbnVtYmVyIH0sXG4gIGZsb2F0OiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19udW1iZXIgfSxcbiAgaW5ldDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfaW5ldCB9LFxuICBpbnQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2ludGVnZXIgfSxcbiAgbGlzdDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfYXJyYXkgfSxcbiAgbWFwOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19vYmplY3QgfSxcbiAgc2V0OiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19hcnJheSB9LFxuICBzbWFsbGludDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfaW50ZWdlciB9LFxuICB0ZXh0OiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19zdHJpbmcgfSxcbiAgdGltZTogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfbG9jYWxfdGltZSB9LFxuICB0aW1lc3RhbXA6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2RhdGUgfSxcbiAgdGltZXV1aWQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX3RpbWV1dWlkIH0sXG4gIHRpbnlpbnQ6IHsgdmFsaWRhdG9yOiB2YWxpZGF0b3JzLmlzX2ludGVnZXIgfSxcbiAgdXVpZDogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfdXVpZCB9LFxuICB2YXJjaGFyOiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc19zdHJpbmcgfSxcbiAgdmFyaW50OiB7IHZhbGlkYXRvcjogdmFsaWRhdG9ycy5pc192YXJfaW50IH0sXG4gIGZyb3plbjogeyB2YWxpZGF0b3I6IHZhbGlkYXRvcnMuaXNfZnJvemVuIH0sXG59O1xuXG5cblRZUEVfTUFQLmdlbmVyaWNfdHlwZV92YWxpZGF0b3IgPSBmdW5jdGlvbiBmKGZpZWxkdHlwZSkge1xuICBpZiAoIXRoaXNbZmllbGR0eXBlXSkgcmV0dXJuIG51bGw7XG5cbiAgcmV0dXJuIHtcbiAgICB2YWxpZGF0b3I6IHRoaXNbZmllbGR0eXBlXS52YWxpZGF0b3IsXG4gICAgbWVzc2FnZSh2YWx1ZSwgcHJvcE5hbWUsIGZpZWxkVHlwZSkge1xuICAgICAgcmV0dXJuIHV0aWwuZm9ybWF0KCdJbnZhbGlkIFZhbHVlOiBcIiVzXCIgZm9yIEZpZWxkOiAlcyAoVHlwZTogJXMpJywgdmFsdWUsIHByb3BOYW1lLCBmaWVsZFR5cGUpO1xuICAgIH0sXG4gICAgdHlwZTogJ3R5cGVfdmFsaWRhdG9yJyxcbiAgfTtcbn07XG5cblRZUEVfTUFQLmV4dHJhY3RfdHlwZSA9IGZ1bmN0aW9uIGYodmFsKSB7XG4gIC8vIGRlY29tcG9zZSBjb21wb3NpdGUgdHlwZXNcbiAgY29uc3QgZGVjb21wb3NlZCA9IHZhbCA/IHZhbC5yZXBsYWNlKC9bXFxzXS9nLCAnJykuc3BsaXQoL1s8LD5dL2cpIDogWycnXTtcblxuICBmb3IgKGxldCBkID0gMDsgZCA8IGRlY29tcG9zZWQubGVuZ3RoOyBkKyspIHtcbiAgICBpZiAoT2JqZWN0LmtleXModGhpcykuaW5kZXhPZihkZWNvbXBvc2VkW2RdKSA+IC0xKSB7XG4gICAgICByZXR1cm4gZGVjb21wb3NlZFtkXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdmFsO1xufTtcblxuVFlQRV9NQVAuZXh0cmFjdF90eXBlRGVmID0gZnVuY3Rpb24gZih2YWwpIHtcbiAgLy8gZGVjb21wb3NlIGNvbXBvc2l0ZSB0eXBlc1xuICBsZXQgZGVjb21wb3NlZCA9IHZhbCA/IHZhbC5yZXBsYWNlKC9bXFxzXS9nLCAnJykgOiAnJztcbiAgZGVjb21wb3NlZCA9IGRlY29tcG9zZWQuc3Vic3RyKGRlY29tcG9zZWQuaW5kZXhPZignPCcpLCBkZWNvbXBvc2VkLmxlbmd0aCAtIGRlY29tcG9zZWQuaW5kZXhPZignPCcpKTtcblxuICByZXR1cm4gZGVjb21wb3NlZDtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gVFlQRV9NQVA7XG4iXX0=